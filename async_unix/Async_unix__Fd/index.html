<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"><head><title>Async_unix__Fd (async_unix.Async_unix__Fd)</title><link rel="stylesheet" href="../../_odoc-theme/odoc.css"/><meta charset="utf-8"/><meta name="generator" content="odoc v1.1.1-1373-g2e7c1c75"/><meta name="viewport" content="width=device-width,initial-scale=1.0"/><script src="../../highlight.pack.js"></script><script>hljs.initHighlightingOnLoad();</script></head><body><nav><a href="../index.html">Up</a> â€“ <a href="../index.html">async_unix</a> &#x00BB; Async_unix__Fd</nav><header><h1>Module <code>Async_unix__Fd</code></h1><p>An <code>Fd.t</code> is a wrapper around a Unix file descriptor, with additional information about the kind of file descriptor and logic to ensure that we don't use a file descriptor that has been closed, or close a file descriptor that is in use.</p><p>Since Async uses multiple threads to make read/write and other system calls on file descriptors, and Unix reuses descriptors after they are closed, Async has to be very careful that the file descriptor passed to a system call is referring to the file it intends, and not some other completely unrelated file that Unix has decided to assign to the same descriptor.</p><p>Provided that one only accesses a file descriptor within the context of the functions below, <code>Fd</code> guarantees that the file descriptor will not have been closed/reused and will correspond to the same file that it did when the <code>Fd.t</code> was created:</p><pre>      with_file_descr
      with_file_descr_deferred
      syscall
      syscall_exn
      syscall_result_exn
      syscall_in_thread
      syscall_in_thread_exn</pre><p>The <code>Fd</code> module keeps track of which of these functions are currently accessing the file descriptor, and ensures that any close happens after they complete. Also, once close has been called, it refuses to provide further access to the file descriptor, either by returning a variant <code>`Already_closed</code> or by raising an exception.</p><p>Some of the above functions take an optional <code>?nonblocking:bool</code> argument. The default is <code>false</code>, but if it is set to <code>true</code>, then before supplying the underlying <code>file_descr</code>, the <code>Fd</code> module will first call <code>Unix.set_nonblock file_descr</code>, if it hasn't previously done so on that file descriptor. This is intended to support making nonblocking system calls (e.g., connect, read, write) directly within Async, without releasing the OCaml lock or the Async lock, and without using another thread.</p></header><div class="content"></div></body></html>