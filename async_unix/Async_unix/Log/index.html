<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"><head><title>Log (async_unix.Async_unix.Log)</title><link rel="stylesheet" href="../../../_odoc-theme/odoc.css"/><meta charset="utf-8"/><meta name="generator" content="odoc v1.1.1-1373-g2e7c1c75"/><meta name="viewport" content="width=device-width,initial-scale=1.0"/><script src="../../../highlight.pack.js"></script><script>hljs.initHighlightingOnLoad();</script></head><body><nav><a href="../index.html">Up</a> â€“ <a href="../../index.html">async_unix</a> &#x00BB; <a href="../index.html">Async_unix</a> &#x00BB; Log</nav><header><h1>Module <code>Async_unix.Log</code></h1><p>A library for general logging.</p><p>Although this module is fully Async-safe it exposes almost no Deferreds. This is partially a design choice to minimize the impact of logging in code, and partially the result of organic design (i.e., older versions of this interface did the same thing).</p><p>A (limited) <code>Blocking</code> module is supplied to accommodate the portion of a program that runs outside of Async.</p></header><div class="content"><div class="spec module" id="module-Level" class="anchored"><a href="#module-Level" class="anchor"></a><code><span class="keyword">module</span> <a href="Level/index.html">Level</a> : <span class="keyword">sig</span> ... <span class="keyword">end</span></code></div><div class="spec module" id="module-Message" class="anchored"><a href="#module-Message" class="anchor"></a><code><span class="keyword">module</span> <a href="Message/index.html">Message</a> : <span class="keyword">sig</span> ... <span class="keyword">end</span></code></div><div class="spec module" id="module-Rotation" class="anchored"><a href="#module-Rotation" class="anchor"></a><code><span class="keyword">module</span> <a href="Rotation/index.html">Rotation</a> : <span class="keyword">sig</span> ... <span class="keyword">end</span></code></div><div class="spec module" id="module-Output" class="anchored"><a href="#module-Output" class="anchor"></a><code><span class="keyword">module</span> <a href="Output/index.html">Output</a> : <span class="keyword">sig</span> ... <span class="keyword">end</span></code></div><div class="spec module" id="module-Blocking" class="anchored"><a href="#module-Blocking" class="anchor"></a><code><span class="keyword">module</span> <a href="Blocking/index.html">Blocking</a> : <span class="keyword">sig</span> ... <span class="keyword">end</span></code></div><div class="spec type" id="type-t" class="anchored"><a href="#type-t" class="anchor"></a><code><span class="keyword">type</span> t</code></div><div><div class="spec include"><div class="doc"><div class="spec value" id="val-sexp_of_t" class="anchored"><a href="#val-sexp_of_t" class="anchor"></a><code><span class="keyword">val</span> sexp_of_t : <a href="index.html#type-t">t</a> <span>&#45;&gt;</span> <a href="../../../sexplib0/Sexplib0/Sexp/index.html#type-t">Ppx_sexp_conv_lib.Sexp.t</a></code></div></div></div></div><div><div class="spec module-type" id="module-type-Global_intf" class="anchored"><a href="#module-type-Global_intf" class="anchor"></a><code><span class="keyword">module</span> <span class="keyword">type</span> <a href="module-type-Global_intf/index.html">Global_intf</a> = <span class="keyword">sig</span> ... <span class="keyword">end</span></code></div><div><p>An interface for singleton logs.</p></div></div><div><div class="spec module" id="module-Make_global" class="anchored"><a href="#module-Make_global" class="anchor"></a><code><span class="keyword">module</span> <a href="Make_global/index.html">Make_global</a> : <span class="keyword">functor</span> () <span>&#45;&gt;</span> <a href="module-type-Global_intf/index.html">Global_intf</a></code></div><div><p>This functor can be called to generate &quot;singleton&quot; logging modules.</p></div></div><div><div class="spec module" id="module-Global" class="anchored"><a href="#module-Global" class="anchor"></a><code><span class="keyword">module</span> <a href="Global/index.html">Global</a> : <a href="module-type-Global_intf/index.html">Global_intf</a></code></div><div><p>Programs that want simplistic single-channel logging can open this module. It provides a global logging facility to a single output type at a single level. More nuanced logging can be had by using the functions that operate on a distinct <code>Log.t</code> type.</p></div></div><div><div class="spec value" id="val-set_level_via_param" class="anchored"><a href="#val-set_level_via_param" class="anchor"></a><code><span class="keyword">val</span> set_level_via_param : <a href="index.html#type-t">t</a> <span>&#45;&gt;</span> <span>unit <a href="../../../core/Core/Command/Param/index.html#type-t">Core.Command.Param.t</a></span></code></div><div><p>Sets the log level via a flag, if provided.</p></div></div><div><div class="spec value" id="val-set_level" class="anchored"><a href="#val-set_level" class="anchor"></a><code><span class="keyword">val</span> set_level : <a href="index.html#type-t">t</a> <span>&#45;&gt;</span> <a href="Level/index.html#type-t">Level.t</a> <span>&#45;&gt;</span> unit</code></div><div><p>Messages sent at a level less than the current level will not be output.</p></div></div><div><div class="spec value" id="val-level" class="anchored"><a href="#val-level" class="anchor"></a><code><span class="keyword">val</span> level : <a href="index.html#type-t">t</a> <span>&#45;&gt;</span> <a href="Level/index.html#type-t">Level.t</a></code></div><div><p>Returns the last level passed to <code>set_level</code>, which will be the log level checked as a threshold against the level of the next message sent.</p></div></div><div><div class="spec value" id="val-set_output" class="anchored"><a href="#val-set_output" class="anchor"></a><code><span class="keyword">val</span> set_output : <a href="index.html#type-t">t</a> <span>&#45;&gt;</span> <span><a href="Output/index.html#type-t">Output.t</a> list</span> <span>&#45;&gt;</span> unit</code></div><div><p>Changes the output type of the log, which can be useful when daemonizing. The new output type will be applied to all subsequent messages.</p></div></div><div class="spec value" id="val-get_output" class="anchored"><a href="#val-get_output" class="anchor"></a><code><span class="keyword">val</span> get_output : <a href="index.html#type-t">t</a> <span>&#45;&gt;</span> <span><a href="Output/index.html#type-t">Output.t</a> list</span></code></div><div><div class="spec value" id="val-set_on_error" class="anchored"><a href="#val-set_on_error" class="anchor"></a><code><span class="keyword">val</span> set_on_error : <a href="index.html#type-t">t</a> <span>&#45;&gt;</span> <span>[ `Raise <span><span>| `Call</span> of <a href="../../../core_kernel/Core_kernel/Error/index.html#type-t">Core.Error.t</a> <span>&#45;&gt;</span> unit</span> ]</span> <span>&#45;&gt;</span> unit</code></div><div><p>If <code>`Raise</code> is given, then background errors raised by logging will be raised to the monitor that was in scope when <code>create</code> was called. Errors can be redirected anywhere by providing <code>`Call f</code>.</p></div></div><div><div class="spec value" id="val-close" class="anchored"><a href="#val-close" class="anchor"></a><code><span class="keyword">val</span> close : <a href="index.html#type-t">t</a> <span>&#45;&gt;</span> <span>unit <a href="../../../async_kernel/Async_kernel/Deferred/index.html#type-t">Async_kernel.Deferred.t</a></span></code></div><div><p>Any call that writes to a log after <code>close</code> is called will raise.</p></div></div><div><div class="spec value" id="val-is_closed" class="anchored"><a href="#val-is_closed" class="anchor"></a><code><span class="keyword">val</span> is_closed : <a href="index.html#type-t">t</a> <span>&#45;&gt;</span> bool</code></div><div><p>Returns true if <code>close</code> has been called.</p></div></div><div><div class="spec value" id="val-flushed" class="anchored"><a href="#val-flushed" class="anchor"></a><code><span class="keyword">val</span> flushed : <a href="index.html#type-t">t</a> <span>&#45;&gt;</span> <span>unit <a href="../../../async_kernel/Async_kernel/Deferred/index.html#type-t">Async_kernel.Deferred.t</a></span></code></div><div><p>Returns a <code>Deferred.t</code> that is fulfilled when the last message delivered to <code>t</code> before the call to <code>flushed</code> is out the door.</p></div></div><div><div class="spec value" id="val-rotate" class="anchored"><a href="#val-rotate" class="anchor"></a><code><span class="keyword">val</span> rotate : <a href="index.html#type-t">t</a> <span>&#45;&gt;</span> <span>unit <a href="../../../async_kernel/Async_kernel/Deferred/index.html#type-t">Async_kernel.Deferred.t</a></span></code></div><div><p>Informs the current <code>Output</code>s to rotate if possible.</p></div></div><div><div class="spec value" id="val-create" class="anchored"><a href="#val-create" class="anchor"></a><code><span class="keyword">val</span> create : <span>level:<a href="Level/index.html#type-t">Level.t</a></span> <span>&#45;&gt;</span> <span>output:<span><a href="Output/index.html#type-t">Output.t</a> list</span></span> <span>&#45;&gt;</span> <span>on_error:<span>[ `Raise <span><span>| `Call</span> of <a href="../../../core_kernel/Core_kernel/Error/index.html#type-t">Core.Error.t</a> <span>&#45;&gt;</span> unit</span> ]</span></span> <span>&#45;&gt;</span> <a href="index.html#type-t">t</a></code></div><div><p>Creates a new log. See <code>set_level</code>, <code>set_on_error</code> and <code>set_output</code> for more.</p></div></div><aside><p>Printf-like logging for messages at each log level or raw (no level) messages. Raw messages still include a timestamp.</p></aside><div class="spec value" id="val-raw" class="anchored"><a href="#val-raw" class="anchor"></a><code><span class="keyword">val</span> raw : <span>?&#8288;time:<a href="../../../core/Core/Time/index.html#type-t">Core.Time.t</a></span> <span>&#45;&gt;</span> <span>?&#8288;tags:<span><span>(string * string)</span> list</span></span> <span>&#45;&gt;</span> <a href="index.html#type-t">t</a> <span>&#45;&gt;</span> <span><span>(<span class="type-var">'a</span>,Â unit,Â string,Â unit)</span> <a href="../../../core/Core/index.html#type-format4">Core.format4</a></span> <span>&#45;&gt;</span> <span class="type-var">'a</span></code></div><div class="spec value" id="val-debug" class="anchored"><a href="#val-debug" class="anchor"></a><code><span class="keyword">val</span> debug : <span>?&#8288;time:<a href="../../../core/Core/Time/index.html#type-t">Core.Time.t</a></span> <span>&#45;&gt;</span> <span>?&#8288;tags:<span><span>(string * string)</span> list</span></span> <span>&#45;&gt;</span> <a href="index.html#type-t">t</a> <span>&#45;&gt;</span> <span><span>(<span class="type-var">'a</span>,Â unit,Â string,Â unit)</span> <a href="../../../core/Core/index.html#type-format4">Core.format4</a></span> <span>&#45;&gt;</span> <span class="type-var">'a</span></code></div><div class="spec value" id="val-info" class="anchored"><a href="#val-info" class="anchor"></a><code><span class="keyword">val</span> info : <span>?&#8288;time:<a href="../../../core/Core/Time/index.html#type-t">Core.Time.t</a></span> <span>&#45;&gt;</span> <span>?&#8288;tags:<span><span>(string * string)</span> list</span></span> <span>&#45;&gt;</span> <a href="index.html#type-t">t</a> <span>&#45;&gt;</span> <span><span>(<span class="type-var">'a</span>,Â unit,Â string,Â unit)</span> <a href="../../../core/Core/index.html#type-format4">Core.format4</a></span> <span>&#45;&gt;</span> <span class="type-var">'a</span></code></div><div class="spec value" id="val-error" class="anchored"><a href="#val-error" class="anchor"></a><code><span class="keyword">val</span> error : <span>?&#8288;time:<a href="../../../core/Core/Time/index.html#type-t">Core.Time.t</a></span> <span>&#45;&gt;</span> <span>?&#8288;tags:<span><span>(string * string)</span> list</span></span> <span>&#45;&gt;</span> <a href="index.html#type-t">t</a> <span>&#45;&gt;</span> <span><span>(<span class="type-var">'a</span>,Â unit,Â string,Â unit)</span> <a href="../../../core/Core/index.html#type-format4">Core.format4</a></span> <span>&#45;&gt;</span> <span class="type-var">'a</span></code></div><div><div class="spec value" id="val-printf" class="anchored"><a href="#val-printf" class="anchor"></a><code><span class="keyword">val</span> printf : <span>?&#8288;level:<a href="Level/index.html#type-t">Level.t</a></span> <span>&#45;&gt;</span> <span>?&#8288;time:<a href="../../../core/Core/Time/index.html#type-t">Core.Time.t</a></span> <span>&#45;&gt;</span> <span>?&#8288;tags:<span><span>(string * string)</span> list</span></span> <span>&#45;&gt;</span> <a href="index.html#type-t">t</a> <span>&#45;&gt;</span> <span><span>(<span class="type-var">'a</span>,Â unit,Â string,Â unit)</span> <a href="../../../core/Core/index.html#type-format4">Core.format4</a></span> <span>&#45;&gt;</span> <span class="type-var">'a</span></code></div><div><p>Generalized printf-style logging.</p></div></div><aside><p>Sexp logging for messages at each log level or raw (no level) messages. Raw messages still include a timestamp</p></aside><div class="spec value" id="val-raw_s" class="anchored"><a href="#val-raw_s" class="anchor"></a><code><span class="keyword">val</span> raw_s : <span>?&#8288;time:<a href="../../../core/Core/Time/index.html#type-t">Core.Time.t</a></span> <span>&#45;&gt;</span> <span>?&#8288;tags:<span><span>(string * string)</span> list</span></span> <span>&#45;&gt;</span> <a href="index.html#type-t">t</a> <span>&#45;&gt;</span> <a href="../../../core_kernel/Core_kernel/Sexp/index.html#type-t">Core.Sexp.t</a> <span>&#45;&gt;</span> unit</code></div><div class="spec value" id="val-info_s" class="anchored"><a href="#val-info_s" class="anchor"></a><code><span class="keyword">val</span> info_s : <span>?&#8288;time:<a href="../../../core/Core/Time/index.html#type-t">Core.Time.t</a></span> <span>&#45;&gt;</span> <span>?&#8288;tags:<span><span>(string * string)</span> list</span></span> <span>&#45;&gt;</span> <a href="index.html#type-t">t</a> <span>&#45;&gt;</span> <a href="../../../core_kernel/Core_kernel/Sexp/index.html#type-t">Core.Sexp.t</a> <span>&#45;&gt;</span> unit</code></div><div class="spec value" id="val-error_s" class="anchored"><a href="#val-error_s" class="anchor"></a><code><span class="keyword">val</span> error_s : <span>?&#8288;time:<a href="../../../core/Core/Time/index.html#type-t">Core.Time.t</a></span> <span>&#45;&gt;</span> <span>?&#8288;tags:<span><span>(string * string)</span> list</span></span> <span>&#45;&gt;</span> <a href="index.html#type-t">t</a> <span>&#45;&gt;</span> <a href="../../../core_kernel/Core_kernel/Sexp/index.html#type-t">Core.Sexp.t</a> <span>&#45;&gt;</span> unit</code></div><div class="spec value" id="val-debug_s" class="anchored"><a href="#val-debug_s" class="anchor"></a><code><span class="keyword">val</span> debug_s : <span>?&#8288;time:<a href="../../../core/Core/Time/index.html#type-t">Core.Time.t</a></span> <span>&#45;&gt;</span> <span>?&#8288;tags:<span><span>(string * string)</span> list</span></span> <span>&#45;&gt;</span> <a href="index.html#type-t">t</a> <span>&#45;&gt;</span> <a href="../../../core_kernel/Core_kernel/Sexp/index.html#type-t">Core.Sexp.t</a> <span>&#45;&gt;</span> unit</code></div><div><div class="spec value" id="val-sexp" class="anchored"><a href="#val-sexp" class="anchor"></a><code><span class="keyword">val</span> sexp : <span>?&#8288;level:<a href="Level/index.html#type-t">Level.t</a></span> <span>&#45;&gt;</span> <span>?&#8288;time:<a href="../../../core/Core/Time/index.html#type-t">Core.Time.t</a></span> <span>&#45;&gt;</span> <span>?&#8288;tags:<span><span>(string * string)</span> list</span></span> <span>&#45;&gt;</span> <a href="index.html#type-t">t</a> <span>&#45;&gt;</span> <a href="../../../core_kernel/Core_kernel/Sexp/index.html#type-t">Core.Sexp.t</a> <span>&#45;&gt;</span> unit</code></div><div><p>Generalized sexp-style logging.</p></div></div><div><div class="spec value" id="val-string" class="anchored"><a href="#val-string" class="anchor"></a><code><span class="keyword">val</span> string : <span>?&#8288;level:<a href="Level/index.html#type-t">Level.t</a></span> <span>&#45;&gt;</span> <span>?&#8288;time:<a href="../../../core/Core/Time/index.html#type-t">Core.Time.t</a></span> <span>&#45;&gt;</span> <span>?&#8288;tags:<span><span>(string * string)</span> list</span></span> <span>&#45;&gt;</span> <a href="index.html#type-t">t</a> <span>&#45;&gt;</span> string <span>&#45;&gt;</span> unit</code></div><div><p>Log a string directly.</p></div></div><div><div class="spec value" id="val-message" class="anchored"><a href="#val-message" class="anchor"></a><code><span class="keyword">val</span> message : <a href="index.html#type-t">t</a> <span>&#45;&gt;</span> <a href="Message/index.html#type-t">Message.t</a> <span>&#45;&gt;</span> unit</code></div><div><p>Log a pre-created message.</p></div></div><div><div class="spec value" id="val-surround_s" class="anchored"><a href="#val-surround_s" class="anchor"></a><code><span class="keyword">val</span> surround_s : <span>?&#8288;level:<a href="Level/index.html#type-t">Level.t</a></span> <span>&#45;&gt;</span> <span>?&#8288;time:<a href="../../../core/Core/Time/index.html#type-t">Core.Time.t</a></span> <span>&#45;&gt;</span> <span>?&#8288;tags:<span><span>(string * string)</span> list</span></span> <span>&#45;&gt;</span> <a href="index.html#type-t">t</a> <span>&#45;&gt;</span> <a href="../../../core_kernel/Core_kernel/Sexp/index.html#type-t">Core.Sexp.t</a> <span>&#45;&gt;</span> <span>(unit <span>&#45;&gt;</span> <span><span class="type-var">'a</span> <a href="../../../async_kernel/Async_kernel/Deferred/index.html#type-t">Async_kernel.Deferred.t</a></span>)</span> <span>&#45;&gt;</span> <span><span class="type-var">'a</span> <a href="../../../async_kernel/Async_kernel/Deferred/index.html#type-t">Async_kernel.Deferred.t</a></span></code></div><div><p><code>surround t message f</code> logs <code>message</code> and a UUID once before calling <code>f</code> and again after <code>f</code> returns or raises. If <code>f</code> raises, the second message will include the exception, and <code>surround</code> itself will re-raise the exception tagged with <code>message</code>. As usual, the logging happens only if <code>level</code> exceeds the minimum level of <code>t</code>.</p></div></div><div class="spec value" id="val-surroundf" class="anchored"><a href="#val-surroundf" class="anchor"></a><code><span class="keyword">val</span> surroundf : <span>?&#8288;level:<a href="Level/index.html#type-t">Level.t</a></span> <span>&#45;&gt;</span> <span>?&#8288;time:<a href="../../../core/Core/Time/index.html#type-t">Core.Time.t</a></span> <span>&#45;&gt;</span> <span>?&#8288;tags:<span><span>(string * string)</span> list</span></span> <span>&#45;&gt;</span> <a href="index.html#type-t">t</a> <span>&#45;&gt;</span> <span><span>(<span class="type-var">'a</span>,Â unit,Â string,Â <span>(unit <span>&#45;&gt;</span> <span><span class="type-var">'b</span> <a href="../../../async_kernel/Async_kernel/Deferred/index.html#type-t">Async_kernel.Deferred.t</a></span>)</span> <span>&#45;&gt;</span> <span><span class="type-var">'b</span> <a href="../../../async_kernel/Async_kernel/Deferred/index.html#type-t">Async_kernel.Deferred.t</a></span>)</span> <a href="../../../core/Core/index.html#type-format4">Core.format4</a></span> <span>&#45;&gt;</span> <span class="type-var">'a</span></code></div><div><div class="spec value" id="val-would_log" class="anchored"><a href="#val-would_log" class="anchor"></a><code><span class="keyword">val</span> would_log : <a href="index.html#type-t">t</a> <span>&#45;&gt;</span> <span><a href="Level/index.html#type-t">Level.t</a> option</span> <span>&#45;&gt;</span> bool</code></div><div><p><code>would_log</code> returns true if a message at the given log level would be logged if sent immediately.</p></div></div><div class="spec module" id="module-Reader" class="anchored"><a href="#module-Reader" class="anchor"></a><code><span class="keyword">module</span> <a href="Reader/index.html">Reader</a> : <span class="keyword">sig</span> ... <span class="keyword">end</span></code></div><div class="spec module" id="module-For_testing" class="anchored"><a href="#module-For_testing" class="anchor"></a><code><span class="keyword">module</span> <a href="For_testing/index.html">For_testing</a> : <span class="keyword">sig</span> ... <span class="keyword">end</span></code></div></div></body></html>