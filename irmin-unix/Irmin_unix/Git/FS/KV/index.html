<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"><head><title>KV (irmin-unix.Irmin_unix.Git.FS.KV)</title><link rel="stylesheet" href="../../../../../_odoc-theme/odoc.css"/><meta charset="utf-8"/><meta name="generator" content="odoc v1.1.1-1373-g2e7c1c75"/><meta name="viewport" content="width=device-width,initial-scale=1.0"/><script src="../../../../../highlight.pack.js"></script><script>hljs.initHighlightingOnLoad();</script></head><body><nav><a href="../index.html">Up</a> â€“ <a href="../../../../index.html">irmin-unix</a> &#x00BB; <a href="../../../index.html">Irmin_unix</a> &#x00BB; <a href="../../index.html">Git</a> &#x00BB; <a href="../index.html">FS</a> &#x00BB; KV</nav><header><h1>Module <code>FS.KV</code></h1><h3 id="parameters"><a href="#parameters" class="anchor"></a>Parameters</h3><div class="spec parameter" id="argument-1-C" class="anchored"><a href="#argument-1-C" class="anchor"></a><code><span class="keyword">module</span> <a href="argument-1-C/index.html">C</a> : <a href="../../../../../irmin/Irmin/Contents/module-type-S/index.html">Irmin.Contents.S</a></code></div><h3 id="signature"><a href="#signature" class="anchor"></a>Signature</h3></header><div class="content"><div><div class="spec include"><div class="doc"><details open="open"><summary><span class="def"><code><span class="keyword">include</span> <a href="../../../../../irmin-git/Irmin_git/module-type-S/index.html">Irmin_git.S</a> <span class="keyword">with</span> <span class="keyword">type</span> <a href="../../../../../irmin-git/Irmin_git/module-type-S/Private/Sync/index.html#type-endpoint">Private.Sync.endpoint</a> = <a href="../../../../../git-unix/Git_unix/index.html#type-endpoint">Git_unix.endpoint</a> <span class="keyword">with</span> <span class="keyword">type</span> <a href="../../../../../irmin-git/Irmin_git/module-type-S/index.html#type-key">key</a> = <a href="../../../../../irmin/Irmin/Path/String_list/index.html#type-t">Irmin.Path.String_list.t</a> <span class="keyword">with</span> <span class="keyword">type</span> <a href="../../../../../irmin-git/Irmin_git/module-type-S/index.html#type-step">step</a> = string <span class="keyword">with</span> <span class="keyword">module</span> <a href="../../../../../irmin-git/Irmin_git/module-type-S/Key/index.html">Key</a> = <a href="../../../../../irmin/Irmin/Path/String_list/index.html">Irmin.Path.String_list</a> <span class="keyword">with</span> <span class="keyword">type</span> <a href="../../../../../irmin-git/Irmin_git/module-type-S/index.html#type-contents">contents</a> = <a href="argument-1-C/index.html#type-t">C.t</a> <span class="keyword">with</span> <span class="keyword">type</span> <a href="../../../../../irmin-git/Irmin_git/module-type-S/index.html#type-branch">branch</a> = string <span class="keyword">with</span> <span class="keyword">module</span> <a href="../../../../../irmin-git/Irmin_git/module-type-S/Git/index.html">Git</a> = <a href="../G/index.html">G</a></code></span></summary><div><div class="spec module" id="module-Git" class="anchored"><a href="#module-Git" class="anchor"></a><code><span class="keyword">module</span> Git = <a href="../G/index.html">G</a></code></div><div><p>Access to the underlying Git store.</p></div></div><div><div class="spec include"><div class="doc"><details open="open"><summary><span class="def"><code><span class="keyword">include</span> <a href="../../../../../irmin/Irmin/module-type-S/index.html">Irmin.S</a> <span class="keyword">with</span> <span class="keyword">type</span> <a href="../../../../../irmin/Irmin/module-type-S/index.html#type-metadata">metadata</a> = <a href="../../../../../irmin-git/Irmin_git/Metadata/index.html#type-t">Irmin_git.Metadata.t</a> <span class="keyword">and</span> <span class="keyword">type</span> <a href="../../../../../irmin/Irmin/module-type-S/index.html#type-hash">hash</a> = <a href="../G/Hash/index.html#type-t">Git.Hash.t</a> <span class="keyword">with</span> <span class="keyword">type</span> <a href="../../../../../irmin/Irmin/module-type-S/Private/Sync/index.html#type-endpoint">Private.Sync.endpoint</a> = <a href="../../../../../git-unix/Git_unix/index.html#type-endpoint">Git_unix.endpoint</a> <span class="keyword">with</span> <span class="keyword">type</span> <a href="../../../../../irmin/Irmin/module-type-S/index.html#type-key">key</a> = <a href="../../../../../irmin/Irmin/Path/String_list/index.html#type-t">Irmin.Path.String_list.t</a> <span class="keyword">with</span> <span class="keyword">type</span> <a href="../../../../../irmin/Irmin/module-type-S/index.html#type-step">step</a> = string <span class="keyword">with</span> <span class="keyword">module</span> <a href="../../../../../irmin/Irmin/module-type-S/Key/index.html">Key</a> = <a href="../../../../../irmin/Irmin/Path/String_list/index.html">Irmin.Path.String_list</a> <span class="keyword">with</span> <span class="keyword">type</span> <a href="../../../../../irmin/Irmin/module-type-S/index.html#type-contents">contents</a> = <a href="argument-1-C/index.html#type-t">C.t</a> <span class="keyword">with</span> <span class="keyword">type</span> <a href="../../../../../irmin/Irmin/module-type-S/index.html#type-branch">branch</a> = string</code></span></summary><div><div class="spec include"><div class="doc"><div><div class="spec type" id="type-repo" class="anchored"><a href="#type-repo" class="anchor"></a><code><span class="keyword">type</span> repo</code></div><div><p>The type for Irmin repositories.</p></div></div><div><div class="spec type" id="type-t" class="anchored"><a href="#type-t" class="anchor"></a><code><span class="keyword">type</span> t</code></div><div><p>The type for Irmin stores.</p></div></div><div><div class="spec type" id="type-step" class="anchored"><a href="#type-step" class="anchor"></a><code><span class="keyword">type</span> step = string</code></div><div><p>The type for <a href="index.html#type-key"><code>key</code></a> steps.</p></div></div><div><div class="spec type" id="type-key" class="anchored"><a href="#type-key" class="anchor"></a><code><span class="keyword">type</span> key = <a href="../../../../../irmin/Irmin/Path/String_list/index.html#type-t">Irmin.Path.String_list.t</a></code></div><div><p>The type for store keys. A key is a sequence of <a href="index.html#type-step"><code>step</code></a>s.</p></div></div><div><div class="spec type" id="type-metadata" class="anchored"><a href="#type-metadata" class="anchor"></a><code><span class="keyword">type</span> metadata = <a href="../../../../../irmin-git/Irmin_git/Metadata/index.html#type-t">Irmin_git.Metadata.t</a></code></div><div><p>The type for store metadata.</p></div></div><div><div class="spec type" id="type-contents" class="anchored"><a href="#type-contents" class="anchor"></a><code><span class="keyword">type</span> contents = <a href="argument-1-C/index.html#type-t">C.t</a></code></div><div><p>The type for store contents.</p></div></div><div><div class="spec type" id="type-node" class="anchored"><a href="#type-node" class="anchor"></a><code><span class="keyword">type</span> node</code></div><div><p>The type for store nodes.</p></div></div><div><div class="spec type" id="type-tree" class="anchored"><a href="#type-tree" class="anchor"></a><code><span class="keyword">type</span> tree</code></div><div><p>The type for store trees.</p></div></div><div><div class="spec type" id="type-hash" class="anchored"><a href="#type-hash" class="anchor"></a><code><span class="keyword">type</span> hash = <a href="../G/Hash/index.html#type-t">Git.Hash.t</a></code></div><div><p>The type for object hashes.</p></div></div><div><div class="spec type" id="type-commit" class="anchored"><a href="#type-commit" class="anchor"></a><code><span class="keyword">type</span> commit</code></div><div><p>Type for commit identifiers. Similar to Git's commit SHA1s.</p></div></div><div><div class="spec type" id="type-branch" class="anchored"><a href="#type-branch" class="anchor"></a><code><span class="keyword">type</span> branch = string</code></div><div><p>Type for persistent branch names. Branches usually share a common global namespace and it's the user's responsibility to avoid name clashes.</p></div></div><div><div class="spec type" id="type-slice" class="anchored"><a href="#type-slice" class="anchor"></a><code><span class="keyword">type</span> slice</code></div><div><p>Type for store slices.</p></div></div><div><div class="spec type" id="type-lca_error" class="anchored"><a href="#type-lca_error" class="anchor"></a><code><span class="keyword">type</span> lca_error = [ </code><table><tr id="type-lca_error.Max_depth_reached" class="anchored"><td class="def constructor"><a href="#type-lca_error.Max_depth_reached" class="anchor"></a><code>| </code><code>`Max_depth_reached</code></td></tr><tr id="type-lca_error.Too_many_lcas" class="anchored"><td class="def constructor"><a href="#type-lca_error.Too_many_lcas" class="anchor"></a><code>| </code><code>`Too_many_lcas</code></td></tr></table><code> ]</code></div><div><p>The type for errors associated with functions computing least common ancestors</p></div></div><div><div class="spec type" id="type-ff_error" class="anchored"><a href="#type-ff_error" class="anchor"></a><code><span class="keyword">type</span> ff_error = [ </code><table><tr id="type-ff_error.No_change" class="anchored"><td class="def constructor"><a href="#type-ff_error.No_change" class="anchor"></a><code>| </code><code>`No_change</code></td></tr><tr id="type-ff_error.Rejected" class="anchored"><td class="def constructor"><a href="#type-ff_error.Rejected" class="anchor"></a><code>| </code><code>`Rejected</code></td></tr><tr id="type-ff_error.lca_error" class="anchored"><td class="def type"><a href="#type-ff_error.lca_error" class="anchor"></a><code>| </code><code><a href="index.html#type-lca_error">lca_error</a></code></td></tr></table><code> ]</code></div><div><p>The type for errors for <code>fast_forward</code>.</p></div></div><div><div class="spec module" id="module-Repo" class="anchored"><a href="#module-Repo" class="anchor"></a><code><span class="keyword">module</span> <a href="Repo/index.html">Repo</a> : <span class="keyword">sig</span> ... <span class="keyword">end</span></code></div><div><p>Repositories.</p></div></div><div><div class="spec value" id="val-empty" class="anchored"><a href="#val-empty" class="anchor"></a><code><span class="keyword">val</span> empty : <a href="index.html#type-repo">repo</a> <span>&#45;&gt;</span> <span><a href="index.html#type-t">t</a> <a href="../../../../../lwt/Lwt/index.html#type-t">Lwt.t</a></span></code></div><div><p><code>empty repo</code> is a temporary, empty store. Becomes a normal temporary store after the first update.</p></div></div><div><div class="spec value" id="val-master" class="anchored"><a href="#val-master" class="anchor"></a><code><span class="keyword">val</span> master : <a href="index.html#type-repo">repo</a> <span>&#45;&gt;</span> <span><a href="index.html#type-t">t</a> <a href="../../../../../lwt/Lwt/index.html#type-t">Lwt.t</a></span></code></div><div><p><code>master repo</code> is a persistent store based on <code>r</code>'s master branch. This operation is cheap, can be repeated multiple times.</p></div></div><div><div class="spec value" id="val-of_branch" class="anchored"><a href="#val-of_branch" class="anchor"></a><code><span class="keyword">val</span> of_branch : <a href="index.html#type-repo">repo</a> <span>&#45;&gt;</span> <a href="index.html#type-branch">branch</a> <span>&#45;&gt;</span> <span><a href="index.html#type-t">t</a> <a href="../../../../../lwt/Lwt/index.html#type-t">Lwt.t</a></span></code></div><div><p><code>of_branch r name</code> is a persistent store based on the branch <code>name</code>. Similar to <code>master</code>, but use <code>name</code> instead <code>Branch</code>.S.master.</p></div></div><div><div class="spec value" id="val-of_commit" class="anchored"><a href="#val-of_commit" class="anchor"></a><code><span class="keyword">val</span> of_commit : <a href="index.html#type-commit">commit</a> <span>&#45;&gt;</span> <span><a href="index.html#type-t">t</a> <a href="../../../../../lwt/Lwt/index.html#type-t">Lwt.t</a></span></code></div><div><p><code>of_commit c</code> is a temporary store, based on the commit <code>c</code>.</p><p>Temporary stores do not have stable names: instead they can be addressed using the hash of the current commit. Temporary stores are similar to Git's detached heads. In a temporary store, all the operations are performed relative to the current head and update operations can modify the current head: the current stores's head will automatically become the new head obtained after performing the update.</p></div></div><div><div class="spec value" id="val-repo" class="anchored"><a href="#val-repo" class="anchor"></a><code><span class="keyword">val</span> repo : <a href="index.html#type-t">t</a> <span>&#45;&gt;</span> <a href="index.html#type-repo">repo</a></code></div><div><p><code>repo t</code> is the repository containing <code>t</code>.</p></div></div><div><div class="spec value" id="val-tree" class="anchored"><a href="#val-tree" class="anchor"></a><code><span class="keyword">val</span> tree : <a href="index.html#type-t">t</a> <span>&#45;&gt;</span> <span><a href="index.html#type-tree">tree</a> <a href="../../../../../lwt/Lwt/index.html#type-t">Lwt.t</a></span></code></div><div><p><code>tree t</code> is <code>t</code>'s current tree. Contents is not allowed at the root of the tree.</p></div></div><div class="spec module" id="module-Status" class="anchored"><a href="#module-Status" class="anchor"></a><code><span class="keyword">module</span> <a href="Status/index.html">Status</a> : <span class="keyword">sig</span> ... <span class="keyword">end</span></code></div><div><div class="spec value" id="val-status" class="anchored"><a href="#val-status" class="anchor"></a><code><span class="keyword">val</span> status : <a href="index.html#type-t">t</a> <span>&#45;&gt;</span> <a href="Status/index.html#type-t">Status.t</a></code></div><div><p><code>status t</code> is <code>t</code>'s status. It can either be a branch, a commit or empty.</p></div></div><div><div class="spec module" id="module-Head" class="anchored"><a href="#module-Head" class="anchor"></a><code><span class="keyword">module</span> <a href="Head/index.html">Head</a> : <span class="keyword">sig</span> ... <span class="keyword">end</span></code></div><div><p>Managing the store's heads.</p></div></div><div><div class="spec module" id="module-Hash" class="anchored"><a href="#module-Hash" class="anchor"></a><code><span class="keyword">module</span> <a href="Hash/index.html">Hash</a> : <span class="keyword">sig</span> ... <span class="keyword">end</span></code></div><div><p>Object hashes.</p></div></div><div><div class="spec module" id="module-Commit" class="anchored"><a href="#module-Commit" class="anchor"></a><code><span class="keyword">module</span> <a href="Commit/index.html">Commit</a> : <span class="keyword">sig</span> ... <span class="keyword">end</span></code></div><div><p><code>Commit</code> defines immutable objects to describe store updates.</p></div></div><div><div class="spec module" id="module-Contents" class="anchored"><a href="#module-Contents" class="anchor"></a><code><span class="keyword">module</span> <a href="Contents/index.html">Contents</a> : <span class="keyword">sig</span> ... <span class="keyword">end</span></code></div><div><p><code>Contents</code> provides base functions for the store's contents.</p></div></div><div><div class="spec module" id="module-Tree" class="anchored"><a href="#module-Tree" class="anchor"></a><code><span class="keyword">module</span> <a href="Tree/index.html">Tree</a> : <span class="keyword">sig</span> ... <span class="keyword">end</span></code></div><div><p>Managing store's trees.</p></div></div><h2 id="reads"><a href="#reads" class="anchor"></a>Reads</h2><div><div class="spec value" id="val-kind" class="anchored"><a href="#val-kind" class="anchor"></a><code><span class="keyword">val</span> kind : <a href="index.html#type-t">t</a> <span>&#45;&gt;</span> <a href="index.html#type-key">key</a> <span>&#45;&gt;</span> <span><span><span>[ `Contents <span>| `Node</span> ]</span> option</span> <a href="../../../../../lwt/Lwt/index.html#type-t">Lwt.t</a></span></code></div><div><p><code>kind</code> is <a href="Tree/index.html#val-kind"><code>Tree.kind</code></a> applied to <code>t</code>'s root tree.</p></div></div><div><div class="spec value" id="val-list" class="anchored"><a href="#val-list" class="anchor"></a><code><span class="keyword">val</span> list : <a href="index.html#type-t">t</a> <span>&#45;&gt;</span> <a href="index.html#type-key">key</a> <span>&#45;&gt;</span> <span><span><span>(<a href="index.html#type-step">step</a> * <span>[ `Contents <span>| `Node</span> ]</span>)</span> list</span> <a href="../../../../../lwt/Lwt/index.html#type-t">Lwt.t</a></span></code></div><div><p><code>list t</code> is <a href="Tree/index.html#val-list"><code>Tree.list</code></a> applied to <code>t</code>'s root tree.</p></div></div><div><div class="spec value" id="val-mem" class="anchored"><a href="#val-mem" class="anchor"></a><code><span class="keyword">val</span> mem : <a href="index.html#type-t">t</a> <span>&#45;&gt;</span> <a href="index.html#type-key">key</a> <span>&#45;&gt;</span> <span>bool <a href="../../../../../lwt/Lwt/index.html#type-t">Lwt.t</a></span></code></div><div><p><code>mem t</code> is <a href="Tree/index.html#val-mem"><code>Tree.mem</code></a> applied to <code>t</code>'s root tree.</p></div></div><div><div class="spec value" id="val-mem_tree" class="anchored"><a href="#val-mem_tree" class="anchor"></a><code><span class="keyword">val</span> mem_tree : <a href="index.html#type-t">t</a> <span>&#45;&gt;</span> <a href="index.html#type-key">key</a> <span>&#45;&gt;</span> <span>bool <a href="../../../../../lwt/Lwt/index.html#type-t">Lwt.t</a></span></code></div><div><p><code>mem_tree t</code> is <a href="Tree/index.html#val-mem_tree"><code>Tree.mem_tree</code></a> applied to <code>t</code>'s root tree.</p></div></div><div><div class="spec value" id="val-find_all" class="anchored"><a href="#val-find_all" class="anchor"></a><code><span class="keyword">val</span> find_all : <a href="index.html#type-t">t</a> <span>&#45;&gt;</span> <a href="index.html#type-key">key</a> <span>&#45;&gt;</span> <span><span><span>(<a href="index.html#type-contents">contents</a> * <a href="index.html#type-metadata">metadata</a>)</span> option</span> <a href="../../../../../lwt/Lwt/index.html#type-t">Lwt.t</a></span></code></div><div><p><code>find_all t</code> is <a href="Tree/index.html#val-find_all"><code>Tree.find_all</code></a> applied to <code>t</code>'s root tree.</p></div></div><div><div class="spec value" id="val-find" class="anchored"><a href="#val-find" class="anchor"></a><code><span class="keyword">val</span> find : <a href="index.html#type-t">t</a> <span>&#45;&gt;</span> <a href="index.html#type-key">key</a> <span>&#45;&gt;</span> <span><span><a href="index.html#type-contents">contents</a> option</span> <a href="../../../../../lwt/Lwt/index.html#type-t">Lwt.t</a></span></code></div><div><p><code>find t</code> is <a href="Tree/index.html#val-find"><code>Tree.find</code></a> applied to <code>t</code>'s root tree.</p></div></div><div><div class="spec value" id="val-get_all" class="anchored"><a href="#val-get_all" class="anchor"></a><code><span class="keyword">val</span> get_all : <a href="index.html#type-t">t</a> <span>&#45;&gt;</span> <a href="index.html#type-key">key</a> <span>&#45;&gt;</span> <span><span>(<a href="index.html#type-contents">contents</a> * <a href="index.html#type-metadata">metadata</a>)</span> <a href="../../../../../lwt/Lwt/index.html#type-t">Lwt.t</a></span></code></div><div><p><code>get_all t</code> is <a href="Tree/index.html#val-get_all"><code>Tree.get_all</code></a> applied on <code>t</code>'s root tree.</p></div></div><div><div class="spec value" id="val-get" class="anchored"><a href="#val-get" class="anchor"></a><code><span class="keyword">val</span> get : <a href="index.html#type-t">t</a> <span>&#45;&gt;</span> <a href="index.html#type-key">key</a> <span>&#45;&gt;</span> <span><a href="index.html#type-contents">contents</a> <a href="../../../../../lwt/Lwt/index.html#type-t">Lwt.t</a></span></code></div><div><p><code>get t</code> is <a href="Tree/index.html#val-get"><code>Tree.get</code></a> applied to <code>t</code>'s root tree.</p></div></div><div><div class="spec value" id="val-find_tree" class="anchored"><a href="#val-find_tree" class="anchor"></a><code><span class="keyword">val</span> find_tree : <a href="index.html#type-t">t</a> <span>&#45;&gt;</span> <a href="index.html#type-key">key</a> <span>&#45;&gt;</span> <span><span><a href="index.html#type-tree">tree</a> option</span> <a href="../../../../../lwt/Lwt/index.html#type-t">Lwt.t</a></span></code></div><div><p><code>find_tree t</code> is <a href="Tree/index.html#val-find_tree"><code>Tree.find_tree</code></a> applied to <code>t</code>'s root tree.</p></div></div><div><div class="spec value" id="val-get_tree" class="anchored"><a href="#val-get_tree" class="anchor"></a><code><span class="keyword">val</span> get_tree : <a href="index.html#type-t">t</a> <span>&#45;&gt;</span> <a href="index.html#type-key">key</a> <span>&#45;&gt;</span> <span><a href="index.html#type-tree">tree</a> <a href="../../../../../lwt/Lwt/index.html#type-t">Lwt.t</a></span></code></div><div><p><code>get_tree t k</code> is <a href="Tree/index.html#val-get_tree"><code>Tree.get_tree</code></a> applied to <code>t</code>'s root tree.</p></div></div><div><div class="spec value" id="val-hash" class="anchored"><a href="#val-hash" class="anchor"></a><code><span class="keyword">val</span> hash : <a href="index.html#type-t">t</a> <span>&#45;&gt;</span> <a href="index.html#type-key">key</a> <span>&#45;&gt;</span> <span><span><a href="index.html#type-hash">hash</a> option</span> <a href="../../../../../lwt/Lwt/index.html#type-t">Lwt.t</a></span></code></div><div><p><code>hash t k</code></p></div></div><h2 id="udpates"><a href="#udpates" class="anchor"></a>Udpates</h2><div><div class="spec type" id="type-write_error" class="anchored"><a href="#type-write_error" class="anchor"></a><code><span class="keyword">type</span> write_error = [ </code><table><tr id="type-write_error.Irmin.Merge.conflict" class="anchored"><td class="def type"><a href="#type-write_error.Irmin.Merge.conflict" class="anchor"></a><code>| </code><code><a href="../../../../../irmin/Irmin/Merge/index.html#type-conflict">Irmin.Merge.conflict</a></code></td></tr><tr id="type-write_error.Too_many_retries" class="anchored"><td class="def constructor"><a href="#type-write_error.Too_many_retries" class="anchor"></a><code>| </code><code>`Too_many_retries <span class="keyword">of</span> int</code></td></tr><tr id="type-write_error.Test_was" class="anchored"><td class="def constructor"><a href="#type-write_error.Test_was" class="anchor"></a><code>| </code><code>`Test_was <span class="keyword">of</span> <span><a href="index.html#type-tree">tree</a> option</span></code></td></tr></table><code> ]</code></div><div><p>The type for write errors.</p><ul><li>Merge conflict.</li><li>Concurrent transactions are competing to get the current operation committed and too many attemps have been tried (livelock).</li><li>A &quot;test and set&quot; operation has failed and the current value is <code>v</code> instead of the one we were waiting for.</li></ul></div></div><div><div class="spec value" id="val-set" class="anchored"><a href="#val-set" class="anchor"></a><code><span class="keyword">val</span> set : <span>?&#8288;retries:int</span> <span>&#45;&gt;</span> <span>?&#8288;allow_empty:bool</span> <span>&#45;&gt;</span> <span>?&#8288;parents:<span><a href="index.html#type-commit">commit</a> list</span></span> <span>&#45;&gt;</span> <span>info:<a href="../../../../../irmin/Irmin/Info/index.html#type-f">Irmin.Info.f</a></span> <span>&#45;&gt;</span> <a href="index.html#type-t">t</a> <span>&#45;&gt;</span> <a href="index.html#type-key">key</a> <span>&#45;&gt;</span> <a href="index.html#type-contents">contents</a> <span>&#45;&gt;</span> <span><span><span>(unit,Â <a href="index.html#type-write_error">write_error</a>)</span> <a href="../../../../../ocaml/Stdlib/index.html#type-result">Stdlib.result</a></span> <a href="../../../../../lwt/Lwt/index.html#type-t">Lwt.t</a></span></code></div><div><p><code>set t k ~info v</code> sets <code>k</code> to the value <code>v</code> in <code>t</code>. Discard any previous results but ensure that no operation is lost in the history.</p><p>This function always uses <a href="Metadata/index.html#val-default"><code>Metadata.default</code></a> as metadata. Use <a href="index.html#val-set_tree"><code>set_tree</code></a> with `<code>Contents (c, m)</code> for different ones.</p><p>The result is <code>Error `Too_many_retries</code> if the concurrent operations do not allow the operation to commit to the underlying storage layer (livelock).</p></div></div><div><div class="spec value" id="val-set_exn" class="anchored"><a href="#val-set_exn" class="anchor"></a><code><span class="keyword">val</span> set_exn : <span>?&#8288;retries:int</span> <span>&#45;&gt;</span> <span>?&#8288;allow_empty:bool</span> <span>&#45;&gt;</span> <span>?&#8288;parents:<span><a href="index.html#type-commit">commit</a> list</span></span> <span>&#45;&gt;</span> <span>info:<a href="../../../../../irmin/Irmin/Info/index.html#type-f">Irmin.Info.f</a></span> <span>&#45;&gt;</span> <a href="index.html#type-t">t</a> <span>&#45;&gt;</span> <a href="index.html#type-key">key</a> <span>&#45;&gt;</span> <a href="index.html#type-contents">contents</a> <span>&#45;&gt;</span> <span>unit <a href="../../../../../lwt/Lwt/index.html#type-t">Lwt.t</a></span></code></div><div><p><code>set_exn</code> is like <a href="index.html#val-set"><code>set</code></a> but raise <code>Failure _</code> instead of using a result type.</p></div></div><div><div class="spec value" id="val-set_tree" class="anchored"><a href="#val-set_tree" class="anchor"></a><code><span class="keyword">val</span> set_tree : <span>?&#8288;retries:int</span> <span>&#45;&gt;</span> <span>?&#8288;allow_empty:bool</span> <span>&#45;&gt;</span> <span>?&#8288;parents:<span><a href="index.html#type-commit">commit</a> list</span></span> <span>&#45;&gt;</span> <span>info:<a href="../../../../../irmin/Irmin/Info/index.html#type-f">Irmin.Info.f</a></span> <span>&#45;&gt;</span> <a href="index.html#type-t">t</a> <span>&#45;&gt;</span> <a href="index.html#type-key">key</a> <span>&#45;&gt;</span> <a href="index.html#type-tree">tree</a> <span>&#45;&gt;</span> <span><span><span>(unit,Â <a href="index.html#type-write_error">write_error</a>)</span> <a href="../../../../../ocaml/Stdlib/index.html#type-result">Stdlib.result</a></span> <a href="../../../../../lwt/Lwt/index.html#type-t">Lwt.t</a></span></code></div><div><p><code>set_tree</code> is like <a href="index.html#val-set"><code>set</code></a> but for trees.</p></div></div><div><div class="spec value" id="val-set_tree_exn" class="anchored"><a href="#val-set_tree_exn" class="anchor"></a><code><span class="keyword">val</span> set_tree_exn : <span>?&#8288;retries:int</span> <span>&#45;&gt;</span> <span>?&#8288;allow_empty:bool</span> <span>&#45;&gt;</span> <span>?&#8288;parents:<span><a href="index.html#type-commit">commit</a> list</span></span> <span>&#45;&gt;</span> <span>info:<a href="../../../../../irmin/Irmin/Info/index.html#type-f">Irmin.Info.f</a></span> <span>&#45;&gt;</span> <a href="index.html#type-t">t</a> <span>&#45;&gt;</span> <a href="index.html#type-key">key</a> <span>&#45;&gt;</span> <a href="index.html#type-tree">tree</a> <span>&#45;&gt;</span> <span>unit <a href="../../../../../lwt/Lwt/index.html#type-t">Lwt.t</a></span></code></div><div><p><code>set_tree</code> is like <a href="index.html#val-set_exn"><code>set_exn</code></a> but for trees.</p></div></div><div><div class="spec value" id="val-remove" class="anchored"><a href="#val-remove" class="anchor"></a><code><span class="keyword">val</span> remove : <span>?&#8288;retries:int</span> <span>&#45;&gt;</span> <span>?&#8288;allow_empty:bool</span> <span>&#45;&gt;</span> <span>?&#8288;parents:<span><a href="index.html#type-commit">commit</a> list</span></span> <span>&#45;&gt;</span> <span>info:<a href="../../../../../irmin/Irmin/Info/index.html#type-f">Irmin.Info.f</a></span> <span>&#45;&gt;</span> <a href="index.html#type-t">t</a> <span>&#45;&gt;</span> <a href="index.html#type-key">key</a> <span>&#45;&gt;</span> <span><span><span>(unit,Â <a href="index.html#type-write_error">write_error</a>)</span> <a href="../../../../../ocaml/Stdlib/index.html#type-result">Stdlib.result</a></span> <a href="../../../../../lwt/Lwt/index.html#type-t">Lwt.t</a></span></code></div><div><p><code>remove t ~info k</code> remove any bindings to <code>k</code> in <code>t</code>.</p><p>The result is <code>Error `Too_many_retries</code> if the concurrent operations do not allow the operation to commit to the underlying storage layer (livelock).</p></div></div><div><div class="spec value" id="val-remove_exn" class="anchored"><a href="#val-remove_exn" class="anchor"></a><code><span class="keyword">val</span> remove_exn : <span>?&#8288;retries:int</span> <span>&#45;&gt;</span> <span>?&#8288;allow_empty:bool</span> <span>&#45;&gt;</span> <span>?&#8288;parents:<span><a href="index.html#type-commit">commit</a> list</span></span> <span>&#45;&gt;</span> <span>info:<a href="../../../../../irmin/Irmin/Info/index.html#type-f">Irmin.Info.f</a></span> <span>&#45;&gt;</span> <a href="index.html#type-t">t</a> <span>&#45;&gt;</span> <a href="index.html#type-key">key</a> <span>&#45;&gt;</span> <span>unit <a href="../../../../../lwt/Lwt/index.html#type-t">Lwt.t</a></span></code></div><div><p><code>remove_exn</code> is like <a href="index.html#val-remove"><code>remove</code></a> but raise <code>Failure _</code> instead of a using result type.</p></div></div><div><div class="spec value" id="val-test_and_set" class="anchored"><a href="#val-test_and_set" class="anchor"></a><code><span class="keyword">val</span> test_and_set : <span>?&#8288;retries:int</span> <span>&#45;&gt;</span> <span>?&#8288;allow_empty:bool</span> <span>&#45;&gt;</span> <span>?&#8288;parents:<span><a href="index.html#type-commit">commit</a> list</span></span> <span>&#45;&gt;</span> <span>info:<a href="../../../../../irmin/Irmin/Info/index.html#type-f">Irmin.Info.f</a></span> <span>&#45;&gt;</span> <a href="index.html#type-t">t</a> <span>&#45;&gt;</span> <a href="index.html#type-key">key</a> <span>&#45;&gt;</span> <span>test:<span><a href="index.html#type-contents">contents</a> option</span></span> <span>&#45;&gt;</span> <span>set:<span><a href="index.html#type-contents">contents</a> option</span></span> <span>&#45;&gt;</span> <span><span><span>(unit,Â <a href="index.html#type-write_error">write_error</a>)</span> <a href="../../../../../ocaml/Stdlib/index.html#type-result">Stdlib.result</a></span> <a href="../../../../../lwt/Lwt/index.html#type-t">Lwt.t</a></span></code></div><div><p><code>test_and_set ~test ~set</code> is like <a href="index.html#val-set"><code>set</code></a> but it atomically checks that the tree is <code>test</code> before modifying it to <code>set</code>.</p><p>This function always uses <a href="Metadata/index.html#val-default"><code>Metadata.default</code></a> as metadata. Use <a href="index.html#val-test_and_set_tree"><code>test_and_set_tree</code></a> with `<code>Contents (c, m)</code> for different ones.</p><p>The result is <code>Error (`Test t)</code> if the current tree is <code>t</code> instead of <code>test</code>.</p><p>The result is <code>Error `Too_many_retries</code> if the concurrent operations do not allow the operation to commit to the underlying storage layer (livelock).</p></div></div><div><div class="spec value" id="val-test_and_set_exn" class="anchored"><a href="#val-test_and_set_exn" class="anchor"></a><code><span class="keyword">val</span> test_and_set_exn : <span>?&#8288;retries:int</span> <span>&#45;&gt;</span> <span>?&#8288;allow_empty:bool</span> <span>&#45;&gt;</span> <span>?&#8288;parents:<span><a href="index.html#type-commit">commit</a> list</span></span> <span>&#45;&gt;</span> <span>info:<a href="../../../../../irmin/Irmin/Info/index.html#type-f">Irmin.Info.f</a></span> <span>&#45;&gt;</span> <a href="index.html#type-t">t</a> <span>&#45;&gt;</span> <a href="index.html#type-key">key</a> <span>&#45;&gt;</span> <span>test:<span><a href="index.html#type-contents">contents</a> option</span></span> <span>&#45;&gt;</span> <span>set:<span><a href="index.html#type-contents">contents</a> option</span></span> <span>&#45;&gt;</span> <span>unit <a href="../../../../../lwt/Lwt/index.html#type-t">Lwt.t</a></span></code></div><div><p><code>test_and_set_exn</code> is like <a href="index.html#val-test_and_set"><code>test_and_set</code></a> but raise <code>Failure _</code> instead of using a result type.</p></div></div><div><div class="spec value" id="val-test_and_set_tree" class="anchored"><a href="#val-test_and_set_tree" class="anchor"></a><code><span class="keyword">val</span> test_and_set_tree : <span>?&#8288;retries:int</span> <span>&#45;&gt;</span> <span>?&#8288;allow_empty:bool</span> <span>&#45;&gt;</span> <span>?&#8288;parents:<span><a href="index.html#type-commit">commit</a> list</span></span> <span>&#45;&gt;</span> <span>info:<a href="../../../../../irmin/Irmin/Info/index.html#type-f">Irmin.Info.f</a></span> <span>&#45;&gt;</span> <a href="index.html#type-t">t</a> <span>&#45;&gt;</span> <a href="index.html#type-key">key</a> <span>&#45;&gt;</span> <span>test:<span><a href="index.html#type-tree">tree</a> option</span></span> <span>&#45;&gt;</span> <span>set:<span><a href="index.html#type-tree">tree</a> option</span></span> <span>&#45;&gt;</span> <span><span><span>(unit,Â <a href="index.html#type-write_error">write_error</a>)</span> <a href="../../../../../ocaml/Stdlib/index.html#type-result">Stdlib.result</a></span> <a href="../../../../../lwt/Lwt/index.html#type-t">Lwt.t</a></span></code></div><div><p><code>test_and_set_tree</code> is like <a href="index.html#val-test_and_set"><code>test_and_set</code></a> but for trees.</p></div></div><div><div class="spec value" id="val-test_and_set_tree_exn" class="anchored"><a href="#val-test_and_set_tree_exn" class="anchor"></a><code><span class="keyword">val</span> test_and_set_tree_exn : <span>?&#8288;retries:int</span> <span>&#45;&gt;</span> <span>?&#8288;allow_empty:bool</span> <span>&#45;&gt;</span> <span>?&#8288;parents:<span><a href="index.html#type-commit">commit</a> list</span></span> <span>&#45;&gt;</span> <span>info:<a href="../../../../../irmin/Irmin/Info/index.html#type-f">Irmin.Info.f</a></span> <span>&#45;&gt;</span> <a href="index.html#type-t">t</a> <span>&#45;&gt;</span> <a href="index.html#type-key">key</a> <span>&#45;&gt;</span> <span>test:<span><a href="index.html#type-tree">tree</a> option</span></span> <span>&#45;&gt;</span> <span>set:<span><a href="index.html#type-tree">tree</a> option</span></span> <span>&#45;&gt;</span> <span>unit <a href="../../../../../lwt/Lwt/index.html#type-t">Lwt.t</a></span></code></div><div><p><code>test_and_set_tree_exn</code> is like <a href="index.html#val-test_and_set_exn"><code>test_and_set_exn</code></a> but for trees.</p></div></div><div><div class="spec value" id="val-merge" class="anchored"><a href="#val-merge" class="anchor"></a><code><span class="keyword">val</span> merge : <span>?&#8288;retries:int</span> <span>&#45;&gt;</span> <span>?&#8288;allow_empty:bool</span> <span>&#45;&gt;</span> <span>?&#8288;parents:<span><a href="index.html#type-commit">commit</a> list</span></span> <span>&#45;&gt;</span> <span>info:<a href="../../../../../irmin/Irmin/Info/index.html#type-f">Irmin.Info.f</a></span> <span>&#45;&gt;</span> <span>old:<span><a href="index.html#type-contents">contents</a> option</span></span> <span>&#45;&gt;</span> <a href="index.html#type-t">t</a> <span>&#45;&gt;</span> <a href="index.html#type-key">key</a> <span>&#45;&gt;</span> <span><a href="index.html#type-contents">contents</a> option</span> <span>&#45;&gt;</span> <span><span><span>(unit,Â <a href="index.html#type-write_error">write_error</a>)</span> <a href="../../../../../ocaml/Stdlib/index.html#type-result">Stdlib.result</a></span> <a href="../../../../../lwt/Lwt/index.html#type-t">Lwt.t</a></span></code></div><div><p><code>merge ~old</code> is like <a href="index.html#val-set"><code>set</code></a> but merge the current tree and the new tree using <code>old</code> as ancestor in case of conflicts.</p><p>This function always uses <a href="Metadata/index.html#val-default"><code>Metadata.default</code></a> as metadata. Use <a href="index.html#val-merge_tree"><code>merge_tree</code></a> with `<code>Contents (c, m)</code> for different ones.</p><p>The result is <code>Error (`Conflict c)</code> if the merge failed with the conflict <code>c</code>.</p><p>The result is <code>Error `Too_many_retries</code> if the concurrent operations do not allow the operation to commit to the underlying storage layer (livelock).</p></div></div><div><div class="spec value" id="val-merge_exn" class="anchored"><a href="#val-merge_exn" class="anchor"></a><code><span class="keyword">val</span> merge_exn : <span>?&#8288;retries:int</span> <span>&#45;&gt;</span> <span>?&#8288;allow_empty:bool</span> <span>&#45;&gt;</span> <span>?&#8288;parents:<span><a href="index.html#type-commit">commit</a> list</span></span> <span>&#45;&gt;</span> <span>info:<a href="../../../../../irmin/Irmin/Info/index.html#type-f">Irmin.Info.f</a></span> <span>&#45;&gt;</span> <span>old:<span><a href="index.html#type-contents">contents</a> option</span></span> <span>&#45;&gt;</span> <a href="index.html#type-t">t</a> <span>&#45;&gt;</span> <a href="index.html#type-key">key</a> <span>&#45;&gt;</span> <span><a href="index.html#type-contents">contents</a> option</span> <span>&#45;&gt;</span> <span>unit <a href="../../../../../lwt/Lwt/index.html#type-t">Lwt.t</a></span></code></div><div><p><code>merge_exn</code> is like <a href="index.html#type-merge"><code>merge</code></a> but raise <code>Failure _</code> instead of using a result type.</p></div></div><div><div class="spec value" id="val-merge_tree" class="anchored"><a href="#val-merge_tree" class="anchor"></a><code><span class="keyword">val</span> merge_tree : <span>?&#8288;retries:int</span> <span>&#45;&gt;</span> <span>?&#8288;allow_empty:bool</span> <span>&#45;&gt;</span> <span>?&#8288;parents:<span><a href="index.html#type-commit">commit</a> list</span></span> <span>&#45;&gt;</span> <span>info:<a href="../../../../../irmin/Irmin/Info/index.html#type-f">Irmin.Info.f</a></span> <span>&#45;&gt;</span> <span>old:<span><a href="index.html#type-tree">tree</a> option</span></span> <span>&#45;&gt;</span> <a href="index.html#type-t">t</a> <span>&#45;&gt;</span> <a href="index.html#type-key">key</a> <span>&#45;&gt;</span> <span><a href="index.html#type-tree">tree</a> option</span> <span>&#45;&gt;</span> <span><span><span>(unit,Â <a href="index.html#type-write_error">write_error</a>)</span> <a href="../../../../../ocaml/Stdlib/index.html#type-result">Stdlib.result</a></span> <a href="../../../../../lwt/Lwt/index.html#type-t">Lwt.t</a></span></code></div><div><p><code>merge_tree</code> is like <a href="index.html#val-merge_tree"><code>merge_tree</code></a> but for trees.</p></div></div><div><div class="spec value" id="val-merge_tree_exn" class="anchored"><a href="#val-merge_tree_exn" class="anchor"></a><code><span class="keyword">val</span> merge_tree_exn : <span>?&#8288;retries:int</span> <span>&#45;&gt;</span> <span>?&#8288;allow_empty:bool</span> <span>&#45;&gt;</span> <span>?&#8288;parents:<span><a href="index.html#type-commit">commit</a> list</span></span> <span>&#45;&gt;</span> <span>info:<a href="../../../../../irmin/Irmin/Info/index.html#type-f">Irmin.Info.f</a></span> <span>&#45;&gt;</span> <span>old:<span><a href="index.html#type-tree">tree</a> option</span></span> <span>&#45;&gt;</span> <a href="index.html#type-t">t</a> <span>&#45;&gt;</span> <a href="index.html#type-key">key</a> <span>&#45;&gt;</span> <span><a href="index.html#type-tree">tree</a> option</span> <span>&#45;&gt;</span> <span>unit <a href="../../../../../lwt/Lwt/index.html#type-t">Lwt.t</a></span></code></div><div><p><code>merge_tree</code> is like <a href="index.html#val-merge_tree"><code>merge_tree</code></a> but for trees.</p></div></div><div><div class="spec value" id="val-with_tree" class="anchored"><a href="#val-with_tree" class="anchor"></a><code><span class="keyword">val</span> with_tree : <span>?&#8288;retries:int</span> <span>&#45;&gt;</span> <span>?&#8288;allow_empty:bool</span> <span>&#45;&gt;</span> <span>?&#8288;parents:<span><a href="index.html#type-commit">commit</a> list</span></span> <span>&#45;&gt;</span> <span>?&#8288;strategy:<span>[ `Set <span>| `Test_and_set</span> <span>| `Merge</span> ]</span></span> <span>&#45;&gt;</span> <span>info:<a href="../../../../../irmin/Irmin/Info/index.html#type-f">Irmin.Info.f</a></span> <span>&#45;&gt;</span> <a href="index.html#type-t">t</a> <span>&#45;&gt;</span> <a href="index.html#type-key">key</a> <span>&#45;&gt;</span> <span>(<span><a href="index.html#type-tree">tree</a> option</span> <span>&#45;&gt;</span> <span><span><a href="index.html#type-tree">tree</a> option</span> <a href="../../../../../lwt/Lwt/index.html#type-t">Lwt.t</a></span>)</span> <span>&#45;&gt;</span> <span><span><span>(unit,Â <a href="index.html#type-write_error">write_error</a>)</span> <a href="../../../../../ocaml/Stdlib/index.html#type-result">Stdlib.result</a></span> <a href="../../../../../lwt/Lwt/index.html#type-t">Lwt.t</a></span></code></div><div><p><code>with_tree t k ~info f</code> replaces <i>atomically</i> the subtree <code>v</code> under <code>k</code> in the store <code>t</code> by the contents of the tree <code>f v</code>, using the commit info <code>info ()</code>.</p><p>If <code>v = f v</code> and <code>allow_empty</code> is unset (default) then, the operation is a no-op.</p><p>If <code>v != f v</code> and no other changes happen concurrently, <code>f v</code> becomes the new subtree under <code>k</code>. If other changes happen concurrently to that operations, the semantics depend on the value of <code>strategy</code>:</p><ul><li>if <code>strategy = `Set</code>, use <a href="index.html#val-set"><code>set</code></a> and discard any concurrent updates to <code>k</code>.</li><li>if <code>strategy = `Test_and_set</code> (default), use <a href="index.html#val-test_and_set"><code>test_and_set</code></a> and ensure that no concurrent operations are updating <code>k</code>.</li><li>if <code>strategy = `Merge</code>, use <a href="index.html#type-merge"><code>merge</code></a> and ensure that concurrent updates and merged with the values present at the beginning of the transaction.</li></ul><p><b>Note:</b> Irmin transactions provides <a href="https://en.wikipedia.org/wiki/Snapshot_isolation">snapshot isolation</a> guarantees: reads and writes are isolated in every transaction, but only write conflicts are visible on commit.</p></div></div><div><div class="spec value" id="val-with_tree_exn" class="anchored"><a href="#val-with_tree_exn" class="anchor"></a><code><span class="keyword">val</span> with_tree_exn : <span>?&#8288;retries:int</span> <span>&#45;&gt;</span> <span>?&#8288;allow_empty:bool</span> <span>&#45;&gt;</span> <span>?&#8288;parents:<span><a href="index.html#type-commit">commit</a> list</span></span> <span>&#45;&gt;</span> <span>?&#8288;strategy:<span>[ `Set <span>| `Test_and_set</span> <span>| `Merge</span> ]</span></span> <span>&#45;&gt;</span> <span>info:<a href="../../../../../irmin/Irmin/Info/index.html#type-f">Irmin.Info.f</a></span> <span>&#45;&gt;</span> <a href="index.html#type-t">t</a> <span>&#45;&gt;</span> <a href="index.html#type-key">key</a> <span>&#45;&gt;</span> <span>(<span><a href="index.html#type-tree">tree</a> option</span> <span>&#45;&gt;</span> <span><span><a href="index.html#type-tree">tree</a> option</span> <a href="../../../../../lwt/Lwt/index.html#type-t">Lwt.t</a></span>)</span> <span>&#45;&gt;</span> <span>unit <a href="../../../../../lwt/Lwt/index.html#type-t">Lwt.t</a></span></code></div><div><p><code>with_tree_exn</code> is like <a href="index.html#val-with_tree"><code>with_tree</code></a> but raise <code>Failure _</code> instead of using a return type.</p></div></div><h2 id="clones"><a href="#clones" class="anchor"></a>Clones</h2><div><div class="spec value" id="val-clone" class="anchored"><a href="#val-clone" class="anchor"></a><code><span class="keyword">val</span> clone : <span>src:<a href="index.html#type-t">t</a></span> <span>&#45;&gt;</span> <span>dst:<a href="index.html#type-branch">branch</a></span> <span>&#45;&gt;</span> <span><a href="index.html#type-t">t</a> <a href="../../../../../lwt/Lwt/index.html#type-t">Lwt.t</a></span></code></div><div><p><code>clone ~src ~dst</code> makes <code>dst</code> points to <code>Head.get src</code>. <code>dst</code> is created if needed. Remove the current contents en <code>dst</code> if <code>src</code> is <a href="index.html#val-empty"><code>empty</code></a>.</p></div></div><h2 id="watches"><a href="#watches" class="anchor"></a>Watches</h2><div><div class="spec type" id="type-watch" class="anchored"><a href="#type-watch" class="anchor"></a><code><span class="keyword">type</span> watch</code></div><div><p>The type for store watches.</p></div></div><div><div class="spec value" id="val-watch" class="anchored"><a href="#val-watch" class="anchor"></a><code><span class="keyword">val</span> watch : <a href="index.html#type-t">t</a> <span>&#45;&gt;</span> <span>?&#8288;init:<a href="index.html#type-commit">commit</a></span> <span>&#45;&gt;</span> <span>(<span><a href="index.html#type-commit">commit</a> <a href="../../../../../irmin/Irmin/Diff/index.html#type-t">Irmin.Diff.t</a></span> <span>&#45;&gt;</span> <span>unit <a href="../../../../../lwt/Lwt/index.html#type-t">Lwt.t</a></span>)</span> <span>&#45;&gt;</span> <span><a href="index.html#type-watch">watch</a> <a href="../../../../../lwt/Lwt/index.html#type-t">Lwt.t</a></span></code></div><div><p><code>watch t f</code> calls <code>f</code> every time the contents of <code>t</code>'s head is updated.</p><p><b>Note:</b> even if <code>f</code> might skip some head updates, it will never be called concurrently: all consecutive calls to <code>f</code> are done in sequence, so we ensure that the previous one ended before calling the next one.</p></div></div><div><div class="spec value" id="val-watch_key" class="anchored"><a href="#val-watch_key" class="anchor"></a><code><span class="keyword">val</span> watch_key : <a href="index.html#type-t">t</a> <span>&#45;&gt;</span> <a href="index.html#type-key">key</a> <span>&#45;&gt;</span> <span>?&#8288;init:<a href="index.html#type-commit">commit</a></span> <span>&#45;&gt;</span> <span>(<span><span>(<a href="index.html#type-commit">commit</a> * <a href="index.html#type-tree">tree</a>)</span> <a href="../../../../../irmin/Irmin/Diff/index.html#type-t">Irmin.Diff.t</a></span> <span>&#45;&gt;</span> <span>unit <a href="../../../../../lwt/Lwt/index.html#type-t">Lwt.t</a></span>)</span> <span>&#45;&gt;</span> <span><a href="index.html#type-watch">watch</a> <a href="../../../../../lwt/Lwt/index.html#type-t">Lwt.t</a></span></code></div><div><p><code>watch_key t key f</code> calls <code>f</code> every time the <code>key</code>'s value is added, removed or updated. If the current branch is deleted, no signal is sent to the watcher.</p></div></div><div><div class="spec value" id="val-unwatch" class="anchored"><a href="#val-unwatch" class="anchor"></a><code><span class="keyword">val</span> unwatch : <a href="index.html#type-watch">watch</a> <span>&#45;&gt;</span> <span>unit <a href="../../../../../lwt/Lwt/index.html#type-t">Lwt.t</a></span></code></div><div><p><code>unwatch w</code> disable <code>w</code>. Return once the <code>w</code> is fully disabled.</p></div></div><h2 id="merges-and-common-ancestors."><a href="#merges-and-common-ancestors." class="anchor"></a>Merges and Common Ancestors.</h2><div><div class="spec type" id="type-merge" class="anchored"><a href="#type-merge" class="anchor"></a><code><span class="keyword">type</span> <span>'a merge</span> = <span>info:<a href="../../../../../irmin/Irmin/Info/index.html#type-f">Irmin.Info.f</a></span> <span>&#45;&gt;</span> <span>?&#8288;max_depth:int</span> <span>&#45;&gt;</span> <span>?&#8288;n:int</span> <span>&#45;&gt;</span> <span class="type-var">'a</span> <span>&#45;&gt;</span> <span><span><span>(unit,Â <a href="../../../../../irmin/Irmin/Merge/index.html#type-conflict">Irmin.Merge.conflict</a>)</span> <a href="../../../../../ocaml/Stdlib/index.html#type-result">Stdlib.result</a></span> <a href="../../../../../lwt/Lwt/index.html#type-t">Lwt.t</a></span></code></div><div><p>The type for merge functions.</p></div></div><div><div class="spec value" id="val-merge_into" class="anchored"><a href="#val-merge_into" class="anchor"></a><code><span class="keyword">val</span> merge_into : <span>into:<a href="index.html#type-t">t</a></span> <span>&#45;&gt;</span> <span><a href="index.html#type-t">t</a> <a href="index.html#type-merge">merge</a></span></code></div><div><p><code>merge_into ~into i t</code> merges <code>t</code>'s current branch into <code>x</code>'s current branch using the info <code>i</code>. After that operation, the two stores are still independent. Similar to <code>git merge &lt;branch&gt;</code>.</p></div></div><div><div class="spec value" id="val-merge_with_branch" class="anchored"><a href="#val-merge_with_branch" class="anchor"></a><code><span class="keyword">val</span> merge_with_branch : <a href="index.html#type-t">t</a> <span>&#45;&gt;</span> <span><a href="index.html#type-branch">branch</a> <a href="index.html#type-merge">merge</a></span></code></div><div><p>Same as <a href="index.html#type-merge"><code>merge</code></a> but with a branch ID.</p></div></div><div><div class="spec value" id="val-merge_with_commit" class="anchored"><a href="#val-merge_with_commit" class="anchor"></a><code><span class="keyword">val</span> merge_with_commit : <a href="index.html#type-t">t</a> <span>&#45;&gt;</span> <span><a href="index.html#type-commit">commit</a> <a href="index.html#type-merge">merge</a></span></code></div><div><p>Same as <a href="index.html#type-merge"><code>merge</code></a> but with a commit ID.</p></div></div><div><div class="spec value" id="val-lcas" class="anchored"><a href="#val-lcas" class="anchor"></a><code><span class="keyword">val</span> lcas : <span>?&#8288;max_depth:int</span> <span>&#45;&gt;</span> <span>?&#8288;n:int</span> <span>&#45;&gt;</span> <a href="index.html#type-t">t</a> <span>&#45;&gt;</span> <a href="index.html#type-t">t</a> <span>&#45;&gt;</span> <span><span><span>(<span><a href="index.html#type-commit">commit</a> list</span>,Â <a href="index.html#type-lca_error">lca_error</a>)</span> <a href="../../../../../ocaml/Stdlib/index.html#type-result">Stdlib.result</a></span> <a href="../../../../../lwt/Lwt/index.html#type-t">Lwt.t</a></span></code></div><div><p><code>lca ?max_depth ?n msg t1 t2</code> returns the collection of least common ancestors between the heads of <code>t1</code> and <code>t2</code> branches.</p><ul><li><code>max_depth</code> is the maximum depth of the exploration (default is <code>max_int</code>). Return <code>Error `Max_depth_reached</code> if this depth is exceeded.</li><li><code>n</code> is the maximum expected number of lcas. Stop the exploration as soon as <code>n</code> lcas are found. Return <code>Error `Too_many_lcas</code> if more <code>lcas</code> are found.</li></ul></div></div><div><div class="spec value" id="val-lcas_with_branch" class="anchored"><a href="#val-lcas_with_branch" class="anchor"></a><code><span class="keyword">val</span> lcas_with_branch : <a href="index.html#type-t">t</a> <span>&#45;&gt;</span> <span>?&#8288;max_depth:int</span> <span>&#45;&gt;</span> <span>?&#8288;n:int</span> <span>&#45;&gt;</span> <a href="index.html#type-branch">branch</a> <span>&#45;&gt;</span> <span><span><span>(<span><a href="index.html#type-commit">commit</a> list</span>,Â <a href="index.html#type-lca_error">lca_error</a>)</span> <a href="../../../../../ocaml/Stdlib/index.html#type-result">Stdlib.result</a></span> <a href="../../../../../lwt/Lwt/index.html#type-t">Lwt.t</a></span></code></div><div><p>Same as <a href="index.html#val-lcas"><code>lcas</code></a> but takes a branch ID as argument.</p></div></div><div><div class="spec value" id="val-lcas_with_commit" class="anchored"><a href="#val-lcas_with_commit" class="anchor"></a><code><span class="keyword">val</span> lcas_with_commit : <a href="index.html#type-t">t</a> <span>&#45;&gt;</span> <span>?&#8288;max_depth:int</span> <span>&#45;&gt;</span> <span>?&#8288;n:int</span> <span>&#45;&gt;</span> <a href="index.html#type-commit">commit</a> <span>&#45;&gt;</span> <span><span><span>(<span><a href="index.html#type-commit">commit</a> list</span>,Â <a href="index.html#type-lca_error">lca_error</a>)</span> <a href="../../../../../ocaml/Stdlib/index.html#type-result">Stdlib.result</a></span> <a href="../../../../../lwt/Lwt/index.html#type-t">Lwt.t</a></span></code></div><div><p>Same as <a href="index.html#val-lcas"><code>lcas</code></a> but takes a commit ID as argument.</p></div></div><h2 id="history"><a href="#history" class="anchor"></a>History</h2><div><div class="spec module" id="module-History" class="anchored"><a href="#module-History" class="anchor"></a><code><span class="keyword">module</span> <a href="History/index.html">History</a> : <a href="../../../../../ocamlgraph/Graph/Sig/module-type-P/index.html">Graph.Sig.P</a> <span class="keyword">with</span> <span class="keyword">type</span> <a href="../../../../../ocamlgraph/Graph/Sig/module-type-P/V/index.html#type-t">V.t</a> = <a href="index.html#type-commit">commit</a></code></div><div><p>An history is a DAG of heads.</p></div></div><div><div class="spec value" id="val-history" class="anchored"><a href="#val-history" class="anchor"></a><code><span class="keyword">val</span> history : <span>?&#8288;depth:int</span> <span>&#45;&gt;</span> <span>?&#8288;min:<span><a href="index.html#type-commit">commit</a> list</span></span> <span>&#45;&gt;</span> <span>?&#8288;max:<span><a href="index.html#type-commit">commit</a> list</span></span> <span>&#45;&gt;</span> <a href="index.html#type-t">t</a> <span>&#45;&gt;</span> <span><a href="History/index.html#type-t">History.t</a> <a href="../../../../../lwt/Lwt/index.html#type-t">Lwt.t</a></span></code></div><div><p><code>history ?depth ?min ?max t</code> is a view of the history of the store <code>t</code>, of depth at most <code>depth</code>, starting from the <code>t</code>'s head (or from <code>max</code> if the head is not set) and stopping at <code>min</code> if specified.</p></div></div><div><div class="spec value" id="val-last_modified" class="anchored"><a href="#val-last_modified" class="anchor"></a><code><span class="keyword">val</span> last_modified : <span>?&#8288;depth:int</span> <span>&#45;&gt;</span> <span>?&#8288;n:int</span> <span>&#45;&gt;</span> <a href="index.html#type-t">t</a> <span>&#45;&gt;</span> <a href="index.html#type-key">key</a> <span>&#45;&gt;</span> <span><span><a href="index.html#type-commit">commit</a> list</span> <a href="../../../../../lwt/Lwt/index.html#type-t">Lwt.t</a></span></code></div><div><p><code>last_modified ?number c k</code> is the list of the last <code>number</code> commits that modified <code>key</code>, in ascending order of date. <code>depth</code> is the maximum depth to be explored in the commit graph, if any. Default value for <code>number</code> is 1.</p></div></div><div><div class="spec module" id="module-Branch" class="anchored"><a href="#module-Branch" class="anchor"></a><code><span class="keyword">module</span> <a href="Branch/index.html">Branch</a> : <span class="keyword">sig</span> ... <span class="keyword">end</span></code></div><div><p>Manipulate branches.</p></div></div><div><div class="spec module" id="module-Key" class="anchored"><a href="#module-Key" class="anchor"></a><code><span class="keyword">module</span> Key = <a href="../../../../../irmin/Irmin/Path/String_list/index.html">Irmin.Path.String_list</a></code></div><div><p><code>Key</code> provides base functions for the stores's paths.</p></div></div><div><div class="spec module" id="module-Metadata" class="anchored"><a href="#module-Metadata" class="anchor"></a><code><span class="keyword">module</span> <a href="Metadata/index.html">Metadata</a> : <span class="keyword">sig</span> ... <span class="keyword">end</span></code></div><div><p><code>Metadata</code> provides base functions for node metadata.</p></div></div><h2 id="value-types"><a href="#value-types" class="anchor"></a>Value Types</h2><div><div class="spec value" id="val-step_t" class="anchored"><a href="#val-step_t" class="anchor"></a><code><span class="keyword">val</span> step_t : <span><a href="index.html#type-step">step</a> <a href="../../../../../irmin/Irmin/Type/index.html#type-t">Irmin.Type.t</a></span></code></div><div><p><code>step_t</code> is the value type for <a href="index.html#type-step"><code>step</code></a>.</p></div></div><div><div class="spec value" id="val-key_t" class="anchored"><a href="#val-key_t" class="anchor"></a><code><span class="keyword">val</span> key_t : <span><a href="index.html#type-key">key</a> <a href="../../../../../irmin/Irmin/Type/index.html#type-t">Irmin.Type.t</a></span></code></div><div><p><code>key_t</code> is the value type for <a href="index.html#type-key"><code>key</code></a>.</p></div></div><div><div class="spec value" id="val-metadata_t" class="anchored"><a href="#val-metadata_t" class="anchor"></a><code><span class="keyword">val</span> metadata_t : <span><a href="index.html#type-metadata">metadata</a> <a href="../../../../../irmin/Irmin/Type/index.html#type-t">Irmin.Type.t</a></span></code></div><div><p><code>metadata_t</code> is the value type for <a href="index.html#type-metadata"><code>metadata</code></a>.</p></div></div><div><div class="spec value" id="val-contents_t" class="anchored"><a href="#val-contents_t" class="anchor"></a><code><span class="keyword">val</span> contents_t : <span><a href="index.html#type-contents">contents</a> <a href="../../../../../irmin/Irmin/Type/index.html#type-t">Irmin.Type.t</a></span></code></div><div><p><code>contents_t</code> is the value type for <a href="index.html#type-contents"><code>contents</code></a>.</p></div></div><div><div class="spec value" id="val-node_t" class="anchored"><a href="#val-node_t" class="anchor"></a><code><span class="keyword">val</span> node_t : <span><a href="index.html#type-node">node</a> <a href="../../../../../irmin/Irmin/Type/index.html#type-t">Irmin.Type.t</a></span></code></div><div><p><code>node_t</code> is the value type for <a href="index.html#type-node"><code>node</code></a>.</p></div></div><div><div class="spec value" id="val-tree_t" class="anchored"><a href="#val-tree_t" class="anchor"></a><code><span class="keyword">val</span> tree_t : <span><a href="index.html#type-tree">tree</a> <a href="../../../../../irmin/Irmin/Type/index.html#type-t">Irmin.Type.t</a></span></code></div><div><p><code>tree_t</code> is the value type for <a href="index.html#val-tree"><code>tree</code></a>.</p></div></div><div><div class="spec value" id="val-commit_t" class="anchored"><a href="#val-commit_t" class="anchor"></a><code><span class="keyword">val</span> commit_t : <a href="index.html#type-repo">repo</a> <span>&#45;&gt;</span> <span><a href="index.html#type-commit">commit</a> <a href="../../../../../irmin/Irmin/Type/index.html#type-t">Irmin.Type.t</a></span></code></div><div><p><code>commit_t r</code> is the value type for <a href="index.html#type-commit"><code>commit</code></a>.</p></div></div><div><div class="spec value" id="val-branch_t" class="anchored"><a href="#val-branch_t" class="anchor"></a><code><span class="keyword">val</span> branch_t : <span><a href="index.html#type-branch">branch</a> <a href="../../../../../irmin/Irmin/Type/index.html#type-t">Irmin.Type.t</a></span></code></div><div><p><code>branch_t</code> is the value type for <a href="index.html#type-branch"><code>branch</code></a>.</p></div></div><div><div class="spec value" id="val-slice_t" class="anchored"><a href="#val-slice_t" class="anchor"></a><code><span class="keyword">val</span> slice_t : <span><a href="index.html#type-slice">slice</a> <a href="../../../../../irmin/Irmin/Type/index.html#type-t">Irmin.Type.t</a></span></code></div><div><p><code>slice_t</code> is the value type for <a href="index.html#type-slice"><code>slice</code></a>.</p></div></div><div><div class="spec value" id="val-kind_t" class="anchored"><a href="#val-kind_t" class="anchor"></a><code><span class="keyword">val</span> kind_t : <span><span>[ `Contents <span>| `Node</span> ]</span> <a href="../../../../../irmin/Irmin/Type/index.html#type-t">Irmin.Type.t</a></span></code></div><div><p><code>kind_t</code> is the value type for values returned by <a href="index.html#val-kind"><code>kind</code></a>.</p></div></div><div><div class="spec value" id="val-lca_error_t" class="anchored"><a href="#val-lca_error_t" class="anchor"></a><code><span class="keyword">val</span> lca_error_t : <span><a href="index.html#type-lca_error">lca_error</a> <a href="../../../../../irmin/Irmin/Type/index.html#type-t">Irmin.Type.t</a></span></code></div><div><p><code>lca_error_t</code> is the value type for <a href="index.html#type-lca_error"><code>lca_error</code></a>.</p></div></div><div><div class="spec value" id="val-ff_error_t" class="anchored"><a href="#val-ff_error_t" class="anchor"></a><code><span class="keyword">val</span> ff_error_t : <span><a href="index.html#type-ff_error">ff_error</a> <a href="../../../../../irmin/Irmin/Type/index.html#type-t">Irmin.Type.t</a></span></code></div><div><p><code>ff_error_t</code> is the value type for <a href="index.html#type-ff_error"><code>ff_error</code></a>.</p></div></div><div><div class="spec value" id="val-write_error_t" class="anchored"><a href="#val-write_error_t" class="anchor"></a><code><span class="keyword">val</span> write_error_t : <span><a href="index.html#type-write_error">write_error</a> <a href="../../../../../irmin/Irmin/Type/index.html#type-t">Irmin.Type.t</a></span></code></div><div><p><code>write_error_t</code> is the value type for <a href="index.html#type-write_error"><code>write_error</code></a>.</p></div></div><div><div class="spec module" id="module-Private" class="anchored"><a href="#module-Private" class="anchor"></a><code><span class="keyword">module</span> <a href="Private/index.html">Private</a> : <span class="keyword">sig</span> ... <span class="keyword">end</span> <span class="keyword">with</span> <span class="keyword">type</span> <a href="index.html#module-Private">Private</a>.Sync.endpoint = <a href="../../../../../git-unix/Git_unix/index.html#type-endpoint">Git_unix.endpoint</a></code></div><div><p>Private functions, which might be used by the backends.</p></div></div><div class="spec extension"><code><span class="keyword">type</span> <span class="xref-unresolved">Irmin__S.remote</span> += | <span class="extension">E</span> <span class="keyword">of</span> <a href="Private/Sync/index.html#type-endpoint">Private.Sync.endpoint</a></code></div><h3 id="converters-to-private-types"><a href="#converters-to-private-types" class="anchor"></a>Converters to private types</h3><div class="spec value" id="val-to_private_node" class="anchored"><a href="#val-to_private_node" class="anchor"></a><code><span class="keyword">val</span> to_private_node : <a href="index.html#type-node">node</a> <span>&#45;&gt;</span> <span><span><a href="Private/Node/index.html#type-value">Private.Node.value</a> option</span> <a href="../../../../../lwt/Lwt/index.html#type-t">Lwt.t</a></span></code></div><div class="spec value" id="val-of_private_node" class="anchored"><a href="#val-of_private_node" class="anchor"></a><code><span class="keyword">val</span> of_private_node : <a href="index.html#type-repo">repo</a> <span>&#45;&gt;</span> <a href="Private/Node/index.html#type-value">Private.Node.value</a> <span>&#45;&gt;</span> <a href="index.html#type-node">node</a></code></div><div><div class="spec value" id="val-to_private_commit" class="anchored"><a href="#val-to_private_commit" class="anchor"></a><code><span class="keyword">val</span> to_private_commit : <a href="index.html#type-commit">commit</a> <span>&#45;&gt;</span> <a href="Private/Commit/index.html#type-value">Private.Commit.value</a></code></div><div><p><code>to_private_commit c</code> is the private commit object associated with the commit <code>c</code>.</p></div></div><div><div class="spec value" id="val-of_private_commit" class="anchored"><a href="#val-of_private_commit" class="anchor"></a><code><span class="keyword">val</span> of_private_commit : <a href="index.html#type-repo">repo</a> <span>&#45;&gt;</span> <a href="Private/Commit/index.html#type-value">Private.Commit.value</a> <span>&#45;&gt;</span> <a href="index.html#type-commit">commit</a></code></div><div><p><code>of_private_commit r c</code> is the commit associated with the private commit object <code>c</code>.</p></div></div><div><div class="spec value" id="val-save_contents" class="anchored"><a href="#val-save_contents" class="anchor"></a><code><span class="keyword">val</span> save_contents : <span><span>[&gt; `Write ]</span> <a href="Private/Contents/index.html#type-t">Private.Contents.t</a></span> <span>&#45;&gt;</span> <a href="index.html#type-contents">contents</a> <span>&#45;&gt;</span> <span><a href="index.html#type-hash">hash</a> <a href="../../../../../lwt/Lwt/index.html#type-t">Lwt.t</a></span></code></div><div><p>Save a content into the database</p></div></div><div><div class="spec value" id="val-save_tree" class="anchored"><a href="#val-save_tree" class="anchor"></a><code><span class="keyword">val</span> save_tree : <span>?&#8288;clear:bool</span> <span>&#45;&gt;</span> <a href="index.html#type-repo">repo</a> <span>&#45;&gt;</span> <span><span>[&gt; `Write ]</span> <a href="Private/Contents/index.html#type-t">Private.Contents.t</a></span> <span>&#45;&gt;</span> <span><span>[ `Read <span>| `Write</span> ]</span> <a href="Private/Node/index.html#type-t">Private.Node.t</a></span> <span>&#45;&gt;</span> <a href="index.html#type-tree">tree</a> <span>&#45;&gt;</span> <span><a href="index.html#type-hash">hash</a> <a href="../../../../../lwt/Lwt/index.html#type-t">Lwt.t</a></span></code></div><div><p>Save a tree into the database. Does not do any reads. If <code>clear</code> is set (it is by default), the tree cache will be cleared after the save.</p></div></div></div></div></div></details></div></div></div><div><div class="spec value" id="val-git_commit" class="anchored"><a href="#val-git_commit" class="anchor"></a><code><span class="keyword">val</span> git_commit : <a href="Repo/index.html#type-t">Repo.t</a> <span>&#45;&gt;</span> <a href="index.html#type-commit">commit</a> <span>&#45;&gt;</span> <span><span><a href="../../../../../git/Git/Commit/Make/index.html#type-t">Git.Value.Commit.t</a> option</span> <a href="../../../../../lwt/Lwt/index.html#type-t">Lwt.t</a></span></code></div><div><p><code>git_commit repo h</code> is the commit corresponding to <code>h</code> in the repository <code>repo</code>.</p></div></div><div><div class="spec value" id="val-git_of_repo" class="anchored"><a href="#val-git_of_repo" class="anchor"></a><code><span class="keyword">val</span> git_of_repo : <a href="Repo/index.html#type-t">Repo.t</a> <span>&#45;&gt;</span> <a href="../G/index.html#type-t">Git.t</a></code></div><div><p><code>of_repo r</code> is the Git store associated to <code>r</code>.</p></div></div><div><div class="spec value" id="val-repo_of_git" class="anchored"><a href="#val-repo_of_git" class="anchor"></a><code><span class="keyword">val</span> repo_of_git : <span>?&#8288;head:<a href="../G/Reference/index.html#type-t">Git.Reference.t</a></span> <span>&#45;&gt;</span> <span>?&#8288;bare:bool</span> <span>&#45;&gt;</span> <span>?&#8288;lock:<a href="../../../../../lwt/Lwt_mutex/index.html#type-t">Lwt_mutex.t</a></span> <span>&#45;&gt;</span> <a href="../G/index.html#type-t">Git.t</a> <span>&#45;&gt;</span> <span><a href="Repo/index.html#type-t">Repo.t</a> <a href="../../../../../lwt/Lwt/index.html#type-t">Lwt.t</a></span></code></div><div><p><code>to_repo t</code> is the Irmin repository associated to <code>t</code>.</p></div></div></details></div></div></div><div class="spec value" id="val-remote" class="anchored"><a href="#val-remote" class="anchor"></a><code><span class="keyword">val</span> remote : <span>?&#8288;headers:<a href="../../../../../cohttp/Cohttp/Header/index.html#type-t">Cohttp.Header.t</a></span> <span>&#45;&gt;</span> string <span>&#45;&gt;</span> <a href="../../../../../irmin/Irmin/index.html#type-remote">Irmin.remote</a></code></div></div></body></html>