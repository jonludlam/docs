<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"><head><title>DELTA (git.Git.Pack.DELTA)</title><link rel="stylesheet" href="../../../../_odoc-theme/odoc.css"/><meta charset="utf-8"/><meta name="generator" content="odoc v1.1.1-1373-g2e7c1c75"/><meta name="viewport" content="width=device-width,initial-scale=1.0"/><script src="../../../../highlight.pack.js"></script><script>hljs.initHighlightingOnLoad();</script></head><body><nav><a href="../index.html">Up</a> – <a href="../../../index.html">git</a> &#x00BB; <a href="../../index.html">Git</a> &#x00BB; <a href="../index.html">Pack</a> &#x00BB; DELTA</nav><header><h1>Module type <code>Pack.DELTA</code></h1><p>This module is the engine to delta-ify Git objects together. The current implementation is a stop the world process which can not compute iteratively the delta-ification for some Git objects.</p><p>This process is the biggest process about memory consumption. Indeed, for each computation, we need to keep some Git objects to get the best diff between them. As Git, this process keeps 10 objects while we do the delta-ification for all - these objects are represented as inflated raw data in a <a href="../../../../cstruct/Cstruct/index.html#type-t"><code>Cstruct.t</code></a>.</p><p>However, if we try to delta-ify big objects (like your repository has the season 1 of Narcos), we should explose your memory (because we will load 10 movies in your memory). So the client can restrict the delta-ification by the weigth of the window (which contains your objects) instead by the number of objects inside.</p><p>Then, the final result does not keep Git objects loaded - the OCaml GC will delete them - but a lighter representation of the diff for each entry. And it's why, for the serialization of the PACK file, we re-ask (and re-load) your objects (however, in this last case, we don't need the ownership - see <code>expect</code>).</p></header><div class="content"><div class="spec module" id="module-Hash" class="anchored"><a href="#module-Hash" class="anchor"></a><code><span class="keyword">module</span> <a href="Hash/index.html">Hash</a> : <span class="keyword">sig</span> ... <span class="keyword">end</span></code></div><div class="spec module" id="module-Entry" class="anchored"><a href="#module-Entry" class="anchor"></a><code><span class="keyword">module</span> <a href="Entry/index.html">Entry</a> : <a href="../module-type-ENTRY/index.html">ENTRY</a> <span class="keyword">with</span> <span class="keyword">module</span> <a href="../module-type-ENTRY/Hash/index.html">Hash</a> := <a href="Hash/index.html">Hash</a></code></div><div><div class="spec type" id="type-t" class="anchored"><a href="#type-t" class="anchor"></a><code><span class="keyword">type</span> t = {</code><table><tr id="type-t.delta" class="anchored"><td class="def record field"><a href="#type-t.delta" class="anchor"></a><code><span class="keyword">mutable</span> delta : <a href="index.html#type-delta">delta</a>;</code></td></tr></table><code>}</code></div><div><p>The type of the delta-ification.</p></div></div><div class="spec type" id="type-delta" class="anchored"><a href="#type-delta" class="anchor"></a><code><span class="keyword">and</span> delta = </code><table><tr id="type-delta.Z" class="anchored"><td class="def variant constructor"><a href="#type-delta.Z" class="anchor"></a><code>| <span class="constructor">Z</span></code></td><td class="doc"><p>Means no delta-ification.</p></td></tr><tr id="type-delta.S" class="anchored"><td class="def variant constructor"><a href="#type-delta.S" class="anchor"></a><code>| <span class="constructor">S</span> <span class="keyword">of</span> {</code><table><tr id="type-delta.length" class="anchored"><td class="def record field"><a href="#type-delta.length" class="anchor"></a><code>length : int;</code></td><td class="doc"><p>Length of the PACK object.</p></td></tr><tr id="type-delta.depth" class="anchored"><td class="def record field"><a href="#type-delta.depth" class="anchor"></a><code>depth : int;</code></td><td class="doc"><p>Depth of the PACK object.</p></td></tr><tr id="type-delta.hunks" class="anchored"><td class="def record field"><a href="#type-delta.hunks" class="anchor"></a><code>hunks : <span><a href="../../../../duff/Duff/index.html#type-t">Duff.t</a> list</span>;</code></td><td class="doc"><p>Compression list.</p></td></tr><tr id="type-delta.src" class="anchored"><td class="def record field"><a href="#type-delta.src" class="anchor"></a><code>src : <a href="index.html#type-t">t</a>;</code></td><td class="doc"><p>Source.</p></td></tr><tr id="type-delta.src_length" class="anchored"><td class="def record field"><a href="#type-delta.src_length" class="anchor"></a><code>src_length : int64;</code></td><td class="doc"><p>Length of the source object.</p></td></tr><tr id="type-delta.src_hash" class="anchored"><td class="def record field"><a href="#type-delta.src_hash" class="anchor"></a><code>src_hash : <a href="Hash/index.html#type-t">Hash.t</a>;</code></td><td class="doc"><p>Hash of the source object.</p></td></tr></table><code>}</code></td><td class="doc"><p>Delta-ification with a description of the source.</p></td></tr></table></div><div><div class="spec type" id="type-error" class="anchored"><a href="#type-error" class="anchor"></a><code><span class="keyword">type</span> error = </code><table><tr id="type-error.Invalid_hash" class="anchored"><td class="def variant constructor"><a href="#type-error.Invalid_hash" class="anchor"></a><code>| <span class="constructor">Invalid_hash</span> <span class="keyword">of</span> <a href="Hash/index.html#type-t">Hash.t</a></code></td><td class="doc"><p>Appears when we have an invalid hash.</p></td></tr></table></div><div><p>The type of error.</p></div></div><div><div class="spec value" id="val-pp_error" class="anchored"><a href="#val-pp_error" class="anchor"></a><code><span class="keyword">val</span> pp_error : <span><a href="index.html#type-error">error</a> <a href="../../../../fmt/Fmt/index.html#type-t">Fmt.t</a></span></code></div><div><p>Pretty-printer for <a href="index.html#type-error"><code>error</code></a>.</p></div></div><div><div class="spec value" id="val-deltas" class="anchored"><a href="#val-deltas" class="anchor"></a><code><span class="keyword">val</span> deltas : <span>?&#8288;memory:bool</span> <span>&#45;&gt;</span> <span><a href="Entry/index.html#type-t">Entry.t</a> list</span> <span>&#45;&gt;</span> <span>(<a href="Hash/index.html#type-t">Hash.t</a> <span>&#45;&gt;</span> <span><span><a href="../../../../cstruct/Cstruct/index.html#type-t">Cstruct.t</a> option</span> <a href="../../../../lwt/Lwt/index.html#type-t">Lwt.t</a></span>)</span> <span>&#45;&gt;</span> <span>(<a href="Entry/index.html#type-t">Entry.t</a> <span>&#45;&gt;</span> bool)</span> <span>&#45;&gt;</span> int <span>&#45;&gt;</span> int <span>&#45;&gt;</span> <span><span><span>(<span><span>(<a href="Entry/index.html#type-t">Entry.t</a> * <a href="index.html#type-t">t</a>)</span> list</span>, <a href="index.html#type-error">error</a>)</span> <a href="../../../../ocaml/Stdlib/index.html#type-result">Stdlib.result</a></span> <a href="../../../../lwt/Lwt/index.html#type-t">Lwt.t</a></span></code></div><div><p><code>deltas ?memory lst getter tagger window depth</code>.</p><p>This is the main algorithm about the serialization of the git object in a PACK file. The purpose is to order and delta-ify entries.</p><p><code>getter</code> is a function to access to the real inflated raw of the git object requested by the hash. This function must allocate the raw (or let the ownership to this function). The algorithm takes the ownership anyway.</p><p><code>tagger</code> is a function to annotate an entry as preferred to serialize firstly.</p><p><code>window</code> corresponds to the number of how many object(s) we keep for the delta-ification or, if <code>memory</code> is <code>true</code>, how many byte(s) we keep for the delta-ification. The client can control the memory consumption of this algorithm precisely if he wants.</p><p><code>depth</code> is the maximum of the delta-ification allowed.</p><p>If you want to understand the algorithm, look the source code.</p></div></div></div></body></html>