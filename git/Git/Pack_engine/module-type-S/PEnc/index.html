<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"><head><title>PEnc (git.Git.Pack_engine.S.PEnc)</title><link rel="stylesheet" href="../../../../../_odoc-theme/odoc.css"/><meta charset="utf-8"/><meta name="generator" content="odoc v1.1.1-1373-g2e7c1c75"/><meta name="viewport" content="width=device-width,initial-scale=1.0"/><script src="../../../../../highlight.pack.js"></script><script>hljs.initHighlightingOnLoad();</script></head><body><nav><a href="../index.html">Up</a> – <a href="../../../../index.html">git</a> &#x00BB; <a href="../../../index.html">Git</a> &#x00BB; <a href="../../index.html">Pack_engine</a> &#x00BB; <a href="../index.html">S</a> &#x00BB; PEnc</nav><header><h1>Module <code>S.PEnc</code></h1></header><div class="content"><div class="spec module" id="module-Entry" class="anchored"><a href="#module-Entry" class="anchor"></a><code><span class="keyword">module</span> <a href="Entry/index.html">Entry</a> : <a href="../../../Pack/module-type-ENTRY/index.html">Pack.ENTRY</a> <span class="keyword">with</span> <span class="keyword">module</span> <a href="../../../Pack/module-type-ENTRY/Hash/index.html">Hash</a> := <a href="../Hash/index.html">Hash</a></code></div><div class="spec module" id="module-Delta" class="anchored"><a href="#module-Delta" class="anchor"></a><code><span class="keyword">module</span> <a href="Delta/index.html">Delta</a> : <a href="../../../Pack/module-type-DELTA/index.html">Pack.DELTA</a> <span class="keyword">with</span> <span class="keyword">module</span> <a href="../../../Pack/module-type-DELTA/Hash/index.html">Hash</a> := <a href="../Hash/index.html">Hash</a> <span class="keyword">and</span> <span class="keyword">module</span> <a href="../../../Pack/module-type-DELTA/Entry/index.html">Entry</a> := <a href="Entry/index.html">Entry</a></code></div><div><div class="spec module" id="module-Hunk" class="anchored"><a href="#module-Hunk" class="anchor"></a><code><span class="keyword">module</span> <a href="Hunk/index.html">Hunk</a> : <a href="../../../Pack/module-type-H/index.html">Pack.H</a> <span class="keyword">with</span> <span class="keyword">module</span> <a href="../../../Pack/module-type-H/Hash/index.html">Hash</a> := <a href="../Hash/index.html">Hash</a></code></div><div><p>The Map tree zhich zill represent the IDX file of the PACK stream.</p></div></div><div><div class="spec type" id="type-error" class="anchored"><a href="#type-error" class="anchor"></a><code><span class="keyword">type</span> error = </code><table><tr id="type-error.Deflate_error" class="anchored"><td class="def variant constructor"><a href="#type-error.Deflate_error" class="anchor"></a><code>| <span class="constructor">Deflate_error</span> <span class="keyword">of</span> <a href="../Deflate/index.html#type-error">Deflate.error</a></code></td><td class="doc"><p>Appears when the deflate algorithm raises an error.</p></td></tr><tr id="type-error.Invalid_hash" class="anchored"><td class="def variant constructor"><a href="#type-error.Invalid_hash" class="anchor"></a><code>| <span class="constructor">Invalid_hash</span> <span class="keyword">of</span> <a href="../Hash/index.html#type-t">Hash.t</a></code></td><td class="doc"><p>Appears when the hash requested does not exist.</p></td></tr></table></div><div><p>The type error.</p></div></div><div><div class="spec value" id="val-pp_error" class="anchored"><a href="#val-pp_error" class="anchor"></a><code><span class="keyword">val</span> pp_error : <span><a href="index.html#type-error">error</a> <a href="../../../../../fmt/Fmt/index.html#type-t">Fmt.t</a></span></code></div><div><p>Pretty-printer for <a href="index.html#type-error"><code>error</code></a>.</p></div></div><div><div class="spec type" id="type-t" class="anchored"><a href="#type-t" class="anchor"></a><code><span class="keyword">type</span> t</code></div><div><p>The type of the encoder.</p></div></div><div><div class="spec value" id="val-used_out" class="anchored"><a href="#val-used_out" class="anchor"></a><code><span class="keyword">val</span> used_out : <a href="index.html#type-t">t</a> <span>&#45;&gt;</span> int</code></div><div><p><code>used_out ŧ</code> returns how many byte <code>t</code> wrote in the current buffer noticed to the previous call of <a href="index.html#val-eval"><code>eval</code></a>.</p></div></div><div><div class="spec value" id="val-used_in" class="anchored"><a href="#val-used_in" class="anchor"></a><code><span class="keyword">val</span> used_in : <a href="index.html#type-t">t</a> <span>&#45;&gt;</span> int</code></div><div><p><code>used_in ŧ</code> returns how many byte <code>t</code> consumed in the current buffer noticed to the previous call of <a href="index.html#val-eval"><code>eval</code></a>.</p></div></div><div><div class="spec value" id="val-flush" class="anchored"><a href="#val-flush" class="anchor"></a><code><span class="keyword">val</span> flush : int <span>&#45;&gt;</span> int <span>&#45;&gt;</span> <a href="index.html#type-t">t</a> <span>&#45;&gt;</span> <a href="index.html#type-t">t</a></code></div><div><p><code>flush off len t</code> provides <code>t</code> with <code>len</code> bytes to write, starting at <code>off</code>. This byte range is written by calls to <a href="index.html#val-eval"><code>eval</code></a> with <code>t</code> until <code>`Flush</code> is returned.</p></div></div><div><div class="spec value" id="val-refill" class="anchored"><a href="#val-refill" class="anchor"></a><code><span class="keyword">val</span> refill : int <span>&#45;&gt;</span> int <span>&#45;&gt;</span> <a href="index.html#type-t">t</a> <span>&#45;&gt;</span> <a href="index.html#type-t">t</a></code></div><div><p><code>refill off len t</code> provides a new <code>t</code> with <code>len</code> bytes to read, starting at <code>off</code>. This byte range is read by calls to <a href="index.html#val-eval"><code>eval</code></a> with <code>t</code> until <code>`Await</code> is returned. The client should fill by the <a href="index.html#val-expect"><code>expect</code></a> git object.</p></div></div><div><div class="spec value" id="val-finish" class="anchored"><a href="#val-finish" class="anchor"></a><code><span class="keyword">val</span> finish : <a href="index.html#type-t">t</a> <span>&#45;&gt;</span> <a href="index.html#type-t">t</a></code></div><div><p><code>finish t</code> provides a new <code>t</code> which terminate to serialize the current Git object. The next call of <a href="index.html#val-eval"><code>eval</code></a> should not return an <code>`Await</code> value unless the output space is enough to start to serialize the next entry.</p></div></div><div><div class="spec value" id="val-expect" class="anchored"><a href="#val-expect" class="anchor"></a><code><span class="keyword">val</span> expect : <a href="index.html#type-t">t</a> <span>&#45;&gt;</span> <a href="../Hash/index.html#type-t">Hash.t</a></code></div><div><p><code>expect t</code> returns the object expected to the serialization. At this time, the serializer requests the inflated raw of this git object. The client is able to use it only when <a href="index.html#val-eval"><code>eval</code></a> return <code>`Await</code>. The encoder does not wqnt the ownership of the inflated raw, it access on it only as a read-only flow (that means, the src <a href="../../../../../cstruct/Cstruct/index.html#type-t"><code>Cstruct.t</code></a> could be physicaly the same.</p></div></div><div><div class="spec value" id="val-idx" class="anchored"><a href="#val-idx" class="anchor"></a><code><span class="keyword">val</span> idx : <a href="index.html#type-t">t</a> <span>&#45;&gt;</span> <span><span>(<a href="../../../../../checkseum/Checkseum/Crc32/index.html#type-t">Checkseum.Crc32.t</a> * int64)</span> <a href="../Hash/Map/index.html#type-t">Hash.Map.t</a></span></code></div><div><p><code>idx t</code> returns a <code>Map</code> tree which contains the CRC-32 checksum and the absolute offset for each Git object serialized. The client is able to use it only when <a href="index.html#val-eval"><code>eval</code></a> returns <code>`End</code>.</p></div></div><div><div class="spec value" id="val-default" class="anchored"><a href="#val-default" class="anchor"></a><code><span class="keyword">val</span> default : <a href="../../../../../cstruct/Cstruct/index.html#type-t">Cstruct.t</a> <span>&#45;&gt;</span> <span><span>(<a href="Entry/index.html#type-t">Entry.t</a> * <a href="Delta/index.html#type-t">Delta.t</a>)</span> list</span> <span>&#45;&gt;</span> <a href="index.html#type-t">t</a></code></div><div><p>Make a new encoder <a href="index.html#type-t"><code>t</code></a> of the PACK stream.</p><p><code>tmp</code> is a <code>Cstruct.t</code> used as an internal output of the Hunk Encoder <code>H</code>. We let the user to allocate the optimized length for this temporary buffer and we take the ownership (so, you don't use it to another computer).</p><p>Then, the client need to notice the ordered list of what he wants to serialize.</p></div></div><div><div class="spec value" id="val-eval" class="anchored"><a href="#val-eval" class="anchor"></a><code><span class="keyword">val</span> eval : <a href="../../../../../cstruct/Cstruct/index.html#type-t">Cstruct.t</a> <span>&#45;&gt;</span> <a href="../../../../../cstruct/Cstruct/index.html#type-t">Cstruct.t</a> <span>&#45;&gt;</span> <a href="index.html#type-t">t</a> <span>&#45;&gt;</span> <span>[ <span>`Flush of <a href="index.html#type-t">t</a></span> <span><span>| `Await</span> of <a href="index.html#type-t">t</a></span> <span><span>| `End</span> of <a href="index.html#type-t">t</a> * <a href="../Hash/index.html#type-t">Hash.t</a></span> <span><span>| `Error</span> of <a href="index.html#type-t">t</a> * <a href="index.html#type-error">error</a></span> ]</span></code></div><div><p><code>eval src t</code> is:</p><ul><li><code>`Await t</code> iff <code>t</code> needs more input storage. The client must use <a href="index.html#val-refill"><code>refill</code></a> to provide a new buffer and then call <a href="index.html#val-eval"><code>eval</code></a> with <code>`Await</code> until other value returned.</li><li><code>`Flush t</code> iff <code>t</code> needs more output storage. The client must use <a href="index.html#val-flush"><code>flush</code></a> to provide a new buffer and then call <a href="index.html#val-eval"><code>eval</code></a> with <code>`Flush</code> until other value returned.</li><li><code>`End (t, hash)</code> when <code>t</code> is done. Then, <code>t</code> sticks on this situation, the client can remove it. <code>hash</code> is the hash calculated of the PACK stream.</li><li><code>`Error (t, exn)</code> iff the encoder <code>t</code> meet an <a href="index.html#type-error"><code>error</code></a> <code>exn</code>. The encoder can't continue and sticks in this situation.</li></ul></div></div></div></body></html>