<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"><head><title>Command (core.Core.Command)</title><link rel="stylesheet" href="../../../_odoc-theme/odoc.css"/><meta charset="utf-8"/><meta name="generator" content="odoc v1.1.1-1373-g2e7c1c75"/><meta name="viewport" content="width=device-width,initial-scale=1.0"/><script src="../../../highlight.pack.js"></script><script>hljs.initHighlightingOnLoad();</script></head><body><nav><a href="../index.html">Up</a> – <a href="../../index.html">core</a> &#x00BB; <a href="../index.html">Core</a> &#x00BB; Command</nav><header><h1>Module <code>Core.Command</code></h1></header><div class="content"><aside></aside><div><div class="spec include"><div class="doc"><details open="open"><summary><span class="def"><code><span class="keyword">include</span> <span class="keyword">module</span> <span class="keyword">type</span> <span class="keyword">of</span> <a href="../../../core_kernel/Core_kernel/Command/index.html">Core_kernel.Command</a> <span class="keyword">with</span> <span class="keyword">module</span> <a href="../../../core_kernel/Core_kernel/Command/Shape/index.html">Shape</a> := <a href="../../../core_kernel/Core_kernel/Command/Shape/index.html">Core_kernel.Command.Shape</a> <span class="keyword">with</span> <span class="keyword">module</span> <a href="../../../core_kernel/Core_kernel/Command/Deprecated/index.html">Deprecated</a> := <a href="../../../core_kernel/Core_kernel/Command/Deprecated/index.html">Core_kernel.Command.Deprecated</a></code></span></summary><div><div class="spec include"><div class="doc"><div><div class="spec module" id="module-Arg_type" class="anchored"><a href="#module-Arg_type" class="anchor"></a><code><span class="keyword">module</span> <a href="Arg_type/index.html">Arg_type</a> : <span class="keyword">sig</span> ... <span class="keyword">end</span></code></div><div><p>Argument types.</p></div></div><div><div class="spec module" id="module-Flag" class="anchored"><a href="#module-Flag" class="anchor"></a><code><span class="keyword">module</span> <a href="Flag/index.html">Flag</a> : <span class="keyword">sig</span> ... <span class="keyword">end</span></code></div><div><p>Command-line flag specifications.</p></div></div><div><div class="spec module" id="module-Anons" class="anchored"><a href="#module-Anons" class="anchor"></a><code><span class="keyword">module</span> <a href="Anons/index.html">Anons</a> : <span class="keyword">sig</span> ... <span class="keyword">end</span></code></div><div><p>Anonymous command-line argument specification.</p></div></div><div><div class="spec module" id="module-Param" class="anchored"><a href="#module-Param" class="anchor"></a><code><span class="keyword">module</span> <a href="Param/index.html">Param</a> : <span class="keyword">sig</span> ... <span class="keyword">end</span></code></div><div><p>Command-line parameter specification.</p></div></div><div class="spec module" id="module-Let_syntax" class="anchored"><a href="#module-Let_syntax" class="anchor"></a><code><span class="keyword">module</span> <a href="Let_syntax/index.html">Let_syntax</a> : <span class="keyword">sig</span> ... <span class="keyword">end</span> <span class="keyword">with</span> <span class="keyword">type</span> <span>'a <a href="index.html#module-Let_syntax">Let_syntax</a>.t</span> := <span><span class="type-var">'a</span> <a href="Param/index.html#type-t">Param.t</a></span></code></div><div><div class="spec module" id="module-Spec" class="anchored"><a href="#module-Spec" class="anchor"></a><code><span class="keyword">module</span> <a href="Spec/index.html">Spec</a> : <span class="keyword">sig</span> ... <span class="keyword">end</span></code></div><div><p>The old interface for command-line specifications -- <b>Do Not Use</b>.</p></div></div><div><div class="spec type" id="type-t" class="anchored"><a href="#type-t" class="anchor"></a><code><span class="keyword">type</span> t</code></div><div><p>Commands which can be combined into a hierarchy of subcommands.</p></div></div><div class="spec type" id="type-basic_spec_command" class="anchored"><a href="#type-basic_spec_command" class="anchor"></a><code><span class="keyword">type</span> <span>('main, 'result) basic_spec_command</span> = <span>summary:<a href="../../../base/Base/String/index.html#type-t">Base.String.t</a></span> <span>&#45;&gt;</span> <span>?&#8288;readme:<span>(<a href="../../../base/Base/Unit/index.html#type-t">Base.Unit.t</a> <span>&#45;&gt;</span> <a href="../../../base/Base/String/index.html#type-t">Base.String.t</a>)</span></span> <span>&#45;&gt;</span> <span><span>(<span class="type-var">'main</span>, <a href="../../../base/Base/Unit/index.html#type-t">Base.Unit.t</a> <span>&#45;&gt;</span> <span class="type-var">'result</span>)</span> <a href="Spec/index.html#type-t">Spec.t</a></span> <span>&#45;&gt;</span> <span class="type-var">'main</span> <span>&#45;&gt;</span> <a href="index.html#type-t">t</a></code></div><div><div class="spec value" id="val-basic_spec" class="anchored"><a href="#val-basic_spec" class="anchor"></a><code><span class="keyword">val</span> basic_spec : <span><span>(<span class="type-var">'main</span>, <a href="../../../base/Base/Unit/index.html#type-t">Base.Unit.t</a>)</span> <a href="index.html#type-basic_spec_command">basic_spec_command</a></span></code></div><div><p><code>basic_spec ~summary ?readme spec main</code> is a basic command that executes a function <code>main</code> which is passed parameters parsed from the command line according to <code>spec</code>. <code>summary</code> is to contain a short one-line description of its behavior. <code>readme</code> is to contain any longer description of its behavior that will go on that command's help screen.</p></div></div><div class="spec type" id="type-basic_command" class="anchored"><a href="#type-basic_command" class="anchor"></a><code><span class="keyword">type</span> <span>'result basic_command</span> = <span>summary:<a href="../../../base/Base/String/index.html#type-t">Base.String.t</a></span> <span>&#45;&gt;</span> <span>?&#8288;readme:<span>(<a href="../../../base/Base/Unit/index.html#type-t">Base.Unit.t</a> <span>&#45;&gt;</span> <a href="../../../base/Base/String/index.html#type-t">Base.String.t</a>)</span></span> <span>&#45;&gt;</span> <span><span>(<a href="../../../base/Base/Unit/index.html#type-t">Base.Unit.t</a> <span>&#45;&gt;</span> <span class="type-var">'result</span>)</span> <a href="Param/index.html#type-t">Param.t</a></span> <span>&#45;&gt;</span> <a href="index.html#type-t">t</a></code></div><div><div class="spec value" id="val-basic" class="anchored"><a href="#val-basic" class="anchor"></a><code><span class="keyword">val</span> basic : <span><a href="../../../base/Base/Unit/index.html#type-t">Base.Unit.t</a> <a href="index.html#type-basic_command">basic_command</a></span></code></div><div><p>Same general behavior as <code>basic_spec</code>, but takes a command line specification built up using <code>Params</code> instead of <code>Spec</code>.</p></div></div><div><div class="spec value" id="val-group" class="anchored"><a href="#val-group" class="anchor"></a><code><span class="keyword">val</span> group : <span>summary:<a href="../../../base/Base/String/index.html#type-t">Base.String.t</a></span> <span>&#45;&gt;</span> <span>?&#8288;readme:<span>(<a href="../../../base/Base/Unit/index.html#type-t">Base.Unit.t</a> <span>&#45;&gt;</span> <a href="../../../base/Base/String/index.html#type-t">Base.String.t</a>)</span></span> <span>&#45;&gt;</span> <span>?&#8288;preserve_subcommand_order:<a href="../../../base/Base/Unit/index.html#type-t">Base.Unit.t</a></span> <span>&#45;&gt;</span> <span>?&#8288;body:<span>(<span>path:<span><a href="../../../base/Base/String/index.html#type-t">Base.String.t</a> <a href="../../../base/Base/List/index.html#type-t">Base.List.t</a></span></span> <span>&#45;&gt;</span> <a href="../../../base/Base/Unit/index.html#type-t">Base.Unit.t</a>)</span></span> <span>&#45;&gt;</span> <span><span>(<a href="../../../base/Base/String/index.html#type-t">Base.String.t</a> * <a href="index.html#type-t">t</a>)</span> <a href="../../../base/Base/List/index.html#type-t">Base.List.t</a></span> <span>&#45;&gt;</span> <a href="index.html#type-t">t</a></code></div><div><p><code>group ~summary subcommand_alist</code> is a compound command with named subcommands, as found in <code>subcommand_alist</code>. <code>summary</code> is to contain a short one-line description of the command group. <code>readme</code> is to contain any longer description of its behavior that will go on that command's help screen.</p><p>NOTE: subcommand names containing underscores will be rejected; use dashes instead.</p><p><code>body</code> is called when no additional arguments are passed -- in particular, when no subcommand is passed. Its <code>path</code> argument is the subcommand path by which the group command was reached.</p></div></div><div><div class="spec value" id="val-lazy_group" class="anchored"><a href="#val-lazy_group" class="anchor"></a><code><span class="keyword">val</span> lazy_group : <span>summary:<a href="../../../base/Base/String/index.html#type-t">Base.String.t</a></span> <span>&#45;&gt;</span> <span>?&#8288;readme:<span>(<a href="../../../base/Base/Unit/index.html#type-t">Base.Unit.t</a> <span>&#45;&gt;</span> <a href="../../../base/Base/String/index.html#type-t">Base.String.t</a>)</span></span> <span>&#45;&gt;</span> <span>?&#8288;preserve_subcommand_order:<a href="../../../base/Base/Unit/index.html#type-t">Base.Unit.t</a></span> <span>&#45;&gt;</span> <span>?&#8288;body:<span>(<span>path:<span><a href="../../../base/Base/String/index.html#type-t">Base.String.t</a> <a href="../../../base/Base/List/index.html#type-t">Base.List.t</a></span></span> <span>&#45;&gt;</span> <a href="../../../base/Base/Unit/index.html#type-t">Base.Unit.t</a>)</span></span> <span>&#45;&gt;</span> <span><span><span>(<a href="../../../base/Base/String/index.html#type-t">Base.String.t</a> * <a href="index.html#type-t">t</a>)</span> <a href="../../../base/Base/List/index.html#type-t">Base.List.t</a></span> <a href="../../../core_kernel/Core_kernel/Lazy/index.html#type-t">Core_kernel.Lazy.t</a></span> <span>&#45;&gt;</span> <a href="index.html#type-t">t</a></code></div><div><p><code>lazy_group</code> is the same as <code>group</code>, except that the list of subcommands may be generated lazily.</p></div></div><div><div class="spec value" id="val-exec" class="anchored"><a href="#val-exec" class="anchor"></a><code><span class="keyword">val</span> exec : <span>summary:<a href="../../../base/Base/String/index.html#type-t">Base.String.t</a></span> <span>&#45;&gt;</span> <span>?&#8288;readme:<span>(<a href="../../../base/Base/Unit/index.html#type-t">Base.Unit.t</a> <span>&#45;&gt;</span> <a href="../../../base/Base/String/index.html#type-t">Base.String.t</a>)</span></span> <span>&#45;&gt;</span> <span>?&#8288;child_subcommand:<span><a href="../../../base/Base/String/index.html#type-t">Base.String.t</a> <a href="../../../base/Base/List/index.html#type-t">Base.List.t</a></span></span> <span>&#45;&gt;</span> <span>path_to_exe:<span>[ <span>`Absolute of <a href="../../../base/Base/String/index.html#type-t">Base.String.t</a></span> <span><span>| `Relative_to_argv0</span> of <a href="../../../base/Base/String/index.html#type-t">Base.String.t</a></span> <span><span>| `Relative_to_me</span> of <a href="../../../base/Base/String/index.html#type-t">Base.String.t</a></span> ]</span></span> <span>&#45;&gt;</span> <a href="../../../base/Base/Unit/index.html#type-t">Base.Unit.t</a> <span>&#45;&gt;</span> <a href="index.html#type-t">t</a></code></div><div><p><code>exec ~summary ~path_to_exe</code> runs <code>exec</code> on the executable at <code>path_to_exe</code>. If <code>path_to_exe</code> is <code>`Absolute path</code> then <code>path</code> is executed without any further qualification. If it is <code>`Relative_to_me path</code> then <code>Filename.dirname
      Sys.executable_name ^ &quot;/&quot; ^ path</code> is executed instead. All of the usual caveats about <code>Sys.executable_name</code> apply: specifically, it may only return an absolute path in Linux. On other operating systems it will return <code>Sys.argv.(0)</code>. If it is <code>`Relative_to_argv0 path</code> then <code>Sys.argv.(0) ^ &quot;/&quot; ^ path</code> is executed.</p><p>The <code>child_subcommand</code> argument allows referencing a subcommand one or more levels below the top-level of the child executable. It should <em>not</em> be used to pass flags or anonymous arguments to the child.</p><p>Care has been taken to support nesting multiple executables built with Command. In particular, recursive help and autocompletion should work as expected.</p><p>NOTE: Non-Command executables can be used with this function but will still be executed when <code>help -recursive</code> is called or autocompletion is attempted (despite the fact that neither will be particularly helpful in this case). This means that if you have a shell script called &quot;reboot-everything.sh&quot; that takes no arguments and reboots everything no matter how it is called, you shouldn't use it with <code>exec</code>.</p><p>Additionally, no loop detection is attempted, so if you nest an executable within itself, <code>help -recursive</code> and autocompletion will hang forever (although actually running the subcommand will work).</p></div></div><div><div class="spec value" id="val-of_lazy" class="anchored"><a href="#val-of_lazy" class="anchor"></a><code><span class="keyword">val</span> of_lazy : <span><a href="index.html#type-t">t</a> <a href="../../../core_kernel/Core_kernel/Lazy/index.html#type-t">Core_kernel.Lazy.t</a></span> <span>&#45;&gt;</span> <a href="index.html#type-t">t</a></code></div><div><p><code>of_lazy thunk</code> constructs a lazy command that is forced only when necessary to run it or extract its shape.</p></div></div><div><div class="spec value" id="val-summary" class="anchored"><a href="#val-summary" class="anchor"></a><code><span class="keyword">val</span> summary : <a href="index.html#type-t">t</a> <span>&#45;&gt;</span> <a href="../../../base/Base/String/index.html#type-t">Base.String.t</a></code></div><div><p>Extracts the summary string for a command.</p></div></div><div><div class="spec value" id="val-exit" class="anchored"><a href="#val-exit" class="anchor"></a><code><span class="keyword">val</span> exit : <a href="../../../base/Base/Int/index.html#type-t">Base.Int.t</a> <span>&#45;&gt;</span> <span class="type-var">_</span></code></div><div><p>call this instead of <code>Core.exit</code> if in command-related code that you want to run in tests. For example, in the body of <code>Command.Param.no_arg_abort</code></p></div></div></div></div></div></details></div></div></div><div><div class="spec value" id="val-run" class="anchored"><a href="#val-run" class="anchor"></a><code><span class="keyword">val</span> run : <span>?&#8288;verbose_on_parse_error:bool</span> <span>&#45;&gt;</span> <span>?&#8288;version:string</span> <span>&#45;&gt;</span> <span>?&#8288;build_info:string</span> <span>&#45;&gt;</span> <span>?&#8288;argv:<span>string list</span></span> <span>&#45;&gt;</span> <span>?&#8288;extend:<span>(<span>string list</span> <span>&#45;&gt;</span> <span>string list</span>)</span></span> <span>&#45;&gt;</span> <a href="index.html#type-t">t</a> <span>&#45;&gt;</span> unit</code></div><div><p>Runs a command against <code>Sys.argv</code>, or <code>argv</code> if it is specified.</p><p><code>extend</code> can be used to add extra command line arguments to basic subcommands of the command. <code>extend</code> will be passed the (fully expanded) path to a command, and its output will be appended to the list of arguments being processed. For example, suppose a program like this is compiled into <code>exe</code>:</p><pre><code>let bar = Command.basic ___
let foo = Command.group ~summary:___ [&quot;bar&quot;, bar]
let main = Command.group ~summary:___ [&quot;foo&quot;, foo]
let () = Command.run ~extend:(fun _ -&gt; [&quot;-baz&quot;]) main</code></pre><p>Then if a user ran <code>exe f b</code>, <code>extend</code> would be passed <code>[&quot;foo&quot;; &quot;bar&quot;]</code> and <code>&quot;-baz&quot;</code> would be appended to the command line for processing by <code>bar</code>. This can be used to add a default flags section to a user config file.</p><p><code>verbose_on_parse_error</code> controls whether to print a line suggesting the user try the &quot;-help&quot; flag when an exception is raised while parsing the arguments. By default it is true.</p></div></div><div class="spec module" id="module-Path" class="anchored"><a href="#module-Path" class="anchor"></a><code><span class="keyword">module</span> <a href="Path/index.html">Path</a> : <span class="keyword">sig</span> ... <span class="keyword">end</span></code></div><div class="spec module" id="module-Shape" class="anchored"><a href="#module-Shape" class="anchor"></a><code><span class="keyword">module</span> <a href="Shape/index.html">Shape</a> : <span class="keyword">sig</span> ... <span class="keyword">end</span></code></div><div><div class="spec value" id="val-shape" class="anchored"><a href="#val-shape" class="anchor"></a><code><span class="keyword">val</span> shape : <a href="index.html#type-t">t</a> <span>&#45;&gt;</span> <a href="Shape/index.html#type-t">Shape.t</a></code></div><div><p>Exposes the shape of a command.</p></div></div><div><div class="spec module" id="module-Deprecated" class="anchored"><a href="#module-Deprecated" class="anchor"></a><code><span class="keyword">module</span> <a href="Deprecated/index.html">Deprecated</a> : <span class="keyword">sig</span> ... <span class="keyword">end</span></code></div><div><p><code>Deprecated</code> should be used only by <code>Deprecated_command</code>. At some point it will go away.</p></div></div></div></body></html>