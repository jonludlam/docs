<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"><head><title>Gntshr (xen-gnt.Gnt.Gntshr)</title><link rel="stylesheet" href="../../../_odoc-theme/odoc.css"/><meta charset="utf-8"/><meta name="generator" content="odoc v1.1.1-1373-g2e7c1c75"/><meta name="viewport" content="width=device-width,initial-scale=1.0"/><script src="../../../highlight.pack.js"></script><script>hljs.initHighlightingOnLoad();</script></head><body><nav><a href="../index.html">Up</a> â€“ <a href="../../index.html">xen-gnt</a> &#x00BB; <a href="../index.html">Gnt</a> &#x00BB; Gntshr</nav><header><h1>Module <code>Gnt.Gntshr</code></h1></header><nav class="toc"><ul><li><a href="#low-level-interface">Low-level interface</a></li></ul></nav><div class="content"><div><div class="spec type" id="type-interface" class="anchored"><a href="#type-interface" class="anchor"></a><code><span class="keyword">type</span> interface</code></div><div><p>A connection to the gntshr device, needed for sharing/unmapping</p></div></div><div><div class="spec value" id="val-interface_open" class="anchored"><a href="#val-interface_open" class="anchor"></a><code><span class="keyword">val</span> interface_open : unit <span>&#45;&gt;</span> <a href="index.html#type-interface">interface</a></code></div><div><p>Open a connection to the gntshr device. This must be done before any calls to share or unmap.</p></div></div><div><div class="spec value" id="val-interface_close" class="anchored"><a href="#val-interface_close" class="anchor"></a><code><span class="keyword">val</span> interface_close : <a href="index.html#type-interface">interface</a> <span>&#45;&gt;</span> unit</code></div><div><p>Close a connection to the gntshr device. Any future calls to share or unmap will fail.</p></div></div><div><div class="spec type" id="type-share" class="anchored"><a href="#type-share" class="anchor"></a><code><span class="keyword">type</span> share = {</code><table><tr id="type-share.refs" class="anchored"><td class="def record field"><a href="#type-share.refs" class="anchor"></a><code>refs : <span><a href="../index.html#type-gntref">gntref</a> list</span>;</code></td><td class="doc"><p>List of grant references which have been shared with a foreign domain.</p></td></tr><tr id="type-share.mapping" class="anchored"><td class="def record field"><a href="#type-share.mapping" class="anchor"></a><code>mapping : <a href="../../../io-page/Io_page/index.html#type-t">Io_page.t</a>;</code></td><td class="doc"><p>Mapping of the shared memory.</p></td></tr></table><code>}</code></div><div><p>When sharing a number of pages with another domain, we receive back both the list of grant references shared and actually mapped page(s). The foreign domain can map the same shared memory, after being notified (e.g. via xenstore) of our domid and list of references.</p></div></div><div><div class="spec value" id="val-share_pages_exn" class="anchored"><a href="#val-share_pages_exn" class="anchor"></a><code><span class="keyword">val</span> share_pages_exn : <a href="index.html#type-interface">interface</a> <span>&#45;&gt;</span> int <span>&#45;&gt;</span> int <span>&#45;&gt;</span> bool <span>&#45;&gt;</span> <a href="index.html#type-share">share</a></code></div><div><p><code>share_pages_exn if domid count writable</code> shares <code>count</code> pages with foreign domain <code>domid</code>. <code>writable</code> determines whether or not the foreign domain can write to the shared memory.</p></div></div><div><div class="spec value" id="val-share_pages" class="anchored"><a href="#val-share_pages" class="anchor"></a><code><span class="keyword">val</span> share_pages : <a href="index.html#type-interface">interface</a> <span>&#45;&gt;</span> int <span>&#45;&gt;</span> int <span>&#45;&gt;</span> bool <span>&#45;&gt;</span> <span><a href="index.html#type-share">share</a> option</span></code></div><div><p><code>share_pages if domid count writable</code> shares <code>count</code> pages with foreign domain <code>domid</code>. <code>writable</code> determines whether or not the foreign domain can write to the shared memory. On error this function returns None. Diagnostic details will be logged.</p></div></div><div><div class="spec value" id="val-munmap_exn" class="anchored"><a href="#val-munmap_exn" class="anchor"></a><code><span class="keyword">val</span> munmap_exn : <a href="index.html#type-interface">interface</a> <span>&#45;&gt;</span> <a href="index.html#type-share">share</a> <span>&#45;&gt;</span> unit</code></div><div><p>Unmap a single mapping (which may involve multiple grants)</p></div></div><h3 id="low-level-interface"><a href="#low-level-interface" class="anchor"></a>Low-level interface</h3><aside><p>This is is only available in kernelspace and is deprecated. For low-level access, use mirage-xen's OS.Xen API instead.</p></aside><div><div class="spec exception" id="exception-Interface_unavailable" class="anchored"><a href="#exception-Interface_unavailable" class="anchor"></a><code><span class="keyword">exception</span> <span class="exception">Interface_unavailable</span></code></div><div><p>Raised when the low-level grant table interface is not available</p></div></div><div><div class="spec value" id="val-get" class="anchored"><a href="#val-get" class="anchor"></a><code><span class="keyword">val</span> get : unit <span>&#45;&gt;</span> <span><a href="../index.html#type-gntref">gntref</a> <a href="../../../lwt/Lwt/index.html#type-t">Lwt.t</a></span></code></div><div><p>Allocate a single grant table index</p></div></div><div><div class="spec value" id="val-get_n" class="anchored"><a href="#val-get_n" class="anchor"></a><code><span class="keyword">val</span> get_n : int <span>&#45;&gt;</span> <span><span><a href="../index.html#type-gntref">gntref</a> list</span> <a href="../../../lwt/Lwt/index.html#type-t">Lwt.t</a></span></code></div><div><p>Allocate a block of n grant table indices</p></div></div><div><div class="spec value" id="val-put" class="anchored"><a href="#val-put" class="anchor"></a><code><span class="keyword">val</span> put : <a href="../index.html#type-gntref">gntref</a> <span>&#45;&gt;</span> unit</code></div><div><p>Deallocate a grant table index</p></div></div><div><div class="spec value" id="val-get_nonblock" class="anchored"><a href="#val-get_nonblock" class="anchor"></a><code><span class="keyword">val</span> get_nonblock : unit <span>&#45;&gt;</span> <span><a href="../index.html#type-gntref">gntref</a> option</span></code></div><div><p><code>get_nonblock ()</code> is <code>Some idx</code> is the grant table is not full, or <code>None</code> otherwise.</p></div></div><div><div class="spec value" id="val-get_n_nonblock" class="anchored"><a href="#val-get_n_nonblock" class="anchor"></a><code><span class="keyword">val</span> get_n_nonblock : int <span>&#45;&gt;</span> <span><a href="../index.html#type-gntref">gntref</a> list</span></code></div><div><p><code>get_n_nonblock count</code> is a list of grant table indices of length <code>count</code>, or <code>[]</code> if there if the table is too full to accomodate <code>count</code> new grant references.</p></div></div><div><div class="spec value" id="val-num_free_grants" class="anchored"><a href="#val-num_free_grants" class="anchor"></a><code><span class="keyword">val</span> num_free_grants : unit <span>&#45;&gt;</span> int</code></div><div><p><code>num_free_grants ()</code> returns the number of instantaneously free grant table indices</p></div></div><div class="spec value" id="val-with_ref" class="anchored"><a href="#val-with_ref" class="anchor"></a><code><span class="keyword">val</span> with_ref : <span>(<a href="../index.html#type-gntref">gntref</a> <span>&#45;&gt;</span> <span><span class="type-var">'a</span> <a href="../../../lwt/Lwt/index.html#type-t">Lwt.t</a></span>)</span> <span>&#45;&gt;</span> <span><span class="type-var">'a</span> <a href="../../../lwt/Lwt/index.html#type-t">Lwt.t</a></span></code></div><div class="spec value" id="val-with_refs" class="anchored"><a href="#val-with_refs" class="anchor"></a><code><span class="keyword">val</span> with_refs : int <span>&#45;&gt;</span> <span>(<span><a href="../index.html#type-gntref">gntref</a> list</span> <span>&#45;&gt;</span> <span><span class="type-var">'a</span> <a href="../../../lwt/Lwt/index.html#type-t">Lwt.t</a></span>)</span> <span>&#45;&gt;</span> <span><span class="type-var">'a</span> <a href="../../../lwt/Lwt/index.html#type-t">Lwt.t</a></span></code></div><div><div class="spec value" id="val-grant_access" class="anchored"><a href="#val-grant_access" class="anchor"></a><code><span class="keyword">val</span> grant_access : <span>domid:int</span> <span>&#45;&gt;</span> <span>writable:bool</span> <span>&#45;&gt;</span> <a href="../index.html#type-gntref">gntref</a> <span>&#45;&gt;</span> <a href="../../../io-page/Io_page/index.html#type-t">Io_page.t</a> <span>&#45;&gt;</span> unit</code></div><div><p><code>grant_access ~domid ~writable gntref page</code> adds a grant table entry at index <code>gntref</code> to the grant table, granting access to <code>domid</code> to read <code>page</code>, and write to is as well if <code>writable</code> is <code>true</code>.</p></div></div><div><div class="spec value" id="val-end_access" class="anchored"><a href="#val-end_access" class="anchor"></a><code><span class="keyword">val</span> end_access : <a href="../index.html#type-gntref">gntref</a> <span>&#45;&gt;</span> unit</code></div><div><p><code>end_access gntref</code> removes entry index <code>gntref</code> from the grant table.</p></div></div><div class="spec value" id="val-with_grant" class="anchored"><a href="#val-with_grant" class="anchor"></a><code><span class="keyword">val</span> with_grant : <span>domid:int</span> <span>&#45;&gt;</span> <span>writable:bool</span> <span>&#45;&gt;</span> <a href="../index.html#type-gntref">gntref</a> <span>&#45;&gt;</span> <a href="../../../io-page/Io_page/index.html#type-t">Io_page.t</a> <span>&#45;&gt;</span> <span>(unit <span>&#45;&gt;</span> <span><span class="type-var">'a</span> <a href="../../../lwt/Lwt/index.html#type-t">Lwt.t</a></span>)</span> <span>&#45;&gt;</span> <span><span class="type-var">'a</span> <a href="../../../lwt/Lwt/index.html#type-t">Lwt.t</a></span></code></div><div class="spec value" id="val-with_grants" class="anchored"><a href="#val-with_grants" class="anchor"></a><code><span class="keyword">val</span> with_grants : <span>domid:int</span> <span>&#45;&gt;</span> <span>writable:bool</span> <span>&#45;&gt;</span> <span><a href="../index.html#type-gntref">gntref</a> list</span> <span>&#45;&gt;</span> <span><a href="../../../io-page/Io_page/index.html#type-t">Io_page.t</a> list</span> <span>&#45;&gt;</span> <span>(unit <span>&#45;&gt;</span> <span><span class="type-var">'a</span> <a href="../../../lwt/Lwt/index.html#type-t">Lwt.t</a></span>)</span> <span>&#45;&gt;</span> <span><span class="type-var">'a</span> <a href="../../../lwt/Lwt/index.html#type-t">Lwt.t</a></span></code></div><div><div class="spec value" id="val-with_gntshr" class="anchored"><a href="#val-with_gntshr" class="anchor"></a><code><span class="keyword">val</span> with_gntshr : <span>(<a href="index.html#type-interface">interface</a> <span>&#45;&gt;</span> <span class="type-var">'a</span>)</span> <span>&#45;&gt;</span> <span class="type-var">'a</span></code></div><div><p><code>with_gntshr f</code> opens an interface to gntshr, passes it to f, then returns the result of f (or re-raises any exceptions) ensuring that the gntshr interface is closed before returning.</p></div></div></div></body></html>