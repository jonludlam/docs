<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"><head><title>Engine (tls.Tls.Engine)</title><link rel="stylesheet" href="../../../_odoc-theme/odoc.css"/><meta charset="utf-8"/><meta name="generator" content="odoc v1.1.1-1373-g2e7c1c75"/><meta name="viewport" content="width=device-width,initial-scale=1.0"/><script src="../../../highlight.pack.js"></script><script>hljs.initHighlightingOnLoad();</script></head><body><nav><a href="../index.html">Up</a> â€“ <a href="../../index.html">tls</a> &#x00BB; <a href="../index.html">Tls</a> &#x00BB; Engine</nav><header><h1>Module <code>Tls.Engine</code></h1></header><nav class="toc"><ul><li><a href="#abstract-state-type">Abstract state type</a></li><li><a href="#constructors">Constructors</a></li><li><a href="#protocol-failures">Protocol failures</a></li><li><a href="#protocol-handling">Protocol handling</a></li><li><a href="#session-information">Session information</a></li></ul></nav><div class="content"><aside><p>Transport layer security</p><p><code>TLS</code> is an implementation of <a href="https://en.wikipedia.org/wiki/Transport_Layer_Security">transport layer security</a> in OCaml. TLS is a widely used security protocol which establishes an end-to-end secure channel (with optional (mutual) authentication) between two endpoints. It uses TCP/IP as transport. This library supports all three versions of TLS: <a href="https://tools.ietf.org/html/rfc5246">1.2, RFC5246</a>, <a href="https://tools.ietf.org/html/rfc4346">1.1, RFC4346</a>, and <a href="https://tools.ietf.org/html/rfc2246">1.0, RFC2246</a>. SSL, the previous protocol definition, is not supported.</p><p>TLS is algorithmically agile: protocol version, key exchange algorithm, symmetric cipher, and message authentication code are negotiated upon connection.</p><p>This library implements several extensions of TLS, <a href="https://tools.ietf.org/html/rfc3268">AES ciphers</a>, <a href="https://tools.ietf.org/html/rfc4366">TLS extensions</a> (such as server name indication, SNI), <a href="https://tools.ietf.org/html/rfc5746">Renegotiation extension</a>, <a href="https://tools.ietf.org/html/rfc7627">Session Hash and Extended Master Secret Extension</a>.</p><p>This library does not contain insecure cipher suites (such as single DES, export ciphers, ...). It does not expose the server time in the server random, requires secure renegotiation.</p><p>This library consists of a core, implemented in a purely functional matter (<a href="index.html"><code>Engine</code></a>, this module), and effectful parts: <a href="../../Tls_lwt/index.html"><code>Tls_lwt</code></a> and <code>Tls_mirage</code>.</p><p><em>v0.12.4 - <a href="https://github.com/mirleft/ocaml-tls">homepage</a></em></p></aside><h2 id="abstract-state-type"><a href="#abstract-state-type" class="anchor"></a>Abstract state type</h2><div><div class="spec type" id="type-state" class="anchored"><a href="#type-state" class="anchor"></a><code><span class="keyword">type</span> state</code></div><div><p>The abstract type of a TLS state.</p></div></div><h2 id="constructors"><a href="#constructors" class="anchor"></a>Constructors</h2><div><div class="spec value" id="val-client" class="anchored"><a href="#val-client" class="anchor"></a><code><span class="keyword">val</span> client : <a href="../Config/index.html#type-client">Config.client</a> <span>&#45;&gt;</span> <a href="index.html#type-state">state</a> * <a href="../../../cstruct/Cstruct/index.html#type-t">Cstruct.t</a></code></div><div><p><code>client client</code> is <code>tls * out</code> where <code>tls</code> is the initial state, and <code>out</code> the initial client hello</p></div></div><div><div class="spec value" id="val-server" class="anchored"><a href="#val-server" class="anchor"></a><code><span class="keyword">val</span> server : <a href="../Config/index.html#type-server">Config.server</a> <span>&#45;&gt;</span> <a href="index.html#type-state">state</a></code></div><div><p><code>server server</code> is <code>tls</code> where <code>tls</code> is the initial server state</p></div></div><h2 id="protocol-failures"><a href="#protocol-failures" class="anchor"></a>Protocol failures</h2><div><div class="spec type" id="type-error" class="anchored"><a href="#type-error" class="anchor"></a><code><span class="keyword">type</span> error = [ </code><table><tr id="type-error.AuthenticationFailure" class="anchored"><td class="def constructor"><a href="#type-error.AuthenticationFailure" class="anchor"></a><code>| </code><code>`AuthenticationFailure <span class="keyword">of</span> <a href="../../../x509/X509/Validation/index.html#type-validation_error">X509.Validation.validation_error</a></code></td></tr><tr id="type-error.NoConfiguredCiphersuite" class="anchored"><td class="def constructor"><a href="#type-error.NoConfiguredCiphersuite" class="anchor"></a><code>| </code><code>`NoConfiguredCiphersuite <span class="keyword">of</span> <span><a href="../Ciphersuite/index.html#type-ciphersuite">Ciphersuite.ciphersuite</a> list</span></code></td></tr><tr id="type-error.NoConfiguredVersions" class="anchored"><td class="def constructor"><a href="#type-error.NoConfiguredVersions" class="anchor"></a><code>| </code><code>`NoConfiguredVersions <span class="keyword">of</span> <span><a href="../Core/index.html#type-tls_version">Core.tls_version</a> list</span></code></td></tr><tr id="type-error.NoConfiguredSignatureAlgorithm" class="anchored"><td class="def constructor"><a href="#type-error.NoConfiguredSignatureAlgorithm" class="anchor"></a><code>| </code><code>`NoConfiguredSignatureAlgorithm <span class="keyword">of</span> <span><a href="../Core/index.html#type-signature_algorithm">Core.signature_algorithm</a> list</span></code></td></tr><tr id="type-error.NoMatchingCertificateFound" class="anchored"><td class="def constructor"><a href="#type-error.NoMatchingCertificateFound" class="anchor"></a><code>| </code><code>`NoMatchingCertificateFound <span class="keyword">of</span> string</code></td></tr><tr id="type-error.NoCertificateConfigured" class="anchored"><td class="def constructor"><a href="#type-error.NoCertificateConfigured" class="anchor"></a><code>| </code><code>`NoCertificateConfigured</code></td></tr><tr id="type-error.CouldntSelectCertificate" class="anchored"><td class="def constructor"><a href="#type-error.CouldntSelectCertificate" class="anchor"></a><code>| </code><code>`CouldntSelectCertificate</code></td></tr></table><code> ]</code></div><div><p>failures which can be mitigated by reconfiguration</p></div></div><div class="spec type" id="type-client_hello_errors" class="anchored"><a href="#type-client_hello_errors" class="anchor"></a><code><span class="keyword">type</span> client_hello_errors = [ </code><table><tr id="type-client_hello_errors.EmptyCiphersuites" class="anchored"><td class="def constructor"><a href="#type-client_hello_errors.EmptyCiphersuites" class="anchor"></a><code>| </code><code>`EmptyCiphersuites</code></td></tr><tr id="type-client_hello_errors.NotSetCiphersuites" class="anchored"><td class="def constructor"><a href="#type-client_hello_errors.NotSetCiphersuites" class="anchor"></a><code>| </code><code>`NotSetCiphersuites <span class="keyword">of</span> <span><a href="../Packet/index.html#type-any_ciphersuite">Packet.any_ciphersuite</a> list</span></code></td></tr><tr id="type-client_hello_errors.NoSupportedCiphersuite" class="anchored"><td class="def constructor"><a href="#type-client_hello_errors.NoSupportedCiphersuite" class="anchor"></a><code>| </code><code>`NoSupportedCiphersuite <span class="keyword">of</span> <span><a href="../Packet/index.html#type-any_ciphersuite">Packet.any_ciphersuite</a> list</span></code></td></tr><tr id="type-client_hello_errors.NotSetExtension" class="anchored"><td class="def constructor"><a href="#type-client_hello_errors.NotSetExtension" class="anchor"></a><code>| </code><code>`NotSetExtension <span class="keyword">of</span> <span><a href="../Core/index.html#type-client_extension">Core.client_extension</a> list</span></code></td></tr><tr id="type-client_hello_errors.HasSignatureAlgorithmsExtension" class="anchored"><td class="def constructor"><a href="#type-client_hello_errors.HasSignatureAlgorithmsExtension" class="anchor"></a><code>| </code><code>`HasSignatureAlgorithmsExtension</code></td></tr><tr id="type-client_hello_errors.NoSignatureAlgorithmsExtension" class="anchored"><td class="def constructor"><a href="#type-client_hello_errors.NoSignatureAlgorithmsExtension" class="anchor"></a><code>| </code><code>`NoSignatureAlgorithmsExtension</code></td></tr><tr id="type-client_hello_errors.NoGoodSignatureAlgorithms" class="anchored"><td class="def constructor"><a href="#type-client_hello_errors.NoGoodSignatureAlgorithms" class="anchor"></a><code>| </code><code>`NoGoodSignatureAlgorithms <span class="keyword">of</span> <span><a href="../Core/index.html#type-signature_algorithm">Core.signature_algorithm</a> list</span></code></td></tr><tr id="type-client_hello_errors.NoKeyShareExtension" class="anchored"><td class="def constructor"><a href="#type-client_hello_errors.NoKeyShareExtension" class="anchor"></a><code>| </code><code>`NoKeyShareExtension</code></td></tr><tr id="type-client_hello_errors.NoSupportedGroupExtension" class="anchored"><td class="def constructor"><a href="#type-client_hello_errors.NoSupportedGroupExtension" class="anchor"></a><code>| </code><code>`NoSupportedGroupExtension</code></td></tr><tr id="type-client_hello_errors.NotSetSupportedGroup" class="anchored"><td class="def constructor"><a href="#type-client_hello_errors.NotSetSupportedGroup" class="anchor"></a><code>| </code><code>`NotSetSupportedGroup <span class="keyword">of</span> <span><a href="../Packet/index.html#type-named_group">Packet.named_group</a> list</span></code></td></tr><tr id="type-client_hello_errors.NotSetKeyShare" class="anchored"><td class="def constructor"><a href="#type-client_hello_errors.NotSetKeyShare" class="anchor"></a><code>| </code><code>`NotSetKeyShare <span class="keyword">of</span> <span><span>(<a href="../Packet/index.html#type-named_group">Packet.named_group</a> * <a href="../../../cstruct/Cstruct/index.html#type-t">Cstruct.t</a>)</span> list</span></code></td></tr><tr id="type-client_hello_errors.NotSubsetKeyShareSupportedGroup" class="anchored"><td class="def constructor"><a href="#type-client_hello_errors.NotSubsetKeyShareSupportedGroup" class="anchor"></a><code>| </code><code>`NotSubsetKeyShareSupportedGroup <span class="keyword">of</span> <span><a href="../Packet/index.html#type-named_group">Packet.named_group</a> list</span> * <span><span>(<a href="../Packet/index.html#type-named_group">Packet.named_group</a> * <a href="../../../cstruct/Cstruct/index.html#type-t">Cstruct.t</a>)</span> list</span></code></td></tr><tr id="type-client_hello_errors.Has0rttAfterHRR" class="anchored"><td class="def constructor"><a href="#type-client_hello_errors.Has0rttAfterHRR" class="anchor"></a><code>| </code><code>`Has0rttAfterHRR</code></td></tr><tr id="type-client_hello_errors.NoCookie" class="anchored"><td class="def constructor"><a href="#type-client_hello_errors.NoCookie" class="anchor"></a><code>| </code><code>`NoCookie</code></td></tr></table><code> ]</code></div><div><div class="spec type" id="type-fatal" class="anchored"><a href="#type-fatal" class="anchor"></a><code><span class="keyword">type</span> fatal = [ </code><table><tr id="type-fatal.NoSecureRenegotiation" class="anchored"><td class="def constructor"><a href="#type-fatal.NoSecureRenegotiation" class="anchor"></a><code>| </code><code>`NoSecureRenegotiation</code></td></tr><tr id="type-fatal.NoSupportedGroup" class="anchored"><td class="def constructor"><a href="#type-fatal.NoSupportedGroup" class="anchor"></a><code>| </code><code>`NoSupportedGroup</code></td></tr><tr id="type-fatal.NoVersions" class="anchored"><td class="def constructor"><a href="#type-fatal.NoVersions" class="anchor"></a><code>| </code><code>`NoVersions <span class="keyword">of</span> <span><a href="../Core/index.html#type-tls_any_version">Core.tls_any_version</a> list</span></code></td></tr><tr id="type-fatal.ReaderError" class="anchored"><td class="def constructor"><a href="#type-fatal.ReaderError" class="anchor"></a><code>| </code><code>`ReaderError <span class="keyword">of</span> <a href="../Reader/index.html#type-error">Reader.error</a></code></td></tr><tr id="type-fatal.NoCertificateReceived" class="anchored"><td class="def constructor"><a href="#type-fatal.NoCertificateReceived" class="anchor"></a><code>| </code><code>`NoCertificateReceived</code></td></tr><tr id="type-fatal.NoCertificateVerifyReceived" class="anchored"><td class="def constructor"><a href="#type-fatal.NoCertificateVerifyReceived" class="anchor"></a><code>| </code><code>`NoCertificateVerifyReceived</code></td></tr><tr id="type-fatal.NotRSACertificate" class="anchored"><td class="def constructor"><a href="#type-fatal.NotRSACertificate" class="anchor"></a><code>| </code><code>`NotRSACertificate</code></td></tr><tr id="type-fatal.NotRSASignature" class="anchored"><td class="def constructor"><a href="#type-fatal.NotRSASignature" class="anchor"></a><code>| </code><code>`NotRSASignature</code></td></tr><tr id="type-fatal.KeyTooSmall" class="anchored"><td class="def constructor"><a href="#type-fatal.KeyTooSmall" class="anchor"></a><code>| </code><code>`KeyTooSmall</code></td></tr><tr id="type-fatal.RSASignatureMismatch" class="anchored"><td class="def constructor"><a href="#type-fatal.RSASignatureMismatch" class="anchor"></a><code>| </code><code>`RSASignatureMismatch</code></td></tr><tr id="type-fatal.RSASignatureVerificationFailed" class="anchored"><td class="def constructor"><a href="#type-fatal.RSASignatureVerificationFailed" class="anchor"></a><code>| </code><code>`RSASignatureVerificationFailed</code></td></tr><tr id="type-fatal.UnsupportedSignatureScheme" class="anchored"><td class="def constructor"><a href="#type-fatal.UnsupportedSignatureScheme" class="anchor"></a><code>| </code><code>`UnsupportedSignatureScheme</code></td></tr><tr id="type-fatal.HashAlgorithmMismatch" class="anchored"><td class="def constructor"><a href="#type-fatal.HashAlgorithmMismatch" class="anchor"></a><code>| </code><code>`HashAlgorithmMismatch</code></td></tr><tr id="type-fatal.BadCertificateChain" class="anchored"><td class="def constructor"><a href="#type-fatal.BadCertificateChain" class="anchor"></a><code>| </code><code>`BadCertificateChain</code></td></tr><tr id="type-fatal.MACMismatch" class="anchored"><td class="def constructor"><a href="#type-fatal.MACMismatch" class="anchor"></a><code>| </code><code>`MACMismatch</code></td></tr><tr id="type-fatal.MACUnderflow" class="anchored"><td class="def constructor"><a href="#type-fatal.MACUnderflow" class="anchor"></a><code>| </code><code>`MACUnderflow</code></td></tr><tr id="type-fatal.RecordOverflow" class="anchored"><td class="def constructor"><a href="#type-fatal.RecordOverflow" class="anchor"></a><code>| </code><code>`RecordOverflow <span class="keyword">of</span> int</code></td></tr><tr id="type-fatal.UnknownRecordVersion" class="anchored"><td class="def constructor"><a href="#type-fatal.UnknownRecordVersion" class="anchor"></a><code>| </code><code>`UnknownRecordVersion <span class="keyword">of</span> int * int</code></td></tr><tr id="type-fatal.UnknownContentType" class="anchored"><td class="def constructor"><a href="#type-fatal.UnknownContentType" class="anchor"></a><code>| </code><code>`UnknownContentType <span class="keyword">of</span> int</code></td></tr><tr id="type-fatal.CannotHandleApplicationDataYet" class="anchored"><td class="def constructor"><a href="#type-fatal.CannotHandleApplicationDataYet" class="anchor"></a><code>| </code><code>`CannotHandleApplicationDataYet</code></td></tr><tr id="type-fatal.NoHeartbeat" class="anchored"><td class="def constructor"><a href="#type-fatal.NoHeartbeat" class="anchor"></a><code>| </code><code>`NoHeartbeat</code></td></tr><tr id="type-fatal.BadRecordVersion" class="anchored"><td class="def constructor"><a href="#type-fatal.BadRecordVersion" class="anchor"></a><code>| </code><code>`BadRecordVersion <span class="keyword">of</span> <a href="../Core/index.html#type-tls_any_version">Core.tls_any_version</a></code></td></tr><tr id="type-fatal.BadFinished" class="anchored"><td class="def constructor"><a href="#type-fatal.BadFinished" class="anchor"></a><code>| </code><code>`BadFinished</code></td></tr><tr id="type-fatal.HandshakeFragmentsNotEmpty" class="anchored"><td class="def constructor"><a href="#type-fatal.HandshakeFragmentsNotEmpty" class="anchor"></a><code>| </code><code>`HandshakeFragmentsNotEmpty</code></td></tr><tr id="type-fatal.InsufficientDH" class="anchored"><td class="def constructor"><a href="#type-fatal.InsufficientDH" class="anchor"></a><code>| </code><code>`InsufficientDH</code></td></tr><tr id="type-fatal.InvalidDH" class="anchored"><td class="def constructor"><a href="#type-fatal.InvalidDH" class="anchor"></a><code>| </code><code>`InvalidDH</code></td></tr><tr id="type-fatal.InvalidRenegotiation" class="anchored"><td class="def constructor"><a href="#type-fatal.InvalidRenegotiation" class="anchor"></a><code>| </code><code>`InvalidRenegotiation</code></td></tr><tr id="type-fatal.InvalidClientHello" class="anchored"><td class="def constructor"><a href="#type-fatal.InvalidClientHello" class="anchor"></a><code>| </code><code>`InvalidClientHello <span class="keyword">of</span> <a href="index.html#type-client_hello_errors">client_hello_errors</a></code></td></tr><tr id="type-fatal.InvalidServerHello" class="anchored"><td class="def constructor"><a href="#type-fatal.InvalidServerHello" class="anchor"></a><code>| </code><code>`InvalidServerHello</code></td></tr><tr id="type-fatal.InvalidRenegotiationVersion" class="anchored"><td class="def constructor"><a href="#type-fatal.InvalidRenegotiationVersion" class="anchor"></a><code>| </code><code>`InvalidRenegotiationVersion <span class="keyword">of</span> <a href="../Core/index.html#type-tls_version">Core.tls_version</a></code></td></tr><tr id="type-fatal.InappropriateFallback" class="anchored"><td class="def constructor"><a href="#type-fatal.InappropriateFallback" class="anchor"></a><code>| </code><code>`InappropriateFallback</code></td></tr><tr id="type-fatal.UnexpectedCCS" class="anchored"><td class="def constructor"><a href="#type-fatal.UnexpectedCCS" class="anchor"></a><code>| </code><code>`UnexpectedCCS</code></td></tr><tr id="type-fatal.UnexpectedHandshake" class="anchored"><td class="def constructor"><a href="#type-fatal.UnexpectedHandshake" class="anchor"></a><code>| </code><code>`UnexpectedHandshake <span class="keyword">of</span> <a href="../Core/index.html#type-tls_handshake">Core.tls_handshake</a></code></td></tr><tr id="type-fatal.InvalidCertificateUsage" class="anchored"><td class="def constructor"><a href="#type-fatal.InvalidCertificateUsage" class="anchor"></a><code>| </code><code>`InvalidCertificateUsage</code></td></tr><tr id="type-fatal.InvalidCertificateExtendedUsage" class="anchored"><td class="def constructor"><a href="#type-fatal.InvalidCertificateExtendedUsage" class="anchor"></a><code>| </code><code>`InvalidCertificateExtendedUsage</code></td></tr><tr id="type-fatal.InvalidSession" class="anchored"><td class="def constructor"><a href="#type-fatal.InvalidSession" class="anchor"></a><code>| </code><code>`InvalidSession</code></td></tr><tr id="type-fatal.NoApplicationProtocol" class="anchored"><td class="def constructor"><a href="#type-fatal.NoApplicationProtocol" class="anchor"></a><code>| </code><code>`NoApplicationProtocol</code></td></tr><tr id="type-fatal.HelloRetryRequest" class="anchored"><td class="def constructor"><a href="#type-fatal.HelloRetryRequest" class="anchor"></a><code>| </code><code>`HelloRetryRequest</code></td></tr><tr id="type-fatal.InvalidMessage" class="anchored"><td class="def constructor"><a href="#type-fatal.InvalidMessage" class="anchor"></a><code>| </code><code>`InvalidMessage</code></td></tr><tr id="type-fatal.Toomany0rttbytes" class="anchored"><td class="def constructor"><a href="#type-fatal.Toomany0rttbytes" class="anchor"></a><code>| </code><code>`Toomany0rttbytes</code></td></tr><tr id="type-fatal.MissingContentType" class="anchored"><td class="def constructor"><a href="#type-fatal.MissingContentType" class="anchor"></a><code>| </code><code>`MissingContentType</code></td></tr><tr id="type-fatal.Downgrade12" class="anchored"><td class="def constructor"><a href="#type-fatal.Downgrade12" class="anchor"></a><code>| </code><code>`Downgrade12</code></td></tr><tr id="type-fatal.Downgrade11" class="anchored"><td class="def constructor"><a href="#type-fatal.Downgrade11" class="anchor"></a><code>| </code><code>`Downgrade11</code></td></tr><tr id="type-fatal.UnsupportedKeyExchange" class="anchored"><td class="def constructor"><a href="#type-fatal.UnsupportedKeyExchange" class="anchor"></a><code>| </code><code>`UnsupportedKeyExchange</code></td></tr></table><code> ]</code></div><div><p>failures from received garbage or lack of features</p></div></div><div><div class="spec type" id="type-failure" class="anchored"><a href="#type-failure" class="anchor"></a><code><span class="keyword">type</span> failure = [ </code><table><tr id="type-failure.Error" class="anchored"><td class="def constructor"><a href="#type-failure.Error" class="anchor"></a><code>| </code><code>`Error <span class="keyword">of</span> <a href="index.html#type-error">error</a></code></td></tr><tr id="type-failure.Fatal" class="anchored"><td class="def constructor"><a href="#type-failure.Fatal" class="anchor"></a><code>| </code><code>`Fatal <span class="keyword">of</span> <a href="index.html#type-fatal">fatal</a></code></td></tr></table><code> ]</code></div><div><p>type of failures</p></div></div><div><div class="spec value" id="val-alert_of_failure" class="anchored"><a href="#val-alert_of_failure" class="anchor"></a><code><span class="keyword">val</span> alert_of_failure : <a href="index.html#type-failure">failure</a> <span>&#45;&gt;</span> <a href="../Packet/index.html#type-alert_type">Packet.alert_type</a></code></div><div><p><code>alert_of_failure failure</code> is <code>alert</code>, the TLS alert type for this failure.</p></div></div><div><div class="spec value" id="val-string_of_failure" class="anchored"><a href="#val-string_of_failure" class="anchor"></a><code><span class="keyword">val</span> string_of_failure : <a href="index.html#type-failure">failure</a> <span>&#45;&gt;</span> string</code></div><div><p><code>string_of_failure failure</code> is <code>string</code>, the string representation of the <code>failure</code>.</p></div></div><div><div class="spec value" id="val-failure_of_sexp" class="anchored"><a href="#val-failure_of_sexp" class="anchor"></a><code><span class="keyword">val</span> failure_of_sexp : <a href="../../../sexplib/Sexplib/Sexp/index.html#type-t">Sexplib.Sexp.t</a> <span>&#45;&gt;</span> <a href="index.html#type-failure">failure</a></code></div><div><p><code>failure_of_sexp sexp</code> is <code>failure</code>, the unmarshalled <code>sexp</code>.</p></div></div><div><div class="spec value" id="val-sexp_of_failure" class="anchored"><a href="#val-sexp_of_failure" class="anchor"></a><code><span class="keyword">val</span> sexp_of_failure : <a href="index.html#type-failure">failure</a> <span>&#45;&gt;</span> <a href="../../../sexplib/Sexplib/Sexp/index.html#type-t">Sexplib.Sexp.t</a></code></div><div><p><code>sexp_of_failure failure</code> is <code>sexp</code>, the marshalled <code>failure</code>.</p></div></div><h2 id="protocol-handling"><a href="#protocol-handling" class="anchor"></a>Protocol handling</h2><div><div class="spec type" id="type-ret" class="anchored"><a href="#type-ret" class="anchor"></a><code><span class="keyword">type</span> ret = [ </code><table><tr id="type-ret.Ok" class="anchored"><td class="def constructor"><a href="#type-ret.Ok" class="anchor"></a><code>| </code><code>`Ok <span class="keyword">of</span> <span>[ <span>`Ok of <a href="index.html#type-state">state</a></span> <span>| `Eof</span> <span><span>| `Alert</span> of <a href="../Packet/index.html#type-alert_type">Packet.alert_type</a></span> ]</span> * <span>[ <span>`Response of <span><a href="../../../cstruct/Cstruct/index.html#type-t">Cstruct.t</a> option</span></span> ]</span> * <span>[ <span>`Data of <span><a href="../../../cstruct/Cstruct/index.html#type-t">Cstruct.t</a> option</span></span> ]</span></code></td></tr><tr id="type-ret.Fail" class="anchored"><td class="def constructor"><a href="#type-ret.Fail" class="anchor"></a><code>| </code><code>`Fail <span class="keyword">of</span> <a href="index.html#type-failure">failure</a> * <span>[ <span>`Response of <a href="../../../cstruct/Cstruct/index.html#type-t">Cstruct.t</a></span> ]</span></code></td></tr></table><code> ]</code></div><div><p>result type of <a href="index.html#val-handle_tls"><code>handle_tls</code></a>: either failed to handle the incoming buffer (<code>`Fail</code>) with <a href="index.html#type-failure"><code>failure</code></a> and potentially a message to send to the other endpoint, or sucessful operation (<code>`Ok</code>) with a new <a href="index.html#type-state"><code>state</code></a>, an end of file (<code>`Eof</code>), or an incoming (<code>`Alert</code>). Possibly some <code>`Response</code> to the other endpoint is needed, and potentially some <code>`Data</code> for the application was received.</p></div></div><div><div class="spec value" id="val-handle_tls" class="anchored"><a href="#val-handle_tls" class="anchor"></a><code><span class="keyword">val</span> handle_tls : <a href="index.html#type-state">state</a> <span>&#45;&gt;</span> <a href="../../../cstruct/Cstruct/index.html#type-t">Cstruct.t</a> <span>&#45;&gt;</span> <a href="index.html#type-ret">ret</a></code></div><div><p><code>handle_tls state buffer</code> is <code>ret</code>, depending on incoming <code>state</code> and <code>buffer</code>, the result is the appropriate <a href="index.html#type-ret"><code>ret</code></a></p></div></div><div><div class="spec value" id="val-can_handle_appdata" class="anchored"><a href="#val-can_handle_appdata" class="anchor"></a><code><span class="keyword">val</span> can_handle_appdata : <a href="index.html#type-state">state</a> <span>&#45;&gt;</span> bool</code></div><div><p><code>can_handle_appdata state</code> is a predicate which indicates when the connection has already completed a handshake.</p></div></div><div><div class="spec value" id="val-handshake_in_progress" class="anchored"><a href="#val-handshake_in_progress" class="anchor"></a><code><span class="keyword">val</span> handshake_in_progress : <a href="index.html#type-state">state</a> <span>&#45;&gt;</span> bool</code></div><div><p><code>handshake_in_progrss state</code> is a predicate which indicates whether there is a handshake in progress or scheduled.</p></div></div><div><div class="spec value" id="val-send_application_data" class="anchored"><a href="#val-send_application_data" class="anchor"></a><code><span class="keyword">val</span> send_application_data : <a href="index.html#type-state">state</a> <span>&#45;&gt;</span> <span><a href="../../../cstruct/Cstruct/index.html#type-t">Cstruct.t</a> list</span> <span>&#45;&gt;</span> <span><span>(<a href="index.html#type-state">state</a> * <a href="../../../cstruct/Cstruct/index.html#type-t">Cstruct.t</a>)</span> option</span></code></div><div><p><code>send_application_data tls outs</code> is <code>(tls' * out) option</code> where <code>tls'</code> is the new tls state, and <code>out</code> the cstruct to send over the wire (encrypted <code>outs</code>).</p></div></div><div><div class="spec value" id="val-send_close_notify" class="anchored"><a href="#val-send_close_notify" class="anchor"></a><code><span class="keyword">val</span> send_close_notify : <a href="index.html#type-state">state</a> <span>&#45;&gt;</span> <a href="index.html#type-state">state</a> * <a href="../../../cstruct/Cstruct/index.html#type-t">Cstruct.t</a></code></div><div><p><code>send_close_notify tls</code> is <code>tls' * out</code> where <code>tls'</code> is the new tls state, and out the (possible encrypted) close notify alert.</p></div></div><div><div class="spec value" id="val-reneg" class="anchored"><a href="#val-reneg" class="anchor"></a><code><span class="keyword">val</span> reneg : <span>?&#8288;authenticator:<a href="../../../x509/X509/Authenticator/index.html#type-t">X509.Authenticator.t</a></span> <span>&#45;&gt;</span> <span>?&#8288;acceptable_cas:<span><a href="../../../x509/X509/Distinguished_name/index.html#type-t">X509.Distinguished_name.t</a> list</span></span> <span>&#45;&gt;</span> <span>?&#8288;cert:<a href="../Config/index.html#type-own_cert">Config.own_cert</a></span> <span>&#45;&gt;</span> <a href="index.html#type-state">state</a> <span>&#45;&gt;</span> <span><span>(<a href="index.html#type-state">state</a> * <a href="../../../cstruct/Cstruct/index.html#type-t">Cstruct.t</a>)</span> option</span></code></div><div><p><code>reneg ~authenticator ~acceptable_cas ~cert tls</code> initiates a renegotation on <code>tls</code>, using the provided <code>authenticator</code>. It is <code>tls' * out</code> where <code>tls'</code> is the new tls state, and <code>out</code> either a client hello or hello request (depending on which communication endpoint <code>tls</code> is).</p></div></div><div><div class="spec value" id="val-key_update" class="anchored"><a href="#val-key_update" class="anchor"></a><code><span class="keyword">val</span> key_update : <span>?&#8288;request:bool</span> <span>&#45;&gt;</span> <a href="index.html#type-state">state</a> <span>&#45;&gt;</span> <span><span>(<a href="index.html#type-state">state</a> * <a href="../../../cstruct/Cstruct/index.html#type-t">Cstruct.t</a>,Â <a href="index.html#type-failure">failure</a>)</span> <a href="../../../ocaml/Stdlib/index.html#type-result">Stdlib.result</a></span></code></div><div><p><code>key_update ~request state</code> initiates a KeyUpdate (TLS 1.3 only). If <code>request</code> is provided and <code>true</code> (the default), the KeyUpdate message contains a request that the peer should update their traffic key as well.</p></div></div><h2 id="session-information"><a href="#session-information" class="anchor"></a>Session information</h2><div><div class="spec type" id="type-epoch" class="anchored"><a href="#type-epoch" class="anchor"></a><code><span class="keyword">type</span> epoch = [ </code><table><tr id="type-epoch.InitialEpoch" class="anchored"><td class="def constructor"><a href="#type-epoch.InitialEpoch" class="anchor"></a><code>| </code><code>`InitialEpoch</code></td></tr><tr id="type-epoch.Epoch" class="anchored"><td class="def constructor"><a href="#type-epoch.Epoch" class="anchor"></a><code>| </code><code>`Epoch <span class="keyword">of</span> <a href="../Core/index.html#type-epoch_data">Core.epoch_data</a></code></td></tr></table><code> ]</code></div><div><p>polymorphic variant of session information. The first variant <code>`InitialEpoch</code> will only be used for TLS states without completed handshake. The second variant, <code>`Epoch</code>, contains actual session data.</p></div></div><div><div class="spec value" id="val-epoch_of_sexp" class="anchored"><a href="#val-epoch_of_sexp" class="anchor"></a><code><span class="keyword">val</span> epoch_of_sexp : <a href="../../../sexplib/Sexplib/Sexp/index.html#type-t">Sexplib.Sexp.t</a> <span>&#45;&gt;</span> <a href="index.html#type-epoch">epoch</a></code></div><div><p><code>epoch_of_sexp sexp</code> is <code>epoch</code>, the unmarshalled <code>sexp</code>.</p></div></div><div><div class="spec value" id="val-sexp_of_epoch" class="anchored"><a href="#val-sexp_of_epoch" class="anchor"></a><code><span class="keyword">val</span> sexp_of_epoch : <a href="index.html#type-epoch">epoch</a> <span>&#45;&gt;</span> <a href="../../../sexplib/Sexplib/Sexp/index.html#type-t">Sexplib.Sexp.t</a></code></div><div><p><code>sexp_of_epoch epoch</code> is <code>sexp</code>, the marshalled <code>epoch</code>.</p></div></div><div><div class="spec value" id="val-epoch" class="anchored"><a href="#val-epoch" class="anchor"></a><code><span class="keyword">val</span> epoch : <a href="index.html#type-state">state</a> <span>&#45;&gt;</span> <a href="index.html#type-epoch">epoch</a></code></div><div><p><code>epoch state</code> is <code>epoch</code>, which contains the session information.</p></div></div></div></body></html>