<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"><head><title>Rng (nocrypto.Nocrypto.Rng)</title><link rel="stylesheet" href="../../../_odoc-theme/odoc.css"/><meta charset="utf-8"/><meta name="generator" content="odoc v1.1.1-1373-g2e7c1c75"/><meta name="viewport" content="width=device-width,initial-scale=1.0"/><script src="../../../highlight.pack.js"></script><script>hljs.initHighlightingOnLoad();</script></head><body><nav><a href="../index.html">Up</a> â€“ <a href="../../index.html">nocrypto</a> &#x00BB; <a href="../index.html">Nocrypto</a> &#x00BB; Rng</nav><header><h1>Module <code>Nocrypto.Rng</code></h1><p>Secure random number generation.</p><p>There are several parts of this module:</p><ul><li>The <a href="S/module-type-Generator/index.html">signature</a> of generator modules, together with a facility to convert such modules into actual <span class="xref-unresolved">generators</span>, and functions that operate on this representation.</li><li>A global generator instance, implemented by <a href="Generators/Fortuna/index.html">Fortuna</a>. This is the default generator, used when one is not explicitly supplied.</li><li>The <span class="xref-unresolved">signature</span> of modules for randomly generating a particular numeric type, a <a href="Make_N/index.html">functor</a> to produce them, and instances for <a href="Int/index.html"><code>int</code></a>, <a href="Int32/index.html"><code>int32</code></a>, <a href="Int64/index.html"><code>int64</code></a>, and <a href="Z/index.html"><code>Z.t</code></a>.</li><li>Several specialized functions for e.g. primes.</li></ul></header><nav class="toc"><ul><li><a href="#usage-notes">Usage notes</a></li><li><a href="#interface">Interface</a></li><li><a href="#generation-of-common-numeric-types">Generation of common numeric types</a></li><li><a href="#specialized-generation">Specialized generation</a></li><li><a href="#rng_examples">Examples</a></li></ul></nav><div class="content"><h2 id="usage-notes"><a href="#usage-notes" class="anchor"></a>Usage notes</h2><aside><p><b>TL;DR</b> Don't forget to seed; don't maintain your own <code>g</code>.</p><p>The RNGs here are merely the deterministic part of a full random number generation suite. For proper operation, they need to be seeded with a high-quality entropy source.</p><p>Suitable entropy sources are provided by sub-libraries <a href="../../Nocrypto_entropy_unix/index.html">nocrypto.unix</a>, <a href="../../Nocrypto_entropy_lwt/index.html">nocrypto.lwt</a> and <a href="../../Nocrypto_entropy_mirage/index.html">nocrypto.xen</a>. Although this module exposes a more fine-grained interface, allowing manual seeding of generators, this is intended either for implementing entropy-harvesting modules, or very specialized purposes. Users of this library should almost certainly use one of the above entropy libraries, and avoid manually managing the generator seeding.</p><p>Similarly, although it is possible to swap the default generator and gain control over the random stream, this is also intended for specialized applications such as testing or similar scenarios where the RNG needs to be fully deterministic, or as a component of deterministic algorithms which internally rely on pseudorandom streams.</p><p>In the general case, users should not maintain their local instances of <a href="index.html#type-g">g</a>. All of the generators in a process have to compete for entropy, and it is likely that the overall result will have lower effective unpredictability.</p><p>The recommended way to use these functions is either to accept an optional generator and pass it down, or to ignore the generator altogether, as illustrated in the <a href="../index.html#rng_examples">examples</a>.</p></aside><h2 id="interface"><a href="#interface" class="anchor"></a>Interface</h2><div><div class="spec type" id="type-g" class="anchored"><a href="#type-g" class="anchor"></a><code><span class="keyword">type</span> g</code></div><div><p>A generator (PRNG) with its state.</p></div></div><div><div class="spec exception" id="exception-Unseeded_generator" class="anchored"><a href="#exception-Unseeded_generator" class="anchor"></a><code><span class="keyword">exception</span> <span class="exception">Unseeded_generator</span></code></div><div><p>Thrown when using an uninitialized <a href="index.html#type-g">generator</a>.</p></div></div><div><div class="spec module" id="module-S" class="anchored"><a href="#module-S" class="anchor"></a><code><span class="keyword">module</span> <a href="S/index.html">S</a> : <span class="keyword">sig</span> ... <span class="keyword">end</span></code></div><div><p>Module signatures.</p></div></div><div><div class="spec module" id="module-Generators" class="anchored"><a href="#module-Generators" class="anchor"></a><code><span class="keyword">module</span> <a href="Generators/index.html">Generators</a> : <span class="keyword">sig</span> ... <span class="keyword">end</span></code></div><div><p>Ready-to-use RNG algorithms.</p></div></div><div><div class="spec value" id="val-create" class="anchored"><a href="#val-create" class="anchor"></a><code><span class="keyword">val</span> create : <span>?&#8288;g:<span class="type-var">'a</span></span> <span>&#45;&gt;</span> <span>?&#8288;seed:<a href="../../../cstruct/Cstruct/index.html#type-t">Cstruct.t</a></span> <span>&#45;&gt;</span> <span>?&#8288;strict:bool</span> <span>&#45;&gt;</span> <span>(<span class="keyword">module</span> <a href="S/module-type-Generator/index.html">S.Generator</a> <span class="keyword">with</span> <span class="keyword">type</span> <a href="S/module-type-Generator/index.html#type-g">g</a> = <span class="type-var">'a</span>)</span> <span>&#45;&gt;</span> <a href="index.html#type-g">g</a></code></div><div><p><code>create module</code> uses a module conforming to the <a href="S/module-type-Generator/index.html">Generator</a> signature to instantiate the generic generator <a href="index.html#type-g">g</a>.</p><p><code>g</code> is the state to use, otherwise a fresh one is created.</p><p><code>seed</code> can be provided to immediately reseed the generator with.</p><p><code>strict</code> puts the generator into a more standards-conformant, but slighty slower mode. Useful if the outputs need to match published test-vectors.</p></div></div><div><div class="spec value" id="val-generator" class="anchored"><a href="#val-generator" class="anchor"></a><code><span class="keyword">val</span> generator : <span><a href="index.html#type-g">g</a> <a href="../../../ocaml/Stdlib/index.html#type-ref">Stdlib.ref</a></span></code></div><div><p>Default generator. Functions in this module use this generator when not explicitly supplied one.</p><p>Swapping the <code>generator</code> is a way to subvert the random-generation process e.g. to make it fully deterministic.</p><p><code>generator</code> defaults to <a href="Generators/Fortuna/index.html">Fortuna</a>.</p></div></div><div><div class="spec value" id="val-generate" class="anchored"><a href="#val-generate" class="anchor"></a><code><span class="keyword">val</span> generate : <span>?&#8288;g:<a href="index.html#type-g">g</a></span> <span>&#45;&gt;</span> int <span>&#45;&gt;</span> <a href="../../../cstruct/Cstruct/index.html#type-t">Cstruct.t</a></code></div><div><p>Invoke <a href="S/module-type-Generator/index.html#val-generate">generate</a> on <code>g</code> or <a href="index.html#val-generator">default generator</a>.</p></div></div><div><div class="spec value" id="val-block" class="anchored"><a href="#val-block" class="anchor"></a><code><span class="keyword">val</span> block : <span><a href="index.html#type-g">g</a> option</span> <span>&#45;&gt;</span> int</code></div><div><p><a href="S/module-type-Generator/index.html#val-block">Block</a> size of <code>g</code> or <a href="index.html#val-generator">default generator</a>.</p></div></div><h2 id="generation-of-common-numeric-types"><a href="#generation-of-common-numeric-types" class="anchor"></a>Generation of common numeric types</h2><div><div class="spec module" id="module-Make_N" class="anchored"><a href="#module-Make_N" class="anchor"></a><code><span class="keyword">module</span> <a href="Make_N/index.html">Make_N</a> : <span class="keyword">functor</span> (<a href="Make_N/argument-1-N/index.html">N</a> : <a href="../Numeric/module-type-S/index.html">Numeric.S</a>) <span>&#45;&gt;</span> <a href="S/module-type-N/index.html">S.N</a> <span class="keyword">with</span> <span class="keyword">type</span> <a href="S/module-type-N/index.html#type-t">t</a> = <a href="Make_N/argument-1-N/index.html#type-t">N.t</a></code></div><div><p>Creates a suite of generating functions over a numeric type.</p></div></div><div class="spec module" id="module-Int" class="anchored"><a href="#module-Int" class="anchor"></a><code><span class="keyword">module</span> <a href="Int/index.html">Int</a> : <a href="S/module-type-N/index.html">S.N</a> <span class="keyword">with</span> <span class="keyword">type</span> <a href="S/module-type-N/index.html#type-t">t</a> = int</code></div><div class="spec module" id="module-Int32" class="anchored"><a href="#module-Int32" class="anchor"></a><code><span class="keyword">module</span> <a href="Int32/index.html">Int32</a> : <a href="S/module-type-N/index.html">S.N</a> <span class="keyword">with</span> <span class="keyword">type</span> <a href="S/module-type-N/index.html#type-t">t</a> = int32</code></div><div class="spec module" id="module-Int64" class="anchored"><a href="#module-Int64" class="anchor"></a><code><span class="keyword">module</span> <a href="Int64/index.html">Int64</a> : <a href="S/module-type-N/index.html">S.N</a> <span class="keyword">with</span> <span class="keyword">type</span> <a href="S/module-type-N/index.html#type-t">t</a> = int64</code></div><div class="spec module" id="module-Z" class="anchored"><a href="#module-Z" class="anchor"></a><code><span class="keyword">module</span> <a href="Z/index.html">Z</a> : <a href="S/module-type-N/index.html">S.N</a> <span class="keyword">with</span> <span class="keyword">type</span> <a href="S/module-type-N/index.html#type-t">t</a> = <a href="../../../zarith/Z/index.html#type-t">Z.t</a></code></div><h2 id="specialized-generation"><a href="#specialized-generation" class="anchor"></a>Specialized generation</h2><div><div class="spec value" id="val-prime" class="anchored"><a href="#val-prime" class="anchor"></a><code><span class="keyword">val</span> prime : <span>?&#8288;g:<a href="index.html#type-g">g</a></span> <span>&#45;&gt;</span> <span>?&#8288;msb:int</span> <span>&#45;&gt;</span> int <span>&#45;&gt;</span> <a href="Z/index.html#type-t">Z.t</a></code></div><div><p><code>prime ~g ~msb bits</code> generates a prime smaller than <code>2^bits</code>, with <code>msb</code> most significant bits set.</p><p><code>prime ~g ~msb:1 bits</code> (the default) yields a prime in the interval <code>[2^(bits - 1), 2^bits - 1]</code>.</p></div></div><div><div class="spec value" id="val-safe_prime" class="anchored"><a href="#val-safe_prime" class="anchor"></a><code><span class="keyword">val</span> safe_prime : <span>?&#8288;g:<a href="index.html#type-g">g</a></span> <span>&#45;&gt;</span> int <span>&#45;&gt;</span> <a href="Z/index.html#type-t">Z.t</a> * <a href="Z/index.html#type-t">Z.t</a></code></div><div><p><code>safe_prime ~g bits</code> gives a prime pair <code>(g, p)</code> such that <code>p = 2g + 1</code> and <code>p</code> has <code>bits</code> significant bits.</p></div></div><h2 id="rng_examples"><a href="#rng_examples" class="anchor"></a>Examples</h2><aside><p>Generating a random 13-byte <a href="../../../cstruct/Cstruct/index.html#type-t"><code>Cstruct.t</code></a>:</p><pre><code>let cs = Rng.generate 13</code></pre><p>Generating a list of <a href="../../../cstruct/Cstruct/index.html#type-t"><code>Cstruct.t</code></a>s, passing down an optional <a href="index.html#type-g">generator</a>:</p><pre><code>let rec f1 ?g ~n i =
if i &lt; 1 then [] else Rng.generate ?g n :: f1 ?g ~n (i - 1)</code></pre><p>Generating a <code>Z.t</code> smaller than <code>10</code> and an <code>int64</code> in the range <code>[3, 7]</code>:</p><pre><code>let f2 ?g () = Rng.(Z.gen ?g ~$10, Int64.gen_r 3L 8L)</code></pre><p>Creating a local Fortuna instance and using it as a key-derivation function:</p><pre><code>let f3 secret =
let g = Rng.(create ~seed:secret (module Generators.Fortuna)) in
Rng.generate ~g 32</code></pre><p>Generating a 17-bit prime with two leading bits set:</p><pre><code>let p = Rng.prime ~msb:2 17</code></pre><p>Fisher-Yates shuffle:</p><pre><code>let f4 ?g arr =
let n = Array.length arr in
arr |&gt; Array.iter @@ fun i -&gt;
  let j = Rng.Int.gen_r ?g i n in
  let (a, b) = (arr.(i), arr.(j)) in
  arr.(i) &lt;- b ; arr.(j) &lt;- a </code></pre></aside><div><div class="spec type" id="type-buffer" class="anchored"><a href="#type-buffer" class="anchor"></a><code><span class="keyword">type</span> buffer = <a href="../../../cstruct/Cstruct/index.html#type-t">Cstruct.t</a></code></div><div><p>Type definition to satisfy MirageOS RANDOM signature</p></div></div></div></body></html>