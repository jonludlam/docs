<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"><head><title>Store (b0.B00.Store)</title><link rel="stylesheet" href="../../../_odoc-theme/odoc.css"/><meta charset="utf-8"/><meta name="generator" content="odoc v1.1.1-1373-g2e7c1c75"/><meta name="viewport" content="width=device-width,initial-scale=1.0"/><script src="../../../highlight.pack.js"></script><script>hljs.initHighlightingOnLoad();</script></head><body><nav><a href="../index.html">Up</a> â€“ <a href="../../index.html">b0</a> &#x00BB; <a href="../index.html">B00</a> &#x00BB; Store</nav><header><h1>Module <code>B00.Store</code></h1><p>Lazy immutable stores.</p><p>These stores provide access to immutable, lazily determined, typed key-value bindings.</p><p>The value of a key in a store is defined either:</p><ul><li>Explicitly when the store is <span class="xref-unresolved">created</span>.</li><li>Lazily on the first key <span class="xref-unresolved">access</span> via a fiber specified at <span class="xref-unresolved">key creation time</span>.</li></ul><p>Once determined the value of a key in the store never changes.</p><p><b>XXX.</b> Maybe move that at the B0 level.</p></header><nav class="toc"><ul><li><a href="#stores">Stores</a></li></ul></nav><div class="content"><h2 id="stores"><a href="#stores" class="anchor"></a>Stores</h2><div><div class="spec type" id="type-key" class="anchored"><a href="#type-key" class="anchor"></a><code><span class="keyword">type</span> <span>'a key</span></code></div><div><p>The type for keys binding values of type <code>'a</code>.</p></div></div><div><div class="spec type" id="type-binding" class="anchored"><a href="#type-binding" class="anchor"></a><code><span class="keyword">type</span> binding = </code><table><tr id="type-binding.B" class="anchored"><td class="def variant constructor"><a href="#type-binding.B" class="anchor"></a><code>| <span class="constructor">B</span> : <span><span class="type-var">'a</span> <a href="index.html#type-key">key</a></span> * <span class="type-var">'a</span> <span>&#45;&gt;</span> <a href="index.html#type-binding">binding</a></code></td></tr></table></div><div><p>The type for store bindings. A key and its value.</p></div></div><div><div class="spec type" id="type-t" class="anchored"><a href="#type-t" class="anchor"></a><code><span class="keyword">type</span> t</code></div><div><p>The type for stores.</p></div></div><div><div class="spec value" id="val-create" class="anchored"><a href="#val-create" class="anchor"></a><code><span class="keyword">val</span> create : <a href="../Memo/index.html#type-t">Memo.t</a> <span>&#45;&gt;</span> <span>dir:<a href="../../B00_std/Fpath/index.html#type-t">B00_std.Fpath.t</a></span> <span>&#45;&gt;</span> <span><a href="index.html#type-binding">binding</a> list</span> <span>&#45;&gt;</span> <a href="index.html#type-t">t</a></code></div><div><p><code>create memo ~dir bs</code> is a store with predefined bindings <code>bs</code>. If a key is mentioned more than once in <code>bs</code> the last binding takes over. The store uses <code>memo</code> to determine other keys as <a href="index.html#val-get">needed</a>. <code>dir</code> is a scratch directory used by key fibers to write memoized file outputs.</p></div></div><div><div class="spec value" id="val-memo" class="anchored"><a href="#val-memo" class="anchor"></a><code><span class="keyword">val</span> memo : <a href="index.html#type-t">t</a> <span>&#45;&gt;</span> <a href="../Memo/index.html#type-t">Memo.t</a></code></div><div><p><code>memo s</code> is <code>s</code>'s memo as given on <a href="index.html#val-create"><code>create</code></a>.</p></div></div><div><div class="spec value" id="val-dir" class="anchored"><a href="#val-dir" class="anchor"></a><code><span class="keyword">val</span> dir : <a href="index.html#type-t">t</a> <span>&#45;&gt;</span> <a href="../../B00_std/Fpath/index.html#type-t">B00_std.Fpath.t</a></code></div><div><p><code>dir s</code> is the scratch directory of <code>s</code>. Key fibers using this directory to write files should do so using nice file name prefixes (e.g. lowercased module or lib names) to avoid name clashes.</p></div></div><div><div class="spec value" id="val-key" class="anchored"><a href="#val-key" class="anchor"></a><code><span class="keyword">val</span> key : <span>?&#8288;mark:string</span> <span>&#45;&gt;</span> <span>(<a href="index.html#type-t">t</a> <span>&#45;&gt;</span> <a href="../Memo/index.html#type-t">Memo.t</a> <span>&#45;&gt;</span> <span><span class="type-var">'a</span> <a href="../Memo/index.html#type-fiber">Memo.fiber</a></span>)</span> <span>&#45;&gt;</span> <span><span class="type-var">'a</span> <a href="index.html#type-key">key</a></span></code></div><div><p><code>key ~mark det</code> is a new key whose value is determined on <a href="index.html#val-get">access</a> by the fiber:</p><pre><code>det s (Memo.with_mark mark (Store.memo s))</code></pre><p><code>mark</code> defaults to <code>&quot;&quot;</code>.</p></div></div><div><div class="spec value" id="val-get" class="anchored"><a href="#val-get" class="anchor"></a><code><span class="keyword">val</span> get : <a href="index.html#type-t">t</a> <span>&#45;&gt;</span> <span><span class="type-var">'a</span> <a href="index.html#type-key">key</a></span> <span>&#45;&gt;</span> <span><span class="type-var">'a</span> <a href="../Memo/index.html#type-fiber">Memo.fiber</a></span></code></div><div><p><code>get s k</code> is the value bound to <code>k</code> in <code>s</code>.</p></div></div></div></body></html>