<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"><head><title>Op (b0.B000.Op)</title><link rel="stylesheet" href="../../../_odoc-theme/odoc.css"/><meta charset="utf-8"/><meta name="generator" content="odoc v1.1.1-1373-g2e7c1c75"/><meta name="viewport" content="width=device-width,initial-scale=1.0"/><script src="../../../highlight.pack.js"></script><script>hljs.initHighlightingOnLoad();</script></head><body><nav><a href="../index.html">Up</a> â€“ <a href="../../index.html">b0</a> &#x00BB; <a href="../index.html">B000</a> &#x00BB; Op</nav><header><h1>Module <code>B000.Op</code></h1><p>Build operations.</p><p>This module provides a type for <em>specifying</em> operations and their result. Operation execution and caching are respectively handled by the <a href="../Exec/index.html"><code>Exec</code></a> and <a href="../Reviver/index.html"><code>Reviver</code></a> modules.</p></header><nav class="toc"><ul><li><a href="#op_status">Operation status</a></li><li><a href="#op">Operations</a></li><li><a href="#upd">Updating the build operation</a></li><li><a href="#set_map">Operation sets and map</a></li><li><a href="#analyze">Analyzing operations</a></li></ul></nav><div class="content"><h2 id="op_status"><a href="#op_status" class="anchor"></a>Operation status</h2><div><div class="spec type" id="type-failure" class="anchored"><a href="#type-failure" class="anchor"></a><code><span class="keyword">type</span> failure = </code><table><tr id="type-failure.Exec" class="anchored"><td class="def variant constructor"><a href="#type-failure.Exec" class="anchor"></a><code>| <span class="constructor">Exec</span> <span class="keyword">of</span> <span>string option</span></code></td><td class="doc"><p>Execution failure with a potential error msg.</p></td></tr><tr id="type-failure.Missing_writes" class="anchored"><td class="def variant constructor"><a href="#type-failure.Missing_writes" class="anchor"></a><code>| <span class="constructor">Missing_writes</span> <span class="keyword">of</span> <span><a href="../../B00_std/Fpath/index.html#type-t">B00_std.Fpath.t</a> list</span></code></td><td class="doc"><p>Write specification failure.</p></td></tr><tr id="type-failure.Missing_reads" class="anchored"><td class="def variant constructor"><a href="#type-failure.Missing_reads" class="anchor"></a><code>| <span class="constructor">Missing_reads</span> <span class="keyword">of</span> <span><a href="../../B00_std/Fpath/index.html#type-t">B00_std.Fpath.t</a> list</span></code></td><td class="doc"><p>Read synchronisation failure.</p></td></tr></table></div><div><p>The type for operation failures.</p></div></div><div><div class="spec type" id="type-status" class="anchored"><a href="#type-status" class="anchor"></a><code><span class="keyword">type</span> status = </code><table><tr id="type-status.Aborted" class="anchored"><td class="def variant constructor"><a href="#type-status.Aborted" class="anchor"></a><code>| <span class="constructor">Aborted</span></code></td><td class="doc"><p>Aborted due to prerequisite failure.</p></td></tr><tr id="type-status.Done" class="anchored"><td class="def variant constructor"><a href="#type-status.Done" class="anchor"></a><code>| <span class="constructor">Done</span></code></td><td class="doc"><p>Executed successfully.</p></td></tr><tr id="type-status.Failed" class="anchored"><td class="def variant constructor"><a href="#type-status.Failed" class="anchor"></a><code>| <span class="constructor">Failed</span> <span class="keyword">of</span> <a href="index.html#type-failure">failure</a></code></td><td class="doc"><p>Executed unsuccessfully.</p></td></tr><tr id="type-status.Waiting" class="anchored"><td class="def variant constructor"><a href="#type-status.Waiting" class="anchor"></a><code>| <span class="constructor">Waiting</span></code></td><td class="doc"><p>Waiting for execution.</p></td></tr></table></div><div><p>The type for operation statuses.</p></div></div><h2 id="op"><a href="#op" class="anchor"></a>Operations</h2><div><div class="spec type" id="type-id" class="anchored"><a href="#type-id" class="anchor"></a><code><span class="keyword">type</span> id = int</code></div><div><p>The type for build operation identifiers.</p></div></div><div><div class="spec type" id="type-mark" class="anchored"><a href="#type-mark" class="anchor"></a><code><span class="keyword">type</span> mark = string</code></div><div><p>The type for build operation marks. Marks have no special semantics they are just used to label operations for UI purposes.</p></div></div><div><div class="spec type" id="type-t" class="anchored"><a href="#type-t" class="anchor"></a><code><span class="keyword">type</span> t</code></div><div><p>The type for build operations.</p></div></div><div><div class="spec type" id="type-op" class="anchored"><a href="#type-op" class="anchor"></a><code><span class="keyword">type</span> op = <a href="index.html#type-t">t</a></code></div><div><p>Again.</p></div></div><div><div class="spec module" id="module-Copy" class="anchored"><a href="#module-Copy" class="anchor"></a><code><span class="keyword">module</span> <a href="Copy/index.html">Copy</a> : <span class="keyword">sig</span> ... <span class="keyword">end</span></code></div><div><p>File copy.</p></div></div><div><div class="spec module" id="module-Delete" class="anchored"><a href="#module-Delete" class="anchor"></a><code><span class="keyword">module</span> <a href="Delete/index.html">Delete</a> : <span class="keyword">sig</span> ... <span class="keyword">end</span></code></div><div><p>Path deletion.</p></div></div><div><div class="spec module" id="module-Mkdir" class="anchored"><a href="#module-Mkdir" class="anchor"></a><code><span class="keyword">module</span> <a href="Mkdir/index.html">Mkdir</a> : <span class="keyword">sig</span> ... <span class="keyword">end</span></code></div><div><p>Directory creation.</p></div></div><div><div class="spec module" id="module-Notify" class="anchored"><a href="#module-Notify" class="anchor"></a><code><span class="keyword">module</span> <a href="Notify/index.html">Notify</a> : <span class="keyword">sig</span> ... <span class="keyword">end</span></code></div><div><p>End-user notifications.</p></div></div><div><div class="spec module" id="module-Read" class="anchored"><a href="#module-Read" class="anchor"></a><code><span class="keyword">module</span> <a href="Read/index.html">Read</a> : <span class="keyword">sig</span> ... <span class="keyword">end</span></code></div><div><p>File reads.</p></div></div><div><div class="spec module" id="module-Spawn" class="anchored"><a href="#module-Spawn" class="anchor"></a><code><span class="keyword">module</span> <a href="Spawn/index.html">Spawn</a> : <span class="keyword">sig</span> ... <span class="keyword">end</span></code></div><div><p>Tool spawns.</p></div></div><div><div class="spec module" id="module-Wait_files" class="anchored"><a href="#module-Wait_files" class="anchor"></a><code><span class="keyword">module</span> <a href="Wait_files/index.html">Wait_files</a> : <span class="keyword">sig</span> ... <span class="keyword">end</span></code></div><div><p>Waiting on files.</p></div></div><div><div class="spec module" id="module-Write" class="anchored"><a href="#module-Write" class="anchor"></a><code><span class="keyword">module</span> <a href="Write/index.html">Write</a> : <span class="keyword">sig</span> ... <span class="keyword">end</span></code></div><div><p>File writes.</p></div></div><div><div class="spec type" id="type-kind" class="anchored"><a href="#type-kind" class="anchor"></a><code><span class="keyword">type</span> kind = </code><table><tr id="type-kind.Copy" class="anchored"><td class="def variant constructor"><a href="#type-kind.Copy" class="anchor"></a><code>| <span class="constructor">Copy</span> <span class="keyword">of</span> <a href="Copy/index.html#type-t">Copy.t</a></code></td></tr><tr id="type-kind.Delete" class="anchored"><td class="def variant constructor"><a href="#type-kind.Delete" class="anchor"></a><code>| <span class="constructor">Delete</span> <span class="keyword">of</span> <a href="Delete/index.html#type-t">Delete.t</a></code></td></tr><tr id="type-kind.Mkdir" class="anchored"><td class="def variant constructor"><a href="#type-kind.Mkdir" class="anchor"></a><code>| <span class="constructor">Mkdir</span> <span class="keyword">of</span> <a href="Mkdir/index.html#type-t">Mkdir.t</a></code></td></tr><tr id="type-kind.Notify" class="anchored"><td class="def variant constructor"><a href="#type-kind.Notify" class="anchor"></a><code>| <span class="constructor">Notify</span> <span class="keyword">of</span> <a href="Notify/index.html#type-t">Notify.t</a></code></td></tr><tr id="type-kind.Read" class="anchored"><td class="def variant constructor"><a href="#type-kind.Read" class="anchor"></a><code>| <span class="constructor">Read</span> <span class="keyword">of</span> <a href="Read/index.html#type-t">Read.t</a></code></td></tr><tr id="type-kind.Spawn" class="anchored"><td class="def variant constructor"><a href="#type-kind.Spawn" class="anchor"></a><code>| <span class="constructor">Spawn</span> <span class="keyword">of</span> <a href="Spawn/index.html#type-t">Spawn.t</a></code></td></tr><tr id="type-kind.Wait_files" class="anchored"><td class="def variant constructor"><a href="#type-kind.Wait_files" class="anchor"></a><code>| <span class="constructor">Wait_files</span> <span class="keyword">of</span> <a href="Wait_files/index.html#type-t">Wait_files.t</a></code></td></tr><tr id="type-kind.Write" class="anchored"><td class="def variant constructor"><a href="#type-kind.Write" class="anchor"></a><code>| <span class="constructor">Write</span> <span class="keyword">of</span> <a href="Write/index.html#type-t">Write.t</a></code></td></tr></table></div><div><p>The type for operation kinds.</p></div></div><div><div class="spec value" id="val-kind_name" class="anchored"><a href="#val-kind_name" class="anchor"></a><code><span class="keyword">val</span> kind_name : <a href="index.html#type-kind">kind</a> <span>&#45;&gt;</span> string</code></div><div><p><code>kind_name k</code> is an end user name for kind <code>k</code>.</p></div></div><div><div class="spec value" id="val-v" class="anchored"><a href="#val-v" class="anchor"></a><code><span class="keyword">val</span> v : <a href="index.html#type-id">id</a> <span>&#45;&gt;</span> <span>mark:<a href="index.html#type-mark">mark</a></span> <span>&#45;&gt;</span> <span>time_created:<a href="../../B00_std/Time/index.html#type-span">B00_std.Time.span</a></span> <span>&#45;&gt;</span> <span>time_started:<a href="../../B00_std/Time/index.html#type-span">B00_std.Time.span</a></span> <span>&#45;&gt;</span> <span>duration:<a href="../../B00_std/Time/index.html#type-span">B00_std.Time.span</a></span> <span>&#45;&gt;</span> <span>revived:bool</span> <span>&#45;&gt;</span> <span>status:<a href="index.html#type-status">status</a></span> <span>&#45;&gt;</span> <span>reads:<span><a href="../../B00_std/Fpath/index.html#type-t">B00_std.Fpath.t</a> list</span></span> <span>&#45;&gt;</span> <span>writes:<span><a href="../../B00_std/Fpath/index.html#type-t">B00_std.Fpath.t</a> list</span></span> <span>&#45;&gt;</span> <span>writes_manifest_root:<span><a href="../../B00_std/Fpath/index.html#type-t">B00_std.Fpath.t</a> option</span></span> <span>&#45;&gt;</span> <span>hash:<a href="../../B00_std/Hash/index.html#type-t">B00_std.Hash.t</a></span> <span>&#45;&gt;</span> <span>?&#8288;post_exec:<span>(<a href="index.html#type-op">op</a> <span>&#45;&gt;</span> unit)</span></span> <span>&#45;&gt;</span> <span>?&#8288;k:<span>(<a href="index.html#type-op">op</a> <span>&#45;&gt;</span> unit)</span></span> <span>&#45;&gt;</span> <a href="index.html#type-kind">kind</a> <span>&#45;&gt;</span> <a href="index.html#type-t">t</a></code></div><div><p><code>v</code> constructs an operation. See the corresponding accessors for the semantics of various arguments.</p></div></div><div><div class="spec value" id="val-kind" class="anchored"><a href="#val-kind" class="anchor"></a><code><span class="keyword">val</span> kind : <a href="index.html#type-t">t</a> <span>&#45;&gt;</span> <a href="index.html#type-kind">kind</a></code></div><div><p><code>kind o</code> is <code>o</code>'s kind.</p></div></div><div><div class="spec value" id="val-equal" class="anchored"><a href="#val-equal" class="anchor"></a><code><span class="keyword">val</span> equal : <a href="index.html#type-t">t</a> <span>&#45;&gt;</span> <a href="index.html#type-t">t</a> <span>&#45;&gt;</span> bool</code></div><div><p><code>equal o0 o1</code> is <code>id o0 = id o1</code>.</p></div></div><div><div class="spec value" id="val-compare" class="anchored"><a href="#val-compare" class="anchor"></a><code><span class="keyword">val</span> compare : <a href="index.html#type-t">t</a> <span>&#45;&gt;</span> <a href="index.html#type-t">t</a> <span>&#45;&gt;</span> int</code></div><div><p><code>compare o0 o1</code> is <code>compare (id o0) (id o1)</code>.</p></div></div><div><div class="spec value" id="val-id" class="anchored"><a href="#val-id" class="anchor"></a><code><span class="keyword">val</span> id : <a href="index.html#type-t">t</a> <span>&#45;&gt;</span> <a href="index.html#type-id">id</a></code></div><div><p><code>id o</code> is the identifier of operation <code>o</code>.</p></div></div><div><div class="spec value" id="val-mark" class="anchored"><a href="#val-mark" class="anchor"></a><code><span class="keyword">val</span> mark : <a href="index.html#type-t">t</a> <span>&#45;&gt;</span> string</code></div><div><p><code>mark o</code> is the mark of <code>o</code>.</p></div></div><div><div class="spec value" id="val-time_created" class="anchored"><a href="#val-time_created" class="anchor"></a><code><span class="keyword">val</span> time_created : <a href="index.html#type-t">t</a> <span>&#45;&gt;</span> <a href="../../B00_std/Time/index.html#type-span">B00_std.Time.span</a></code></div><div><p><code>time_created o</code> is <code>o</code>'s creation time.</p></div></div><div><div class="spec value" id="val-time_started" class="anchored"><a href="#val-time_started" class="anchor"></a><code><span class="keyword">val</span> time_started : <a href="index.html#type-t">t</a> <span>&#45;&gt;</span> <a href="../../B00_std/Time/index.html#type-span">B00_std.Time.span</a></code></div><div><p><code>time_started o</code> is <code>o</code>'s execution start time. This is different from <a href="../../B00_std/Time/Span/index.html#val-max"><code>B00_std.Time.Span.max</code></a> once the operation has been submitted for execution.</p></div></div><div><div class="spec value" id="val-time_ended" class="anchored"><a href="#val-time_ended" class="anchor"></a><code><span class="keyword">val</span> time_ended : <a href="index.html#type-t">t</a> <span>&#45;&gt;</span> <a href="../../B00_std/Time/index.html#type-span">B00_std.Time.span</a></code></div><div><p><code>exec_end_time o</code> is <code>o</code>'s execution end time. This is different from <a href="../../B00_std/Time/Span/index.html#val-max"><code>B00_std.Time.Span.max</code></a> once the operation has been completed and collected.</p></div></div><div><div class="spec value" id="val-waited" class="anchored"><a href="#val-waited" class="anchor"></a><code><span class="keyword">val</span> waited : <a href="index.html#type-t">t</a> <span>&#45;&gt;</span> <a href="../../B00_std/Time/index.html#type-span">B00_std.Time.span</a></code></div><div><p><code>waited</code> is <code>o</code>'s waiting time between creation and execution.</p></div></div><div><div class="spec value" id="val-duration" class="anchored"><a href="#val-duration" class="anchor"></a><code><span class="keyword">val</span> duration : <a href="index.html#type-t">t</a> <span>&#45;&gt;</span> <a href="../../B00_std/Time/index.html#type-span">B00_std.Time.span</a></code></div><div><p><code>duration</code> is <code>o</code>'s execution duration time.</p></div></div><div><div class="spec value" id="val-revived" class="anchored"><a href="#val-revived" class="anchor"></a><code><span class="keyword">val</span> revived : <a href="index.html#type-t">t</a> <span>&#45;&gt;</span> bool</code></div><div><p><code>revived o</code> is <code>true</code> iff <code>o</code> was revived from a cache. Only relevant if <a href="index.html#val-hash"><code>hash</code></a> is not <code>Hash</code>.nil.</p></div></div><div><div class="spec value" id="val-status" class="anchored"><a href="#val-status" class="anchor"></a><code><span class="keyword">val</span> status : <a href="index.html#type-t">t</a> <span>&#45;&gt;</span> <a href="index.html#type-status">status</a></code></div><div><p><code>status o</code> is <code>o</code> execution status.</p></div></div><div><div class="spec value" id="val-reads" class="anchored"><a href="#val-reads" class="anchor"></a><code><span class="keyword">val</span> reads : <a href="index.html#type-t">t</a> <span>&#45;&gt;</span> <span><a href="../../B00_std/Fpath/index.html#type-t">B00_std.Fpath.t</a> list</span></code></div><div><p><code>reads o</code> are the file paths read by the operation.</p></div></div><div><div class="spec value" id="val-writes" class="anchored"><a href="#val-writes" class="anchor"></a><code><span class="keyword">val</span> writes : <a href="index.html#type-t">t</a> <span>&#45;&gt;</span> <span><a href="../../B00_std/Fpath/index.html#type-t">B00_std.Fpath.t</a> list</span></code></div><div><p><code>writes o</code> are the file paths written by <code>o</code>.</p></div></div><div><div class="spec value" id="val-writes_manifest_root" class="anchored"><a href="#val-writes_manifest_root" class="anchor"></a><code><span class="keyword">val</span> writes_manifest_root : <a href="index.html#type-t">t</a> <span>&#45;&gt;</span> <span><a href="../../B00_std/Fpath/index.html#type-t">B00_std.Fpath.t</a> option</span></code></div><div><p><code>writes_manifest_root o</code> if <code>Some root</code>, the operation is cached using a manifest key. This means the <a href="index.html#val-writes"><code>writes</code></a> made relative to <code>root</code> are stored along-side the cache key.</p></div></div><div><div class="spec value" id="val-hash" class="anchored"><a href="#val-hash" class="anchor"></a><code><span class="keyword">val</span> hash : <a href="index.html#type-t">t</a> <span>&#45;&gt;</span> <a href="../../B00_std/Hash/index.html#type-t">B00_std.Hash.t</a></code></div><div><p><code>hash o</code> is the operation's hash. This is <code>Hash</code>.nil before the operation hash has been effectively computed and set via <a href="index.html#val-set_hash"><code>set_hash</code></a>. This remains <code>Hash</code>.nil for operations that are not revivable.</p></div></div><h2 id="upd"><a href="#upd" class="anchor"></a>Updating the build operation</h2><div><div class="spec value" id="val-invoke_k" class="anchored"><a href="#val-invoke_k" class="anchor"></a><code><span class="keyword">val</span> invoke_k : <a href="index.html#type-t">t</a> <span>&#45;&gt;</span> unit</code></div><div><p><code>exec_k o ()</code> invokes and discards <code>o</code>'s continuation. Note that this does <b>not</b> protect against the continuation raising.</p></div></div><div><div class="spec value" id="val-discard_k" class="anchored"><a href="#val-discard_k" class="anchor"></a><code><span class="keyword">val</span> discard_k : <a href="index.html#type-t">t</a> <span>&#45;&gt;</span> unit</code></div><div><p><code>discard o</code> discards <code>o</code>'s continuation.</p></div></div><div><div class="spec value" id="val-invoke_post_exec" class="anchored"><a href="#val-invoke_post_exec" class="anchor"></a><code><span class="keyword">val</span> invoke_post_exec : <a href="index.html#type-t">t</a> <span>&#45;&gt;</span> unit</code></div><div><p><code>exec_post_exec o</code> invokes and discards <code>o</code>'s post execution hook. This hook called is right after the operation execution and, if applicable, <b>before</b> reviver recording. It is always called even if the operation fails or is revived (use <a href="index.html#val-status"><code>status</code></a> and <a href="index.html#val-revived"><code>revived</code></a> to check these conditions). Note that if the hook unexpectedly raises this turns <code>o</code> in to a failure.</p></div></div><div><div class="spec value" id="val-discard_post_exec" class="anchored"><a href="#val-discard_post_exec" class="anchor"></a><code><span class="keyword">val</span> discard_post_exec : <a href="index.html#type-t">t</a> <span>&#45;&gt;</span> unit</code></div><div><p><code>discard_post_exec o</code> discards <code>o</code>'s post execution hook.</p></div></div><div><div class="spec value" id="val-abort" class="anchored"><a href="#val-abort" class="anchor"></a><code><span class="keyword">val</span> abort : <a href="index.html#type-t">t</a> <span>&#45;&gt;</span> unit</code></div><div><p><code>abort o</code> sets the status of <code>o</code> to <a href="index.html#type-status.Aborted"><code>Op.status.Aborted</code></a> and discards the operation closures (including kind specific ones).</p></div></div><div><div class="spec value" id="val-set_time_started" class="anchored"><a href="#val-set_time_started" class="anchor"></a><code><span class="keyword">val</span> set_time_started : <a href="index.html#type-t">t</a> <span>&#45;&gt;</span> <a href="../../B00_std/Time/index.html#type-span">B00_std.Time.span</a> <span>&#45;&gt;</span> unit</code></div><div><p><code>set_time_started o t</code> sets <code>o</code>'s execution start time to <code>t</code>.</p></div></div><div><div class="spec value" id="val-set_time_ended" class="anchored"><a href="#val-set_time_ended" class="anchor"></a><code><span class="keyword">val</span> set_time_ended : <a href="index.html#type-t">t</a> <span>&#45;&gt;</span> <a href="../../B00_std/Time/index.html#type-span">B00_std.Time.span</a> <span>&#45;&gt;</span> unit</code></div><div><p><code>set_time_ended o t</code> sets <code>o</code>'s execution end time to <code>s</code>.</p></div></div><div><div class="spec value" id="val-set_revived" class="anchored"><a href="#val-set_revived" class="anchor"></a><code><span class="keyword">val</span> set_revived : <a href="index.html#type-t">t</a> <span>&#45;&gt;</span> bool <span>&#45;&gt;</span> unit</code></div><div><p><code>set_revived o b</code> sets <code>o</code>'s cache revival status to <code>b</code>.</p></div></div><div><div class="spec value" id="val-set_status" class="anchored"><a href="#val-set_status" class="anchor"></a><code><span class="keyword">val</span> set_status : <a href="index.html#type-t">t</a> <span>&#45;&gt;</span> <a href="index.html#type-status">status</a> <span>&#45;&gt;</span> unit</code></div><div><p><code>set_status o s</code> sets the execution status to <code>s</code>.</p></div></div><div><div class="spec value" id="val-set_status_from_result" class="anchored"><a href="#val-set_status_from_result" class="anchor"></a><code><span class="keyword">val</span> set_status_from_result : <a href="index.html#type-t">t</a> <span>&#45;&gt;</span> <span><span>(<span class="type-var">'a</span>,Â string)</span> <a href="../../../ocaml/Stdlib/index.html#type-result">Stdlib.result</a></span> <span>&#45;&gt;</span> unit</code></div><div><p><code>set_status_from_result o r</code> sets status of operation <code>o</code> to <code>Executed</code> if <code>r</code> is <code>Ok _</code> and <code>Failed (Exec e)</code> if <code>r</code> is <code>Error e</code>.</p></div></div><div><div class="spec value" id="val-set_reads" class="anchored"><a href="#val-set_reads" class="anchor"></a><code><span class="keyword">val</span> set_reads : <a href="index.html#type-t">t</a> <span>&#45;&gt;</span> <span><a href="../../B00_std/Fpath/index.html#type-t">B00_std.Fpath.t</a> list</span> <span>&#45;&gt;</span> unit</code></div><div><p><code>set_reads t fs</code> sets the file paths read by <code>o</code> to <code>fs</code>. Note that this resets the <a href="index.html#val-hash"><code>hash</code></a>.</p></div></div><div><div class="spec value" id="val-set_writes" class="anchored"><a href="#val-set_writes" class="anchor"></a><code><span class="keyword">val</span> set_writes : <a href="index.html#type-t">t</a> <span>&#45;&gt;</span> <span><a href="../../B00_std/Fpath/index.html#type-t">B00_std.Fpath.t</a> list</span> <span>&#45;&gt;</span> unit</code></div><div><p><code>set_writes t fs</code> sets the file paths written by <code>o</code> to <code>fs</code>.</p></div></div><div><div class="spec value" id="val-set_writes_manifest_root" class="anchored"><a href="#val-set_writes_manifest_root" class="anchor"></a><code><span class="keyword">val</span> set_writes_manifest_root : <a href="index.html#type-t">t</a> <span>&#45;&gt;</span> <span><a href="../../B00_std/Fpath/index.html#type-t">B00_std.Fpath.t</a> option</span> <span>&#45;&gt;</span> unit</code></div><div><p><code>set_writes_manifest_root t r</code> sets the writes manifest root to <code>r</code>.</p></div></div><div><div class="spec value" id="val-set_hash" class="anchored"><a href="#val-set_hash" class="anchor"></a><code><span class="keyword">val</span> set_hash : <a href="index.html#type-t">t</a> <span>&#45;&gt;</span> <a href="../../B00_std/Hash/index.html#type-t">B00_std.Hash.t</a> <span>&#45;&gt;</span> unit</code></div><div><p><code>set_hash o h</code> sets the operation hash to <code>h</code>.</p></div></div><h2 id="set_map"><a href="#set_map" class="anchor"></a>Operation sets and map</h2><div><div class="spec module" id="module-Set" class="anchored"><a href="#module-Set" class="anchor"></a><code><span class="keyword">module</span> <a href="Set/index.html">Set</a> : <a href="../../../ocaml/Stdlib/Set/module-type-S/index.html">Stdlib.Set.S</a> <span class="keyword">with</span> <span class="keyword">type</span> <a href="../../../ocaml/Stdlib/Set/module-type-S/index.html#type-elt">elt</a> = <a href="index.html#type-t">t</a></code></div><div><p>Operation sets</p></div></div><div><div class="spec module" id="module-Map" class="anchored"><a href="#module-Map" class="anchor"></a><code><span class="keyword">module</span> <a href="Map/index.html">Map</a> : <a href="../../../ocaml/Stdlib/Map/module-type-S/index.html">Stdlib.Map.S</a> <span class="keyword">with</span> <span class="keyword">type</span> <a href="../../../ocaml/Stdlib/Map/module-type-S/index.html#type-key">key</a> = <a href="index.html#type-t">t</a></code></div><div><p>Operation maps</p></div></div><h2 id="analyze"><a href="#analyze" class="anchor"></a>Analyzing operations</h2><div><div class="spec value" id="val-did_not_write" class="anchored"><a href="#val-did_not_write" class="anchor"></a><code><span class="keyword">val</span> did_not_write : <a href="index.html#type-t">t</a> <span>&#45;&gt;</span> <span><a href="../../B00_std/Fpath/index.html#type-t">B00_std.Fpath.t</a> list</span></code></div><div><p><code>did_not_write o</code> compares <a href="index.html#val-writes"><code>writes</code></a> with the current state of the file system and reports those files that do not exist.</p></div></div><div><div class="spec value" id="val-cannot_read" class="anchored"><a href="#val-cannot_read" class="anchor"></a><code><span class="keyword">val</span> cannot_read : <a href="index.html#type-t">t</a> <span>&#45;&gt;</span> <span><a href="../../B00_std/Fpath/index.html#type-t">B00_std.Fpath.t</a> list</span></code></div><div><p><code>cannot_read o</code> compares <a href="index.html#val-reads"><code>reads</code></a> with the current state of the file system and reports those files that cannot be read.</p></div></div><div><div class="spec value" id="val-unready_reads" class="anchored"><a href="#val-unready_reads" class="anchor"></a><code><span class="keyword">val</span> unready_reads : <span>ready_roots:<a href="../../B00_std/Fpath/Set/index.html#type-t">B00_std.Fpath.Set.t</a></span> <span>&#45;&gt;</span> <span><a href="index.html#type-t">t</a> list</span> <span>&#45;&gt;</span> <a href="../../B00_std/Fpath/Set/index.html#type-t">B00_std.Fpath.Set.t</a></code></div><div><p><code>unready_reads os</code> are the file read by <code>os</code> that are not written by those and not in <code>ready_roots</code>.</p></div></div><div><div class="spec value" id="val-read_write_maps" class="anchored"><a href="#val-read_write_maps" class="anchor"></a><code><span class="keyword">val</span> read_write_maps : <span><a href="index.html#type-t">t</a> list</span> <span>&#45;&gt;</span> <span><a href="Set/index.html#type-t">Set.t</a> <a href="../../B00_std/Fpath/Map/index.html#type-t">B00_std.Fpath.Map.t</a></span> * <span><a href="Set/index.html#type-t">Set.t</a> <a href="../../B00_std/Fpath/Map/index.html#type-t">B00_std.Fpath.Map.t</a></span></code></div><div><p><code>read_write_maps ops</code> is <code>reads, writes</code> with <code>reads</code> mapping file paths to operations that reads them and <code>writes</code> mapping file paths to operations that write them.</p></div></div><div><div class="spec value" id="val-write_map" class="anchored"><a href="#val-write_map" class="anchor"></a><code><span class="keyword">val</span> write_map : <span><a href="index.html#type-t">t</a> list</span> <span>&#45;&gt;</span> <span><a href="Set/index.html#type-t">Set.t</a> <a href="../../B00_std/Fpath/Map/index.html#type-t">B00_std.Fpath.Map.t</a></span></code></div><div><p><code>write_map os</code> is <code>snd (read_write_maps os)</code>. If one of the operation sets in the map is not a singleton the operations should likely not be run toghether.</p></div></div><div><div class="spec value" id="val-find_read_write_cycle" class="anchored"><a href="#val-find_read_write_cycle" class="anchor"></a><code><span class="keyword">val</span> find_read_write_cycle : <span><a href="index.html#type-t">t</a> list</span> <span>&#45;&gt;</span> <span><span><a href="index.html#type-t">t</a> list</span> option</span></code></div><div><p><code>find_read_write_cycle os</code> is <code>Some cs</code> if there exists a read/write cycle among the operations <code>os</code>. This means each each element of <code>cs</code> writes a file read by its successor in the list with the successor of the last element being the first.</p></div></div><div><div class="spec type" id="type-aggregate_error" class="anchored"><a href="#type-aggregate_error" class="anchor"></a><code><span class="keyword">type</span> aggregate_error = </code><table><tr id="type-aggregate_error.Failures" class="anchored"><td class="def variant constructor"><a href="#type-aggregate_error.Failures" class="anchor"></a><code>| <span class="constructor">Failures</span></code></td><td class="doc"><p>Some operations failed.</p></td></tr><tr id="type-aggregate_error.Cycle" class="anchored"><td class="def variant constructor"><a href="#type-aggregate_error.Cycle" class="anchor"></a><code>| <span class="constructor">Cycle</span> <span class="keyword">of</span> <span><a href="index.html#type-t">t</a> list</span></code></td><td class="doc"><p>Dependency cycle.</p></td></tr><tr id="type-aggregate_error.Never_became_ready" class="anchored"><td class="def variant constructor"><a href="#type-aggregate_error.Never_became_ready" class="anchor"></a><code>| <span class="constructor">Never_became_ready</span> <span class="keyword">of</span> <a href="../../B00_std/Fpath/Set/index.html#type-t">B00_std.Fpath.Set.t</a></code></td><td class="doc"><p>Some files never became ready.</p></td></tr></table></div><div><p>The type for errors related to a <em>list</em> of operations. This is:</p><ul><li><code>Failures</code>, if there is one or more operations in the list that <a href="index.html#type-status.Failed"><code>Failed</code></a> (and hence for a <a href="../../B00/Memo/index.html"><code>B00.Memo</code></a> also if a fiber failed, see <a href="../../B00/Memo/index.html#type-fiber">here</a>).</li><li><code>Cycle ops</code>, if there is a set of <a href="index.html#type-status.Waiting"><code>Waiting</code></a> operations in the list whose individual reads and writes leads to a dependency cycle. See also <a href="index.html#val-find_read_write_cycle"><code>find_read_write_cycle</code></a>.</li><li><code>Never_became_ready fs</code>, with <code>fs</code> files that are in the reads of <a href="index.html#type-status.Waiting"><code>Waiting</code></a> operations but are written by no operation from the list and were not made ready.</li></ul><p>Note that formally more than one of these conditions can be true at the same time. But <code>Never_became_ready</code> is only reported once the first two kind of errors have been ruled out. The reason is that those files that never became ready may be created by continuations of the failed or cyclic operations and reporting them would not lead the user to focus on the right cause.</p></div></div><div><div class="spec value" id="val-find_aggregate_error" class="anchored"><a href="#val-find_aggregate_error" class="anchor"></a><code><span class="keyword">val</span> find_aggregate_error : <span>ready_roots:<a href="../../B00_std/Fpath/Set/index.html#type-t">B00_std.Fpath.Set.t</a></span> <span>&#45;&gt;</span> <span><a href="index.html#type-t">t</a> list</span> <span>&#45;&gt;</span> <span><span>(unit,Â <a href="index.html#type-aggregate_error">aggregate_error</a>)</span> <a href="../../../ocaml/Stdlib/index.html#type-result">Stdlib.result</a></span></code></div><div><p><code>find_aggregate_error ~ready_roots os</code> finds an aggregate error among the list of operation <code>os</code>, assuming files <code>ready_roots</code> were made ready. This is <code>Ok ()</code> if all operations <code>os</code> <code>Executed</code>.</p></div></div></div></body></html>