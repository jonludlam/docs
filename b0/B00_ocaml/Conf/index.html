<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"><head><title>Conf (b0.B00_ocaml.Conf)</title><link rel="stylesheet" href="../../../_odoc-theme/odoc.css"/><meta charset="utf-8"/><meta name="generator" content="odoc v1.1.1-1373-g2e7c1c75"/><meta name="viewport" content="width=device-width,initial-scale=1.0"/><script src="../../../highlight.pack.js"></script><script>hljs.initHighlightingOnLoad();</script></head><body><nav><a href="../index.html">Up</a> – <a href="../../index.html">b0</a> &#x00BB; <a href="../index.html">B00_ocaml</a> &#x00BB; Conf</nav><header><h1>Module <code>B00_ocaml.Conf</code></h1><p>OCaml toolchain configuration.</p><p>Thid module provides access to the OCaml toolchain configuration as output by <code>ocaml{c,opt} -config</code>.</p><p>It also provides <span class="xref-unresolved">bits</span> to orchestrate byte and native OCaml builds.</p></header><nav class="toc"><ul><li><a href="#conf">Configuration</a></li><li><a href="#convert">Converting</a></li><li><a href="#io">IO</a></li><li><a href="#build">Build orchestration</a></li><li><a href="#todo">TODO remove that</a></li></ul></nav><div class="content"><h2 id="conf"><a href="#conf" class="anchor"></a>Configuration</h2><div><div class="spec type" id="type-t" class="anchored"><a href="#type-t" class="anchor"></a><code><span class="keyword">type</span> t</code></div><div><p>The type for the OCaml toolchain configuration.</p></div></div><div><div class="spec value" id="val-find" class="anchored"><a href="#val-find" class="anchor"></a><code><span class="keyword">val</span> find : string <span>&#45;&gt;</span> <a href="index.html#type-t">t</a> <span>&#45;&gt;</span> <span>string option</span></code></div><div><p><code>find f c</code> looks up the field <code>f</code> in configuration <code>c</code>. See <code>ocamlc -config</code> for the list of fields.</p></div></div><div><div class="spec value" id="val-version" class="anchored"><a href="#val-version" class="anchor"></a><code><span class="keyword">val</span> version : <a href="index.html#type-t">t</a> <span>&#45;&gt;</span> int * int * int * <span>string option</span></code></div><div><p><code>version c</code> is the compiler version string <code>&quot;major.minor[.patchlevel][+additional-info]&quot;</code> parsed using <code>(major, minor, patch, additional-info)</code>. If <code>patch-level</code> is absent it is turned into a <code>0</code>.</p></div></div><div><div class="spec value" id="val-where" class="anchored"><a href="#val-where" class="anchor"></a><code><span class="keyword">val</span> where : <a href="index.html#type-t">t</a> <span>&#45;&gt;</span> <a href="../../B00_std/Fpath/index.html#type-t">B00_std.Fpath.t</a></code></div><div><p><code>where c</code> is the location of OCaml's library directory.</p></div></div><div><div class="spec value" id="val-asm_ext" class="anchored"><a href="#val-asm_ext" class="anchor"></a><code><span class="keyword">val</span> asm_ext : <a href="index.html#type-t">t</a> <span>&#45;&gt;</span> <a href="../../B00_std/Fpath/index.html#type-ext">B00_std.Fpath.ext</a></code></div><div><p><code>asm_ext</code> is the file extension for assembly files.</p></div></div><div><div class="spec value" id="val-dll_ext" class="anchored"><a href="#val-dll_ext" class="anchor"></a><code><span class="keyword">val</span> dll_ext : <a href="index.html#type-t">t</a> <span>&#45;&gt;</span> <a href="../../B00_std/Fpath/index.html#type-ext">B00_std.Fpath.ext</a></code></div><div><p><code>dll_ext</code> is the file extension for C dynamic libraries.</p></div></div><div><div class="spec value" id="val-exe_ext" class="anchored"><a href="#val-exe_ext" class="anchor"></a><code><span class="keyword">val</span> exe_ext : <a href="index.html#type-t">t</a> <span>&#45;&gt;</span> <a href="../../B00_std/Fpath/index.html#type-ext">B00_std.Fpath.ext</a></code></div><div><p><code>ext_ext</code> is the file extension for executable binaries.</p></div></div><div><div class="spec value" id="val-lib_ext" class="anchored"><a href="#val-lib_ext" class="anchor"></a><code><span class="keyword">val</span> lib_ext : <a href="index.html#type-t">t</a> <span>&#45;&gt;</span> <a href="../../B00_std/Fpath/index.html#type-ext">B00_std.Fpath.ext</a></code></div><div><p><code>ext_lib</code> is the file extension for C static libraries.</p></div></div><div><div class="spec value" id="val-obj_ext" class="anchored"><a href="#val-obj_ext" class="anchor"></a><code><span class="keyword">val</span> obj_ext : <a href="index.html#type-t">t</a> <span>&#45;&gt;</span> <a href="../../B00_std/Fpath/index.html#type-ext">B00_std.Fpath.ext</a></code></div><div><p><code>obj_ext</code> is the file extension for C object files.</p></div></div><h2 id="convert"><a href="#convert" class="anchor"></a>Converting</h2><div><div class="spec value" id="val-to_string_map" class="anchored"><a href="#val-to_string_map" class="anchor"></a><code><span class="keyword">val</span> to_string_map : <a href="index.html#type-t">t</a> <span>&#45;&gt;</span> <span>string <a href="../../B00_std/String/Map/index.html#type-t">B00_std.String.Map.t</a></span></code></div><div><p><code>to_string_map c</code> are the fields of <code>c</code> as a string map.</p></div></div><div><div class="spec value" id="val-of_string_map" class="anchored"><a href="#val-of_string_map" class="anchor"></a><code><span class="keyword">val</span> of_string_map : <span>string <a href="../../B00_std/String/Map/index.html#type-t">B00_std.String.Map.t</a></span> <span>&#45;&gt;</span> <span><span>(<a href="index.html#type-t">t</a>, string)</span> <a href="../../../ocaml/Stdlib/index.html#type-result">Stdlib.result</a></span></code></div><div><p><code>of_string_map m</code> is a configuration from string map <code>m</code>. <code>m</code> needs at least a <code>&quot;version&quot;</code> key otherwise the function errors.</p></div></div><h2 id="io"><a href="#io" class="anchor"></a>IO</h2><div><div class="spec value" id="val-write" class="anchored"><a href="#val-write" class="anchor"></a><code><span class="keyword">val</span> write : <a href="../../B00/Memo/index.html#type-t">B00.Memo.t</a> <span>&#45;&gt;</span> <span>comp:<a href="../../B00/Tool/index.html#type-t">B00.Tool.t</a></span> <span>&#45;&gt;</span> <span>o:<a href="../../B00_std/Fpath/index.html#type-t">B00_std.Fpath.t</a></span> <span>&#45;&gt;</span> unit</code></div><div><p><code>write m ~o</code> writes the toolchain configuration to <code>o</code> by running <code>comp</code> with <code>-config</code>.</p></div></div><div><div class="spec value" id="val-read" class="anchored"><a href="#val-read" class="anchor"></a><code><span class="keyword">val</span> read : <a href="../../B00/Memo/index.html#type-t">B00.Memo.t</a> <span>&#45;&gt;</span> <a href="../../B00_std/Fpath/index.html#type-t">B00_std.Fpath.t</a> <span>&#45;&gt;</span> <span><a href="index.html#type-t">t</a> <a href="../../B00/Memo/index.html#type-fiber">B00.Memo.fiber</a></span></code></div><div><p><code>read m file</code> reads a toolchain configuration from <code>file</code>.</p></div></div><div><div class="spec value" id="val-of_string" class="anchored"><a href="#val-of_string" class="anchor"></a><code><span class="keyword">val</span> of_string : <span>?&#8288;file:<a href="../../B00_std/Fpath/index.html#type-t">B00_std.Fpath.t</a></span> <span>&#45;&gt;</span> string <span>&#45;&gt;</span> <span><span>(<a href="index.html#type-t">t</a>, string)</span> <a href="../../../ocaml/Stdlib/index.html#type-result">Stdlib.result</a></span></code></div><div><p><code>of_string ~file data</code> parses toolchain configuration from <code>data</code> as output by the compiler's <code>-config</code> option assuming it was read from file <code>file</code> (defaults to <a href="../../B00_std/Os/File/index.html#val-dash"><code>B00_std.Os.File.dash</code></a>.</p></div></div><h2 id="build"><a href="#build" class="anchor"></a>Build orchestration</h2><aside><p><b>XXX</b> Maybe move that to <a href="../../B0_ocaml/index.html"><code>B0_ocaml</code></a>.</p><p>In a build it is desirable to know which code is being produced because if both are produced the compilers may compete to produce some of the shared build artefacts. The following store keys allow to express build code <a href="index.html#val-build_code">desires</a> and determine the actual <a href="index.html#val-built_code">decision</a>.</p></aside><div><div class="spec type" id="type-built_code" class="anchored"><a href="#type-built_code" class="anchor"></a><code><span class="keyword">type</span> built_code = [ </code><table><tr id="type-built_code.Byte" class="anchored"><td class="def constructor"><a href="#type-built_code.Byte" class="anchor"></a><code>| </code><code>`Byte</code></td></tr><tr id="type-built_code.Native" class="anchored"><td class="def constructor"><a href="#type-built_code.Native" class="anchor"></a><code>| </code><code>`Native</code></td></tr><tr id="type-built_code.Both" class="anchored"><td class="def constructor"><a href="#type-built_code.Both" class="anchor"></a><code>| </code><code>`Both</code></td></tr></table><code> ]</code></div><div><p>The type indicating which code is being built.</p></div></div><div><div class="spec value" id="val-build_code" class="anchored"><a href="#val-build_code" class="anchor"></a><code><span class="keyword">val</span> build_code : <span><span>[ <a href="index.html#type-built_code">built_code</a> <span>| `Auto</span> ]</span> <a href="../../B00/Store/index.html#type-key">B00.Store.key</a></span></code></div><div><p><code>build_code</code> indicates which code should be built, default determines to <code>`Auto</code>. <code>`Auto</code> indicates <code>`Native</code> should be used if <code>ocamlopt</code> can be found in the memo environment and <code>`Byte</code> otherwise.</p></div></div><div><div class="spec value" id="val-built_code" class="anchored"><a href="#val-built_code" class="anchor"></a><code><span class="keyword">val</span> built_code : <span><a href="index.html#type-built_code">built_code</a> <a href="../../B00/Store/index.html#type-key">B00.Store.key</a></span></code></div><div><p><code>build_code</code> is a memo key indicating the built code. By default determines by consulting <code>build_code</code>.</p></div></div><div><div class="spec value" id="val-key" class="anchored"><a href="#val-key" class="anchor"></a><code><span class="keyword">val</span> key : <span><a href="index.html#type-t">t</a> <a href="../../B00/Store/index.html#type-key">B00.Store.key</a></span></code></div><div><p><code>key</code> is a memo key store with the OCaml configuration.</p></div></div><h2 id="todo"><a href="#todo" class="anchor"></a>TODO remove that</h2><div class="spec value" id="val-exists" class="anchored"><a href="#val-exists" class="anchor"></a><code><span class="keyword">val</span> exists : <a href="../../B00/Memo/index.html#type-t">B00.Memo.t</a> <span>&#45;&gt;</span> <span>bool <a href="../../B00/Memo/index.html#type-fiber">B00.Memo.fiber</a></span></code></div><div class="spec value" id="val-if_exists" class="anchored"><a href="#val-if_exists" class="anchor"></a><code><span class="keyword">val</span> if_exists : <a href="../../B00/Memo/index.html#type-t">B00.Memo.t</a> <span>&#45;&gt;</span> <span>(unit <span>&#45;&gt;</span> <span><span class="type-var">'a</span> <a href="../../B00/Memo/index.html#type-fiber">B00.Memo.fiber</a></span>)</span> <span>&#45;&gt;</span> <span><span><span class="type-var">'a</span> option</span> <a href="../../B00/Memo/index.html#type-fiber">B00.Memo.fiber</a></span></code></div><div class="spec value" id="val-stdlib_dir" class="anchored"><a href="#val-stdlib_dir" class="anchor"></a><code><span class="keyword">val</span> stdlib_dir : <a href="../../B00/Memo/index.html#type-t">B00.Memo.t</a> <span>&#45;&gt;</span> unit <span>&#45;&gt;</span> <span><a href="../../B00_std/Fpath/index.html#type-t">B00_std.Fpath.t</a> <a href="../../B00/Memo/index.html#type-fiber">B00.Memo.fiber</a></span></code></div></div></body></html>