<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"><head><title>Make (session-cohttp.Session_cohttp.Make)</title><link rel="stylesheet" href="../../../_odoc-theme/odoc.css"/><meta charset="utf-8"/><meta name="generator" content="odoc v1.1.1-1373-g2e7c1c75"/><meta name="viewport" content="width=device-width,initial-scale=1.0"/><script src="../../../highlight.pack.js"></script><script>hljs.initHighlightingOnLoad();</script></head><body><nav><a href="../index.html">Up</a> – <a href="../../index.html">session-cohttp</a> &#x00BB; <a href="../index.html">Session_cohttp</a> &#x00BB; Make</nav><header><h1>Module <code>Session_cohttp.Make</code></h1><aside><p>Create a Cohttp session manager given an appropriate backend.</p></aside><h3 id="parameters"><a href="#parameters" class="anchor"></a>Parameters</h3><div class="spec parameter" id="argument-1-IO" class="anchored"><a href="#argument-1-IO" class="anchor"></a><code><span class="keyword">module</span> <a href="argument-1-IO/index.html">IO</a> : <a href="../../../session/Session/S/module-type-IO/index.html">Session.S.IO</a></code></div><div class="spec parameter" id="argument-2-B" class="anchored"><a href="#argument-2-B" class="anchor"></a><code><span class="keyword">module</span> <a href="argument-2-B/index.html">B</a> : <a href="../module-type-Backend/index.html">Backend</a> <span class="keyword">with</span> <span class="keyword">type</span> <span>+'a <a href="../module-type-Backend/index.html#type-io">io</a></span> = <span><span class="type-var">'a</span> <a href="argument-1-IO/index.html#type-t">IO.t</a></span></code></div><h3 id="signature"><a href="#signature" class="anchor"></a>Signature</h3></header><div class="content"><div><div class="spec type" id="type-io" class="anchored"><a href="#type-io" class="anchor"></a><code><span class="keyword">type</span> <span>+'a io</span> = <span><span class="type-var">'a</span> <a href="argument-2-B/index.html#type-io">B.io</a></span></code></div><div><p>The type of a blocking computation that will produce a value of type <code>'a</code></p></div></div><div><div class="spec type" id="type-backend" class="anchored"><a href="#type-backend" class="anchor"></a><code><span class="keyword">type</span> backend = <a href="argument-2-B/index.html#type-t">B.t</a></code></div><div><p>The type of a handle on the store.</p></div></div><div><div class="spec type" id="type-key" class="anchored"><a href="#type-key" class="anchor"></a><code><span class="keyword">type</span> key = <a href="argument-2-B/index.html#type-key">B.key</a></code></div><div><p>The type of a session key.</p></div></div><div><div class="spec type" id="type-value" class="anchored"><a href="#type-value" class="anchor"></a><code><span class="keyword">type</span> value = <a href="argument-2-B/index.html#type-value">B.value</a></code></div><div><p>The type of a session value.</p></div></div><div><div class="spec type" id="type-period" class="anchored"><a href="#type-period" class="anchor"></a><code><span class="keyword">type</span> period = <a href="argument-2-B/index.html#type-period">B.period</a></code></div><div><p>The type of a session expiry period.</p></div></div><div><div class="spec type" id="type-t" class="anchored"><a href="#type-t" class="anchor"></a><code><span class="keyword">type</span> t = <span class="keyword">private</span> {</code><table><tr id="type-t.key" class="anchored"><td class="def record field"><a href="#type-t.key" class="anchor"></a><code>key : <a href="index.html#type-key">key</a>;</code></td><td class="doc"><p>They key for the session in the backend and in cookies.</p></td></tr><tr id="type-t.value" class="anchored"><td class="def record field"><a href="#type-t.value" class="anchor"></a><code><span class="keyword">mutable</span> value : <a href="index.html#type-value">value</a>;</code></td><td class="doc"><p>The value for the session stored in the backend.</p></td></tr><tr id="type-t.expiry_period" class="anchored"><td class="def record field"><a href="#type-t.expiry_period" class="anchor"></a><code><span class="keyword">mutable</span> expiry_period : <a href="index.html#type-period">period</a>;</code></td><td class="doc"><p>The period from now in seconds that the session will expire.</p></td></tr><tr id="type-t.modified" class="anchored"><td class="def record field"><a href="#type-t.modified" class="anchor"></a><code><span class="keyword">mutable</span> modified : bool;</code></td><td class="doc"><p>Whether the session data or expiry have been modified</p></td></tr></table><code>}</code></div><div><p>The session type.</p><p>This type is marked private, so the record fields can be accessed and pattern-matched as usual. However, values of this type cannot be constructed directly. To create a new session, use <a href="index.html#val-generate"><code>generate</code></a>. To retrieve an existing <code>session</code>, use <a href="index.html#val-of_key"><code>of_key</code></a> or <a href="index.html#val-of_header"><code>of_header</code></a>. To modify <a href="index.html#type-t.expiry_period"><code>t.expiry_period</code></a> or <a href="index.html#type-t.value"><code>t.value</code></a>, use <a href="index.html#val-set"><code>set</code></a>. Finally, use <a href="index.html#val-to_cookie_hdrs"><code>to_cookie_hdrs</code></a> to smartly generate <code>Set-Cookie</code> and related headers.</p></div></div><div><div class="spec value" id="val-of_key" class="anchored"><a href="#val-of_key" class="anchor"></a><code><span class="keyword">val</span> of_key : <a href="index.html#type-backend">backend</a> <span>&#45;&gt;</span> <a href="index.html#type-key">key</a> <span>&#45;&gt;</span> <span><span><span>(<a href="index.html#type-t">t</a>, <a href="../../../session/Session/S/index.html#type-error">Session.S.error</a>)</span> <a href="../../../result/Result/index.html#type-result">Result.result</a></span> <a href="index.html#type-io">io</a></span></code></div><div><p><code>of_key backend key</code> fetches the session associated with <code>key</code> from the backend, if present and unexpired.</p></div></div><div><div class="spec value" id="val-of_header" class="anchored"><a href="#val-of_header" class="anchor"></a><code><span class="keyword">val</span> of_header : <a href="index.html#type-backend">backend</a> <span>&#45;&gt;</span> string <span>&#45;&gt;</span> <a href="../../../cohttp/Cohttp/Header/index.html#type-t">Cohttp.Header.t</a> <span>&#45;&gt;</span> <span><span><span>(<span><a href="index.html#type-t">t</a> option</span>, <a href="../../../session/Session/S/index.html#type-error">Session.S.error</a>)</span> <a href="../../../result/Result/index.html#type-result">Result.result</a></span> <a href="index.html#type-io">io</a></span></code></div><div><p><code>of_header backend cookie_key header</code> retrieves the session key from the cookies in <code>header</code>. If <code>cookie_key</code> is not present in any cookies in <code>header</code>, then this function will return <code>None</code>. If a session key is found, it will call <code>{!val:of_key} backend key</code>. If both lookups were successful, then this function will return <code>Some session</code>. If no key was found in <code>header</code>, it will return <code>None</code>.</p></div></div><div><div class="spec value" id="val-of_header_or_create" class="anchored"><a href="#val-of_header_or_create" class="anchor"></a><code><span class="keyword">val</span> of_header_or_create : <span>?&#8288;expiry:<a href="index.html#type-period">period</a></span> <span>&#45;&gt;</span> <a href="index.html#type-backend">backend</a> <span>&#45;&gt;</span> string <span>&#45;&gt;</span> <a href="index.html#type-value">value</a> <span>&#45;&gt;</span> <a href="../../../cohttp/Cohttp/Header/index.html#type-t">Cohttp.Header.t</a> <span>&#45;&gt;</span> <span><a href="index.html#type-t">t</a> <a href="index.html#type-io">io</a></span></code></div><div><p><code>of_header_or_create ?expiry backend cookie_key default header</code> retrieves the session key from the cookies in <code>header</code>. If <code>cookie_key</code> is not present in any cookies in the <code>header</code> or if the session is not a valid one, a new session will be using <code>expiry</code> for the expiration period and <code>default</code> as the value.</p></div></div><div><div class="spec value" id="val-to_cookie_hdrs" class="anchored"><a href="#val-to_cookie_hdrs" class="anchor"></a><code><span class="keyword">val</span> to_cookie_hdrs : <span>?&#8288;discard:bool</span> <span>&#45;&gt;</span> <span>?&#8288;path:string</span> <span>&#45;&gt;</span> <span>?&#8288;domain:string</span> <span>&#45;&gt;</span> <span>?&#8288;secure:bool</span> <span>&#45;&gt;</span> <span>?&#8288;http_only:bool</span> <span>&#45;&gt;</span> string <span>&#45;&gt;</span> <a href="index.html#type-t">t</a> <span>&#45;&gt;</span> <span><span>(string * string)</span> list</span></code></div><div><p><code>to_cookie_hdrs cookie_key session</code> will generate response headers to communicate session changes to the client. This function takes into account the <a href="index.html#type-t.modified"><code>t.modified</code></a> field of the <a href="index.html#type-t">session</a> type, and will not generate headers if they are not needed.</p></div></div><div><div class="spec value" id="val-clear_hdrs" class="anchored"><a href="#val-clear_hdrs" class="anchor"></a><code><span class="keyword">val</span> clear_hdrs : <span>?&#8288;path:string</span> <span>&#45;&gt;</span> <span>?&#8288;domain:string</span> <span>&#45;&gt;</span> string <span>&#45;&gt;</span> <span><span>(string * string)</span> list</span></code></div><div><p><code>clear_hdrs cookie_key</code> will generate response headers to communicate that the client should evict the session with key <code>cookie_key</code>.</p></div></div><div><div class="spec value" id="val-generate" class="anchored"><a href="#val-generate" class="anchor"></a><code><span class="keyword">val</span> generate : <span>?&#8288;expiry:<a href="index.html#type-period">period</a></span> <span>&#45;&gt;</span> <a href="index.html#type-backend">backend</a> <span>&#45;&gt;</span> <a href="index.html#type-value">value</a> <span>&#45;&gt;</span> <span><a href="index.html#type-t">t</a> <a href="index.html#type-io">io</a></span></code></div><div><p><code>generate ?expiry backend value</code> will allocate a new session in the backend <code>backend</code>. The session will expire <code>expiry</code> seconds from now, defaulting to <code>default_period backend</code> if one is not explicitly specified.</p></div></div><div><div class="spec value" id="val-clear" class="anchored"><a href="#val-clear" class="anchor"></a><code><span class="keyword">val</span> clear : <a href="index.html#type-backend">backend</a> <span>&#45;&gt;</span> <a href="index.html#type-t">t</a> <span>&#45;&gt;</span> <span>unit <a href="index.html#type-io">io</a></span></code></div><div><p><code>clear backend session</code> removes <code>session</code> from <code>backend</code>. The backend may choose to persist the session value beyond this call, but any subsequent operations involving <code>key</code> should behave as if <code>key</code> is not present in the backend.</p><p>The <a href="index.html#type-t.value"><code>value</code></a> and <a href="index.html#type-t.expiry_period"><code>t.expiry_period</code></a> of <code>session</code> will be zero'd out, and the <a href="index.html#type-t.modified"><code>t.modified</code></a> flag will be set. Calling <a href="index.html#val-to_cookie_hdrs"><code>to_cookie_hdrs</code></a> on a cleared session will generate the appropriate headers directing the client to clear the associated cookie.</p></div></div><div><div class="spec value" id="val-set" class="anchored"><a href="#val-set" class="anchor"></a><code><span class="keyword">val</span> set : <span>?&#8288;expiry:<a href="index.html#type-period">period</a></span> <span>&#45;&gt;</span> <span>?&#8288;value:<a href="index.html#type-value">value</a></span> <span>&#45;&gt;</span> <a href="index.html#type-backend">backend</a> <span>&#45;&gt;</span> <a href="index.html#type-t">t</a> <span>&#45;&gt;</span> <span>unit <a href="index.html#type-io">io</a></span></code></div><div><p><code>set ?expiry ?value backend session</code> sets the <code>value</code> for the session associated <code>key</code> in <code>backend</code> and sets the session to expire <code>expiry</code> seconds from now. If <code>expiry</code> is not provided, the expiry period reported by <code>default_period backend</code> will be used instead. If no value is provided, then only the expiry will be updated.</p></div></div></div></body></html>